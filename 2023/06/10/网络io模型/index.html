<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络IO模型 | 个人博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="./favicon.ico">
    <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?55943ae09e5901d7a9f5705133737eec";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
           </script>
    <script src="https://hm.baidu.com/hm.js?xxxxxxxxxxx"></script>
    <meta name="description" content="会思考的芦苇。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="./assets/css/0.styles.f4f644f3.css" as="style"><link rel="preload" href="./assets/js/app.764dede6.js" as="script"><link rel="preload" href="./assets/js/13.20e964b9.js" as="script"><link rel="preload" href="./assets/js/1.8757f81f.js" as="script"><link rel="preload" href="./assets/js/14.d0932ff0.js" as="script"><link rel="preload" href="./assets/js/34.ec572062.js" as="script"><link rel="prefetch" href="./assets/js/10.36ed4133.js"><link rel="prefetch" href="./assets/js/11.18e1c33d.js"><link rel="prefetch" href="./assets/js/12.b32071c5.js"><link rel="prefetch" href="./assets/js/15.7747d51d.js"><link rel="prefetch" href="./assets/js/16.487f9c88.js"><link rel="prefetch" href="./assets/js/17.9ae2b89b.js"><link rel="prefetch" href="./assets/js/18.801c9b12.js"><link rel="prefetch" href="./assets/js/19.867ef46b.js"><link rel="prefetch" href="./assets/js/20.ec371d7f.js"><link rel="prefetch" href="./assets/js/21.73f810bc.js"><link rel="prefetch" href="./assets/js/22.8c016772.js"><link rel="prefetch" href="./assets/js/23.9aa3d5ef.js"><link rel="prefetch" href="./assets/js/24.a6dcda10.js"><link rel="prefetch" href="./assets/js/25.2fe13775.js"><link rel="prefetch" href="./assets/js/26.2296389e.js"><link rel="prefetch" href="./assets/js/27.21f2d66f.js"><link rel="prefetch" href="./assets/js/28.3209357f.js"><link rel="prefetch" href="./assets/js/29.c7065b7f.js"><link rel="prefetch" href="./assets/js/3.9efa3b27.js"><link rel="prefetch" href="./assets/js/30.92914cc9.js"><link rel="prefetch" href="./assets/js/31.13c12633.js"><link rel="prefetch" href="./assets/js/32.b016f60e.js"><link rel="prefetch" href="./assets/js/33.ed48a654.js"><link rel="prefetch" href="./assets/js/35.5b55607b.js"><link rel="prefetch" href="./assets/js/36.f50b6e38.js"><link rel="prefetch" href="./assets/js/37.34409ac4.js"><link rel="prefetch" href="./assets/js/38.c7073f77.js"><link rel="prefetch" href="./assets/js/39.12f063e9.js"><link rel="prefetch" href="./assets/js/4.95c562bd.js"><link rel="prefetch" href="./assets/js/40.1bbd5377.js"><link rel="prefetch" href="./assets/js/41.6331a8cf.js"><link rel="prefetch" href="./assets/js/42.28acd6f5.js"><link rel="prefetch" href="./assets/js/43.905d2114.js"><link rel="prefetch" href="./assets/js/44.041132c5.js"><link rel="prefetch" href="./assets/js/45.d1a66b92.js"><link rel="prefetch" href="./assets/js/46.1c9100fe.js"><link rel="prefetch" href="./assets/js/47.3e75f768.js"><link rel="prefetch" href="./assets/js/48.7d7248fb.js"><link rel="prefetch" href="./assets/js/49.8d465809.js"><link rel="prefetch" href="./assets/js/5.a1a0df33.js"><link rel="prefetch" href="./assets/js/50.4aa56564.js"><link rel="prefetch" href="./assets/js/51.59674bf5.js"><link rel="prefetch" href="./assets/js/52.f3990683.js"><link rel="prefetch" href="./assets/js/53.092fe0ad.js"><link rel="prefetch" href="./assets/js/54.ac62e2a7.js"><link rel="prefetch" href="./assets/js/55.3530fa5a.js"><link rel="prefetch" href="./assets/js/56.6e9bc6f3.js"><link rel="prefetch" href="./assets/js/6.e534639a.js"><link rel="prefetch" href="./assets/js/7.bc868936.js"><link rel="prefetch" href="./assets/js/8.ce0f4f25.js"><link rel="prefetch" href="./assets/js/9.a57a9cf0.js">
    <link rel="stylesheet" href="./assets/css/0.styles.f4f644f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Gordon</h3> <p class="description" data-v-59e6cb88>会思考的芦苇。</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Gordon</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><img src="./logo.png" alt="个人博客" class="logo"> <span class="site-name">个人博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      计算引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./计算引擎/flink.html" class="nav-link"><i class="undefined"></i>
  flink
</a></li><li class="dropdown-item"><!----> <a href="/./计算引擎/spark.html" class="nav-link"><i class="undefined"></i>
  spark
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      存储引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./存储引擎/ElasticSearch.html" class="nav-link"><i class="undefined"></i>
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/hbase.html" class="nav-link"><i class="undefined"></i>
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/redis.html" class="nav-link"><i class="undefined"></i>
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      云原生
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./云原生/Docker.html" class="nav-link"><i class="undefined"></i>
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      中间件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./中间件/kafka.html" class="nav-link"><i class="undefined"></i>
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./中间件/Sqoop基本使用.html" class="nav-link"><i class="undefined"></i>
  Sqoop基本使用
</a></li></ul></div></div><div class="nav-item"><a href="/./tool/emoji/我的常用emoji.html" class="nav-link"><i class="undefined"></i>
  工具
</a></div><div class="nav-item"><a href="/./aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div> <a href="https://github.com/GordonChanFZ/gordonchanfz.github.io/" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="./avatar.jpeg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Gordon
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>30</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>47</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41><li class="social-item" data-v-1fad0c41><i class="iconfont reco-github" style="color:#e15b64;" data-v-1fad0c41></i></li></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      计算引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./计算引擎/flink.html" class="nav-link"><i class="undefined"></i>
  flink
</a></li><li class="dropdown-item"><!----> <a href="/./计算引擎/spark.html" class="nav-link"><i class="undefined"></i>
  spark
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      存储引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./存储引擎/ElasticSearch.html" class="nav-link"><i class="undefined"></i>
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/hbase.html" class="nav-link"><i class="undefined"></i>
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/redis.html" class="nav-link"><i class="undefined"></i>
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      云原生
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./云原生/Docker.html" class="nav-link"><i class="undefined"></i>
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      中间件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./中间件/kafka.html" class="nav-link"><i class="undefined"></i>
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./中间件/Sqoop基本使用.html" class="nav-link"><i class="undefined"></i>
  Sqoop基本使用
</a></li></ul></div></div><div class="nav-item"><a href="/./tool/emoji/我的常用emoji.html" class="nav-link"><i class="undefined"></i>
  工具
</a></div><div class="nav-item"><a href="/./aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div> <a href="https://github.com/GordonChanFZ/gordonchanfz.github.io/" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>网络IO模型</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Gordon</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">网络IO模型</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Gordon</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023-6-10</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>网络IO</span></i></div></div> <div class="theme-reco-content content__default"><h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>掌握IO模型的演进，代码可以先忽略。</p> <h3 id="io模型的分类"><a href="#io模型的分类" class="header-anchor">#</a> IO模型的分类</h3> <p>IO模型给BIO、NIO、多路复用、信号驱动IO、异步IO五种IO模型</p> <p>大白话理解：</p> <p>举个生活中简单的例子，你妈妈让你烧水，小时候你比较笨啊，在哪里傻等着水开（<strong>同步阻塞</strong>）。等你稍微再长大一点，你知道每次烧水的空隙可以去干点其他事，然后只需要时不时来看看水开了没有（<strong>同步非阻塞</strong>）。后来，你们家用上了水开了会发出声音的壶，这样你就只需要听到响声后就知道水开了，在这期间你可以随便干自己的事情，你需要去倒水了（<strong>异步非阻塞</strong>）。</p> <h3 id="传统的io即bio"><a href="#传统的io即bio" class="header-anchor">#</a> 传统的IO即BIO</h3> <p><img src="./assets/img/image-20230217191207823.114c91d6.png" alt="image-20230217191207823"></p> <p>内核空间需要释放不能阻塞</p> <h3 id="同步非阻塞io即nio"><a href="#同步非阻塞io即nio" class="header-anchor">#</a> 同步非阻塞IO即NIO</h3> <p><img src="./assets/img/image-20230217191430714.196664c6.png" alt="image-20230217191430714"></p> <p>很多空轮询对CPU的占用</p> <h3 id="io多路复用-难点"><a href="#io多路复用-难点" class="header-anchor">#</a> IO多路复用（难点）</h3> <p><img src="./assets/img/image-20230217192247755.8ad80aef.png" alt="image-20230217192247755"></p> <p>IO复用模型核心思路：系统给我们提供<strong>一类函数</strong>（如我们耳濡目染的<strong>select、poll、epoll函数</strong>），它们可以同时监控多个<code>fd</code>的操作，任何一个返回内核数据就绪，应用进程再发起<code>recvfrom</code>系统调用。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>文件描述符fd(File Descriptor),它是计算机科学中的一个术语，形式上是一个非负整数。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="io多路复用之select"><a href="#io多路复用之select" class="header-anchor">#</a> IO多路复用之select</h4> <p>应用进程通过调用select函数，可以同时监控多个<code>fd</code>，在<code>select</code>函数监控的<code>fd</code>中，只要有任何一个数据状态准备就绪了，<code>select</code>函数就会返回可读状态，这时应用进程再发起<code>recvfrom</code>请求去读取数据。</p> <p>但是呢，<code>select</code>有几个缺点：</p> <ul><li>监听的IO最大连接数有限，在Linux系统上一般为1024。</li> <li>select函数返回后，是通过<strong>遍历<code>fdset</code></strong>，找到就绪的描述符<code>fd</code>。（仅知道有I/O事件发生，却不知是哪几个流，所以遍历所有流）</li></ul> <h4 id="io多路复用之poll"><a href="#io多路复用之poll" class="header-anchor">#</a> IO多路复用之<strong>poll</strong></h4> <p>因为<strong>存在连接数限制</strong>，所以后来又提出了<strong>poll</strong>。与select相比，<strong>poll</strong>解决了<strong>连接数限制问题</strong>。但是呢，select和poll一样，还是需要通过遍历文件描述符来获取已经就绪的<code>socket</code>。如果同时连接的大量客户端在一时刻可能只有极少处于就绪状态，伴随着监视的描述符数量的增长，（时间花在<strong>遍历</strong>描述符就会增加）<strong>效率也会线性下降</strong>。</p> <p>因此经典的多路复用模型<code>epoll</code>诞生。</p> <h4 id="io多路复用之epoll"><a href="#io多路复用之epoll" class="header-anchor">#</a> IO多路复用之epoll</h4> <p><a href="https://www.bilibili.com/video/BV1r54y1f7bU/?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">小白也看得懂的 I/O 多路复用解析（超详细案例）_哔哩哔哩_bilibili<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>为了解决<code>select/poll</code>存在的问题，多路复用模型<code>epoll</code>诞生，它采用事件驱动来实现。</p> <p><strong>epoll</strong>先通过<code>epoll_ctl()</code>来注册一个<code>fd</code>（文件描述符），一旦基于某个<code>fd</code>就绪时，内核会采用回调机制，迅速激活这个<code>fd</code>，当进程调用<code>epoll_wait()</code>时便得到通知。这里去掉了<strong>遍历文件描述符</strong>的坑爹操作，而是采用<strong>监听事件回调</strong>的的机制，唤醒等待队列，检查就绪事件。</p> <p><img src="./assets/img/image-20230217222334699.fdc5f851.png" alt="image-20230217222334699"></p> <p><img src="./assets/img/image-20230217222258181.8fedfab3.png" alt="image-20230217222258181"></p> <p>大致流程如下：</p> <p>1）用户空间调用 epoll_create ，内核新建 epoll 对象，返回 epoll 的 fd，用于后续操作</p> <p>2）用户空间反复调用 epoll_ctl 将我们要监听的 fd 维护到 epoll，底层通过红黑树来高效的维护 fd 集合</p> <p>3）用户空间调用 epoll_wait 获取就绪事件，内核检查 epoll 的就绪列表，如果就绪列表为空则会进入阻塞</p> <p>4）客户端向服务端发送数据，数据通过网络传输到服务端的网卡</p> <p>5）网卡通过 DMA 的方式将数据包写入到指定内存中（ring_buffer），处理完成后通过中断信号告诉 CPU 有新的数据包到达</p> <p>6）CPU 收到中断信号后，进行响应中断，首先保存当前执行程序的上下文环境，然后调用中断处理程序（网卡驱动程序）进行处理：</p> <ul><li><p>根据数据包的ip和port找到对应的socket，将数据放到socket的接收队列；</p></li> <li><p>执行 socket 对应的回调函数：将当前 socket 添加到 eventpoll 的就绪列表、唤醒 eventpoll 等待队列里的用户进程（设置为RUNNING状态）</p></li></ul> <p>7）用户进程恢复运行后，调用 epoll_wait 检查 eventpoll 里的就绪列表，不是该进程数据添加到等待队列里面，再取下一个进程，检查不为空，则将就绪事件填充到入参中的 events 里，然后返回。</p> <p>8）用户进程收到返回的事件后，执行 events 里的事件处理，例如读事件则将数据从内核缓冲区拷贝到应用程序缓冲区</p> <p>9）最后执行逻辑处理</p> <p><strong>我们一起来总结一下select、poll、epoll的区别</strong></p> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">select</th> <th style="text-align:left;">poll</th> <th style="text-align:left;">epoll</th></tr></thead> <tbody><tr><td style="text-align:left;">底层数据结构</td> <td style="text-align:left;">数组</td> <td style="text-align:left;">链表</td> <td style="text-align:left;">红黑树和双链表</td></tr> <tr><td style="text-align:left;">获取就绪的fd</td> <td style="text-align:left;">遍历</td> <td style="text-align:left;">遍历</td> <td style="text-align:left;">事件回调</td></tr> <tr><td style="text-align:left;">事件复杂度</td> <td style="text-align:left;">O(n)</td> <td style="text-align:left;">O(n)</td> <td style="text-align:left;">O(1)</td></tr> <tr><td style="text-align:left;">最大连接数</td> <td style="text-align:left;">1024</td> <td style="text-align:left;">无限制</td> <td style="text-align:left;">无限制</td></tr> <tr><td style="text-align:left;">fd数据拷贝</td> <td style="text-align:left;">每次调用select，需要将fd数据从用户空间拷贝到内核空间</td> <td style="text-align:left;">每次调用poll，需要将fd数据从用户空间拷贝到内核空间</td> <td style="text-align:left;">不需要从用户空间频繁拷贝fd数据到内核空间</td></tr></tbody></table> <p><strong>epoll</strong>明显优化了IO的执行效率，但在进程调用<code>epoll_wait()</code>时，仍然可能被阻塞的。能不能酱紫：不用我老是去问你数据是否准备就绪，等我发出请求后，你数据准备好了通知我就行了，这就诞生了<strong>信号驱动IO模型</strong>。</p> <h3 id="io模型之信号驱动模型"><a href="#io模型之信号驱动模型" class="header-anchor">#</a> IO模型之信号驱动模型</h3> <p>信号驱动IO不再用主动询问的方式去确认数据是否就绪，而是向内核发送一个信号（调用<code>sigaction</code>的时候建立一个<code>SIGIO</code>的信号），然后应用用户进程可以去做别的事，不用阻塞。当内核数据准备好后，再通过<code>SIGIO</code>信号通知应用进程，数据准备好后的可读状态。应用用户进程收到信号之后，立即调用<code>recvfrom</code>，去读取数据。</p> <p><img src="./assets/img/2f80eaf2a7d8fae625cf5829c4493d80.b3bcc948.png" alt="img"></p> <p>信号驱动IO模型，在应用进程发出信号后，是立即返回的，不会阻塞进程。它已经有异步操作的感觉了。但是你细看上面的流程图，<strong>发现数据复制到应用缓冲的时候</strong>，应用进程还是阻塞的。回过头来看下，不管是BIO，还是NIO，还是信号驱动，在数据从内核复制到应用缓冲的时候，都是阻塞的。还有没有优化方案呢？<strong>AIO</strong>（真正的异步IO）！</p> <h3 id="io-模型之异步io-aio"><a href="#io-模型之异步io-aio" class="header-anchor">#</a> IO 模型之异步IO(AIO)</h3> <p>前面讲的<code>BIO，NIO和信号驱动</code>，在数据从内核复制到应用缓冲的时候，都是<strong>阻塞</strong>的，因此都不是真正的异步。<code>AIO</code>实现了IO全流程的非阻塞，就是应用进程发出系统调用后，是立即返回的，但是<strong>立即返回的不是处理结果，而是表示提交成功类似的意思</strong>。等内核数据准备好，将数据拷贝到用户进程缓冲区，发送信号通知用户进程IO操作执行完毕。</p> <p>流程如下：</p> <p><img src="./assets/img/f0fae2a3259b1ab06d4477f32994e6ef.c4fa9e79.png" alt="img"></p> <p>异步IO的优化思路很简单，只需要向内核发送一次请求，就可以完成数据状态询问和数据拷贝的所有操作，并且不用阻塞等待结果。</p> <h3 id="reactor三种模型"><a href="#reactor三种模型" class="header-anchor">#</a> <strong>Reactor三种模型</strong></h3> <h4 id="单线程模型"><a href="#单线程模型" class="header-anchor">#</a> 单线程模型</h4> <p>模型图如下：</p> <p><img src="./assets/img/20220504112901165163494189792.8d06f7c0.png" alt="img"></p> <p>上图描述了 Reactor 的单线程模型结构，在 Reactor 单线程模型中，所有 I/O 操作（包括连接建立、数据读写、事件分发等）、业务处理，都是由一个线程完成的。单线程模型逻辑简单，缺陷也十分明显：</p> <ul><li>一个线程支持处理的连接数非常有限，CPU 很容易打满，性能方面有明显瓶颈；</li> <li>当多个事件被同时触发时，只要有一个事件没有处理完，其他后面的事件就无法执行，这就会造成消息积压及请求超时；</li> <li>线程在处理 I/O 事件时，Select 无法同时处理连接建立、事件分发等操作；</li> <li>如果 I/O 线程一直处于满负荷状态，很可能造成服务端节点不可用。</li></ul> <p>在单线程 Reactor 模式中，Reactor 和 Handler 都在同一条线程中执行。这样，带来了一个问题：当其中某个 Handler 阻塞时，会导致其他所有的 Handler 都得不到执行。</p> <p>在这种场景下，被阻塞的 Handler 不仅仅负责输入和输出处理的传输处理器，还包括负责新连接监听的 Acceptor 处理器，可能导致服务器无响应。这是一个非常严重的缺陷，导致单线程反应器模型在生产场景中使用得比较少。</p> <h4 id="单reactor多线程模型"><a href="#单reactor多线程模型" class="header-anchor">#</a> 单Reactor多线程模型</h4> <p><strong>1.1 大部分网络服务包括以下处理步骤</strong><br>
read request（读取客户端发送过来的byte数据）<br>
decode request（把byte数据解码成特定类型的数据）<br>
process (compute) service（根据请求数据进行业务处理）<br>
encode reply（把处理结果转换成byte数据）<br>
send reply（发送byte数据给客户端）</p> <p><strong>1.2 Reactor多线程模型图</strong>（来自于Doug Lea的文章）</p> <p><img src="./assets/img/157264-20190912141230880-2037944922.272e7ad8.png" alt="img"></p> <p>Reactor - 负责响应IO事件，把事件分发给相应的处理代码。Reactor运行在一个独立的线程中（非Thread Pool中的线程）。具体来说，Reactor主要有两个职责，一个是处理来自客户端的连接事件，处理代码由acceptor实现；另一个是处理读取和发送数据的事件，处理代码由Handler实现。<br>
Acceptor - 用以接受客户端的连接请求，然后创建Handler对连接进行后续的处理（读取，处理，发送数据）。<br>
Handler - 事件处理类，用以实现具体的业务逻辑。图中read，decode，compute，encode和send都是由handler实现的。<br>
Thread Pool - Thread Pool中的thread被称作worker thread。Handler中的decode，compute和encode是用worker thread执行的。值得注意的是Handler中的read和send方法是在Reactor线程而不是worker thread中执行的。这意味着对socket数据的读取发送数据和对数据的处理是在不同的线程中进行的.</p> <p><strong>1.3 Reactor多线程模型的主要问题</strong></p> <ol><li>read和send会影响接受客户端连接的性能<br>
前面分析过read和send是在Reactor线程中执行的，接受客户端的连接请求也是在Reactor线程中执行。这使得如果有read或者send耗时较长，会影响其他客户端连接的速度。</li> <li>Read和send性能不够高效<br>
网络服务对于来自同一客户端的read和send是串行的，但是对于不同客户端之间的read和send是可以并行进行的。由于read和send运行在Reactor单线程中，不能充分发挥硬件能力。</li> <li>线程上下文切换带来额外开销<br>
前面提到的处理客户端请求的步骤依次是read，decode，process，encode，send。由于read和send是在Reactor线程中执行，而decode，process和encode是在worker thread线程中执行，引入了额外的线程切换开销，这种开销在高并发的时候会体现出来。</li></ol> <h4 id="reactor主从多线程模型"><a href="#reactor主从多线程模型" class="header-anchor">#</a> Reactor主从多线程模型</h4> <p><img src="./assets/img/image-20230623223251832.193bb6e7.png" alt="image-20230623223251832"></p> <p>主从 Reactor 模型要想解决这个问题，同样需要从我们前面介绍的几个阶段中的某一个或者多个进行优化处理。</p> <p><strong>既然是主从模式，那谁主谁从呢？哪个模块使用主从呢？</strong></p> <p>在多线程模型中，我们提到，其主要缺陷在于同一时间无法处理<strong>大量新连接</strong>、<strong>IO就绪事件</strong>；因此，将主从模式应用到这一块，就可以解决这个问题。</p> <p>主从 Reactor 模式中，分为了主 Reactor 和 从 Reactor，分别处理 <code>新建立的连接</code>、<code>IO读写事件/事件分发</code>。</p> <ul><li>一来，主 Reactor 可以解决同一时间大量新连接，将其注册到从 Reactor 上进行IO事件监听处理</li> <li>二来，IO事件监听相对新连接处理更加耗时，此处我们可以考虑使用线程池来处理。这样能充分利用多核 CPU 的特性，能使更多就绪的IO事件及时处理。</li></ul> <p>简言之，主从多线程模型由多个 Reactor 线程组成，每个 Reactor 线程都有独立的 Selector 对象。MainReactor 仅负责处理客户端连接的 Accept 事件，连接建立成功后将新创建的连接对象注册至 SubReactor。再由 SubReactor 分配线程池中的 I/O 线程与其连接绑定，它将负责连接生命周期内所有的 I/O 事件。</p> <p>在海量客户端并发请求的场景下，主从多线程模式甚至可以适当增加 SubReactor 线程的数量，从而利用多核能力提升系统的吞吐量。</p> <h4 id="实际应用中的多线程模型"><a href="#实际应用中的多线程模型" class="header-anchor">#</a> 实际应用中的多线程模型</h4> <p>Doug Lea文章中的”主从Reactor“模式可以解决上述第一个和第二个问题。它把接受客户端连接的<br>
“主Reactor”单独运行在一个线程中，“从Reactor”有多个，组成一个Reactor Pool，每个”从Reactor“都运行在一个独立的线程上，具有自己的selector和dispatch loop。但第三个问题还是没有解决，read和send仍然是运行在”从Reactor“线程上，而decode，process和encode运行在worker thread上。</p> <p>要解决第三个问题，可以采用下面的方式。Reactor线程专门用于接受客户端连接（通过acceptor）；创建多个Event Loop ，组成Event Loop Pool，每个Event Loop都有自己的Selector，并且运行在独立的线程上；Acceptor对于每一个客户端的连接从EventLoopPool中选择一个Event Loop进行处理，并且保证每个客户端连接在整个生命周期中都是由同一个Event Loop线程来处理，从而使得Handler中的实现-read，decode，process，encode，send-都在同一个线程中执行。整个线程模型除了高效的性能，还有非常重要的一点是Handler的实现不需要加锁，一方面对性能有帮助，另一方面避免多线程编程的复杂度。</p> <p><strong>2.1 改进后的模型图</strong></p> <p><strong><img src="./assets/img/157264-20190912141824384-707799480.cb19a8da.png" alt="img"></strong></p> <p>reactor是高并发编程的基础模型，比如netty，kafka都是以它为模型构建。</p> <h3 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h3> <h4 id="bio-blocking-io"><a href="#bio-blocking-io" class="header-anchor">#</a> BIO（Blocking IO）</h4> <p>1、客户端</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BioClient</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">9099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 向服务端发送数据</span>
		socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello BioServer&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;向服务端发送数据结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">//接收服务端回传的数据</span>
		socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;接收到服务端返回的数据：{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2、服务端</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BioServer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">9099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;等待客户端连接&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//阻塞方法</span>
			<span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;客户端连接成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
					<span class="token function">handler</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;开始读取数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 接收客户端的数据，阻塞方法，没有数据可读时就阻塞</span>
		<span class="token keyword">int</span> read <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;读取数据完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;接收到客户端的数据：{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 向outputStream中回写数据</span>
		socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello BioClient&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>3、效果展示<br>
根据测试结果，我们不难发现，BIO的服务端是阻塞获取新请求。结合代码，没接收到一个新请求，就开启一个线程读取对应的数据。</p> <p>服务端：</p> <p><img src="./assets/img/image-20230218001313776.38f58e72.png" alt="image-20230218001313776"></p> <p>客户端：</p> <p><img src="./assets/img/image-20230218001332293.95035cc5.png" alt="image-20230218001332293"></p> <p>4、总结<br>
在BIO模式下，会存在一下问题：</p> <p>问题一：只能以阻塞的形式读取每一次的请求。</p> <p>问题二：如果客户端发送的数据为0，那么服务端在读取数据的时候也会阻塞读取，直到获取到数据才会向下执行，即下面这行代码也是阻塞的。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> read <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>BIO升级为每接收到一个连接，就开启一个线程</p> <p>问题三：并发请求10W个连接，此时就会开启10W个线程，资源耗费极大</p> <p>问题四：和问题二相同，如果其中一个线程迟迟没有获取到数据，这就会导致部分线程卡死</p> <p>BIO再次升级，升级为一个线程池的使用</p> <p>问题五：虽然线程池能够解决线程开启和释放的性能损耗，但是依然会出现问题四</p> <p>BIO 方式适用于连接数目比较小且固定的架构， 这种方式对服务器资源要求比较高， 但程序简单易理解</p> <h4 id="nio-nonblocking-io"><a href="#nio-nonblocking-io" class="header-anchor">#</a> NIO（NonBlocking IO）</h4> <p>1、客户端</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioClient</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>


		<span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8099</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;Hello NioServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;发送数据成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> read <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;读取到服务端返回的 {} 长度的数据&quot;</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;Hello NioServer2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;再次发送数据成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻塞线程</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>2、服务端</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioServer</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
		<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// accept不会阻塞</span>
		ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> channelList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;开始接收请求&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">SocketChannel</span> accept <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>accept <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;获取到对应的连接&quot;</span> <span class="token operator">+</span> accept<span class="token punctuation">)</span><span class="token punctuation">;</span>
				accept<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read不会阻塞</span>
				channelList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>accept<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> channelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;开始读取客户端的数据&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;读取到 {} 长度的数据&quot;</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">ByteBuffer</span> retBuf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;Hi NioClient&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻塞线程，便于观察控制台</span>
					channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>retBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
					buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;数据读取完成&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>3、效果展示<br>
NIO区别于BIO最大的特点就是是否是阻塞获取请求（一定要区分开Java的NIO包和NIO这个概念）。NIO会不断的轮询获取请求，即控制台中不断的轮询打印开始接受请求，如果接收到数据，就会像控制台那样，直接读取对应的数据。结尾的报错是因为我关闭了客户端的连接</p> <p>服务端：<br> <img src="./assets/img/image-20230218001739016.d2fe62d7.png" alt="image-20230218001739016"></p> <p>客户端：</p> <p><img src="./assets/img/image-20230218001844605.1c44117f.png" alt="image-20230218001844605"></p> <p>4、总结</p> <p>对然NIO不再像BIO那样会阻塞线程，造成网络堵塞，但是它不停的去轮询线程，会造成CPU空转，这也是我们不想看到的。如果大量连接不涉及写数据，但此时这个线程轮询获取写入数据的操作就是无意义的。</p> <h4 id="多路复用-multiplexing"><a href="#多路复用-multiplexing" class="header-anchor">#</a> 多路复用（Multiplexing）</h4> <p>1、客户端</p> <p>多路复用客户端代码结构为：</p> <p>初始化对应的与服务端的连接，这里的初始化包含初始化channel和Selector，并且完成对应事件和channel的绑定关系<br>
开启连接，内部逻辑为依靠selector进行监听对应的事件（这就是我们所说的Reactor事件处理机制），如果监听到对应的连接信息，就根据连接中的事件进行判定，然后再执行不同的业务逻辑</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultioClient</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">Selector</span> selector<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">MultioClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultioClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		client<span class="token punctuation">.</span><span class="token function">initClient</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">9099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 获得一个Socket通道，并对该通道做一些初始化的工作
	 *
	 * @param ip   连接的服务器的ip
	 * @param port 连接的服务器的端口号
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">// 获得一个Socket通道</span>
		<span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 设置通道为非阻塞</span>
		channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 获得一个通道管理器</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 客户端连接服务器,其实方法执行并没有实现连接，需要在listen（）方法中调</span>
		<span class="token comment">// 用channel.finishConnect() 才能完成连接</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第1步：客户端初始化，发起连接，触发连接事件请求&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		channel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 将通道管理器和该通道绑定，并为该通道注册SelectionKey.OP_CONNECT事件（连接事件）。</span>

		channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 采用轮询的方式监听selector上是否有需要处理的事件，如果有，则进行处理
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">// 轮询访问selector</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 获得selector中选中的项的迭代器</span>
			<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 删除已选的key,以防重复处理</span>
				it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 连接事件发生</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 如果正在连接，则完成连接</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">isConnectionPending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						channel<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 设置成非阻塞</span>
					channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 在这里可以给服务端发送信息哦</span>
					<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;Hello MultServer&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第3步：向服务端发送数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 在和服务端连接成功之后，为了可以接收到服务端的信息，需要给通道设置读的权限。</span>
					channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获得了可读的事件</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第6步：读取返回的数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">read</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 处理读取服务端发来的信息事件
	 *
	 * @param key
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">//和服务端的read方法一样</span>
		<span class="token comment">// 服务器可读取消息:得到事件发生的Socket通道</span>
		<span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 创建读取的缓冲区</span>
		<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> len <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;客户端收到信息：&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><p>服务端<br>
多路复用服务端代码逻辑：</p> <p>同样的先初始化出channel和selector，然后完成事件的注册。需要区分的是客户端的channel是SocketChannel，服务端的channel是ServerSocketChannel。<br>
同样的依靠Reactor事件处理机制去监听对应的请求中的事件，然后根据事件的类型做出不同的判定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultioServer</span> <span class="token punctuation">{</span>


	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">// 创建一个在本地端口进行监听的服务Socket通道.并设置为非阻塞方式</span>
		<span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 必须配置为非阻塞才能往selector上注册，否则会报错，selector模式本身就是非阻塞模式</span>
		ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ssc<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9099</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 创建一个选择器selector</span>
		<span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 把ServerSocketChannel注册到selector上，并且selector对客户端accept连接操作感兴趣</span>
		ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;等待事件发生——&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 轮询监听channel里的key，select是阻塞的，accept()也是阻塞的</span>
			<span class="token keyword">int</span> select <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;有事件发生——&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 有客户端请求，被轮询监听到</span>
			<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">//删除本次已处理的key，防止下次select重复处理</span>
				it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">handle</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param key 对应的事件key
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第2步：有客户端[连接事件]发生&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// NIO非阻塞体现：此处accept方法是阻塞的，但是这里因为是发生了连接事件，所以这个方法会马上执行完，不会阻塞</span>
			<span class="token comment">// 处理完连接请求不会继续等待客户端的数据发送</span>
			<span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 通过Selector监听Channel时对读事件感兴趣</span>
			sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第4步：有客户端数据[可读事件]发生&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// NIO非阻塞体现：首先read方法不会阻塞，其次这种事件响应模型，当调用到read方法时肯定是发生了客户端发送数据的事件</span>
			<span class="token keyword">int</span> len <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;读取到客户端发送的数据，可进行相应的业务处理：&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 向客户端写入数据</span>
			<span class="token class-name">ByteBuffer</span> bufferToWrite <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;Hello MultClient&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bufferToWrite<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 会触发key.isWritable() 或 key.isReadable()的条件</span>
			key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第5步：有客户端数据[写入事件]发生了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// NIO事件触发是水平触发</span>
			<span class="token comment">// 使用Java的NIO编程的时候，在没有数据可以往外写的时候要取消写事件，</span>
			<span class="token comment">// 在有数据往外写的时候再注册写事件</span>
			key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>3、效果展示<br>
代码执行逻辑为：</p> <p>首先客户端会初始化，然后去连接服务端<br>
服务端接收到对应的连接事件后<br>
然后客户端向服务端写入数据<br>
此时服务端接收到客户端发送过来的连接，触发可读事件（key.isReadable()）<br>
读取完数据之后，服务端准备向客户端写入数据，此时触发服务端的可写事件，没有数据可以写入的时候取消写事件<br>
最终客户端收到服务端写会的数据<br>
客户端：</p> <p><img src="./assets/img/image-20230218002348437.1d2e1417.png" alt="image-20230218002348437"></p> <p>服务端：</p> <p><img src="./assets/img/image-20230218002527588.72df2e2a.png" alt="image-20230218002527588"></p> <p>4、总结</p> <p>多路复用其实是一个相对完美的解决方案，即采用了Reactor模型，当对应的读、写、连接等事件触发的时候，再触发对应的接收请求的逻辑，然后完成后续的业务代码。既不会造成空轮询无效请求，也不会阻塞网络。</p> <p>正式基于种种特点，Netty就在该IO模型的基础上进行封装。</p> <h4 id="netty-基于多路复用io"><a href="#netty-基于多路复用io" class="header-anchor">#</a> Netty（基于多路复用IO）</h4> <p>1、客户端<br>
Netty客户端代码如下，代码基本骨架都差不多</p> <p>1.船舰对应的group，你可以理解为用来接收请求和分配工作线程的线程池组<br>
2.创建对应的channel<br>
3.创建需要对数据进行处理的handler。handler分为两大类：ChannelInboundHandler和4.ChannelOutboundHandler，你可以理解为是对管道中数据入口方向和出口方向数据的处理。<br>
5.连接对应的服务端地址<br>
6.sync阻塞住线程，连接好后再继续向下执行，否则就是异步进行连接</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> netty客户端 <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

		<span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token annotation punctuation">@Override</span>
					<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
						ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// inputStream</span>
						ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// 接收响应消息</span>
							<span class="token annotation punctuation">@Override</span>
							<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第4步：netty客户端接收到服务端返回的数据为：{}&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>

							<span class="token annotation punctuation">@Override</span>
							<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第1步：客户端启动触发事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;Hello NettyServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8099</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>服务端<br>
服务端代码格式和客户端差不多，最开始创建的Bootstrap对象变成了ServerBootstrap。同样的，核心逻辑在initChannel方法里面。</p> <p>StringEncoder和StringDecoder为一个编解码器，我调用的writeAndFlush方法是直接写入的字节，需要在服务端和客户端分别对该字节进行相同格式的编解码工作，才能够收到对应的数据信息</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> netty服务端 <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token annotation punctuation">@Override</span>
					<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
						ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

							<span class="token annotation punctuation">@Override</span>
							<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
								log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第2步：服务端接收消息：{}&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>

							<span class="token annotation punctuation">@Override</span>
							<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
								log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;第3步：服务端接收到消息后进行业务处理&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;Hello NettyClient&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>3、效果展示</p> <p>服务端：</p> <p><img src="./assets/img/image-20230218002835968.a48c66fb.png" alt="image-20230218002835968"></p> <p>客户端：</p> <p><img src="./assets/img/image-20230218002925604.581f8ba4.png" alt="image-20230218002925604"></p> <p>4、总结</p> <p>当你熟悉了Netty代码的编写风格之后，你会发现，我们想要对数据进行处理，只需要编写对应的ChannelHandler，其他的额外的关于数据的解析、读取等繁琐操作都被Netty封装了，即开发人员能够更加专注于业务开发，而非投身于繁琐的字节解析工作中。</p> <h4 id="aio-asynchronous-io"><a href="#aio-asynchronous-io" class="header-anchor">#</a> AIO（Asynchronous IO）</h4> <p>1、客户端</p> <blockquote><p>对应的Channel变成了AsynchronousSocketChannel</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AIOClient</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token class-name">AsynchronousSocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token class-name">AsynchronousSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;Hello AioServer&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Integer</span> len <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;客户端收到信息：&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>2.服务端</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AIOServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">AsynchronousServerSocketChannel</span> serverChannel <span class="token operator">=</span>
                <span class="token class-name">AsynchronousServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        serverChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AsynchronousSocketChannel</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">AsynchronousSocketChannel</span> socketChannel<span class="token punctuation">,</span> <span class="token class-name">Object</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 再此接收客户端连接，如果不写这行代码后面的客户端连接连不上服务端</span>
                    serverChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>attachment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>socketChannel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompletionHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completed</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> result<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;Hello AioClient&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> exc<span class="token punctuation">,</span> <span class="token class-name">Object</span> attachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                exc<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>3、效果展示</p> <p>演示的效果也很好理解，就是我们常规的理解的异步获取到数据。</p> <p>客户端：</p> <p><img src="./assets/img/image-20230218003205589.c4de9c5f.png" alt="image-20230218003205589"></p> <p>服务端：</p> <p><img src="./assets/img/image-20230218003227121.dbb68ed0.png" alt="image-20230218003227121"></p> <p>4、总结<br>
异步非阻塞， 由操作系统完成后回调通知服务端程序启动线程去处理， 一般适用于连接数较多且连接时间较长的应用，JDK7 开始支持。</p> <p>在Linux系统上，AIO的底层实现仍使用Epoll，没有很好实现AIO，因此在性能上没有明显的优势，而且被JDK封装了一层不容易深度优化，Linux上AIO还不够成熟。Netty是异步非阻塞框架，Netty在JDK的NIO上做了很多异步的封装。<br> <img src="data:image/png;base64,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" alt="image-20230218003407836"></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2023-7-19 7:18:59 ├F10: PM┤</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#前言" class="sidebar-link reco-side-前言" data-v-b57cc07c>前言</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#io模型的分类" class="sidebar-link reco-side-io模型的分类" data-v-b57cc07c>IO模型的分类</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#传统的io即bio" class="sidebar-link reco-side-传统的io即bio" data-v-b57cc07c>传统的IO即BIO</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#同步非阻塞io即nio" class="sidebar-link reco-side-同步非阻塞io即nio" data-v-b57cc07c>同步非阻塞IO即NIO</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#io多路复用-难点" class="sidebar-link reco-side-io多路复用-难点" data-v-b57cc07c>IO多路复用（难点）</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#io模型之信号驱动模型" class="sidebar-link reco-side-io模型之信号驱动模型" data-v-b57cc07c>IO模型之信号驱动模型</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#io-模型之异步io-aio" class="sidebar-link reco-side-io-模型之异步io-aio" data-v-b57cc07c>IO 模型之异步IO(AIO)</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#reactor三种模型" class="sidebar-link reco-side-reactor三种模型" data-v-b57cc07c>Reactor三种模型</a></li><li class="level-3" data-v-b57cc07c><a href="/./2023/06/10/%E7%BD%91%E7%BB%9Cio%E6%A8%A1%E5%9E%8B/#代码" class="sidebar-link reco-side-代码" data-v-b57cc07c>代码</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="./assets/js/app.764dede6.js" defer></script><script src="./assets/js/13.20e964b9.js" defer></script><script src="./assets/js/1.8757f81f.js" defer></script><script src="./assets/js/14.d0932ff0.js" defer></script><script src="./assets/js/34.ec572062.js" defer></script>
  </body>
</html>
