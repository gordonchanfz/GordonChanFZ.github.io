<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>geohash算法 | 个人博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="./favicon.ico">
    <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?55943ae09e5901d7a9f5705133737eec";
              var s = document.getElementsByTagName("script")[0];
              s.parentNode.insertBefore(hm, s);
            })();
           </script>
    <script src="https://hm.baidu.com/hm.js?xxxxxxxxxxx"></script>
    <meta name="description" content="会思考的芦苇。">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="./assets/css/0.styles.f4f644f3.css" as="style"><link rel="preload" href="./assets/js/app.764dede6.js" as="script"><link rel="preload" href="./assets/js/13.20e964b9.js" as="script"><link rel="preload" href="./assets/js/1.8757f81f.js" as="script"><link rel="preload" href="./assets/js/25.2fe13775.js" as="script"><link rel="preload" href="./assets/js/34.ec572062.js" as="script"><link rel="prefetch" href="./assets/js/10.36ed4133.js"><link rel="prefetch" href="./assets/js/11.18e1c33d.js"><link rel="prefetch" href="./assets/js/12.b32071c5.js"><link rel="prefetch" href="./assets/js/14.d0932ff0.js"><link rel="prefetch" href="./assets/js/15.7747d51d.js"><link rel="prefetch" href="./assets/js/16.487f9c88.js"><link rel="prefetch" href="./assets/js/17.9ae2b89b.js"><link rel="prefetch" href="./assets/js/18.801c9b12.js"><link rel="prefetch" href="./assets/js/19.867ef46b.js"><link rel="prefetch" href="./assets/js/20.ec371d7f.js"><link rel="prefetch" href="./assets/js/21.73f810bc.js"><link rel="prefetch" href="./assets/js/22.8c016772.js"><link rel="prefetch" href="./assets/js/23.9aa3d5ef.js"><link rel="prefetch" href="./assets/js/24.a6dcda10.js"><link rel="prefetch" href="./assets/js/26.2296389e.js"><link rel="prefetch" href="./assets/js/27.21f2d66f.js"><link rel="prefetch" href="./assets/js/28.3209357f.js"><link rel="prefetch" href="./assets/js/29.c7065b7f.js"><link rel="prefetch" href="./assets/js/3.9efa3b27.js"><link rel="prefetch" href="./assets/js/30.92914cc9.js"><link rel="prefetch" href="./assets/js/31.13c12633.js"><link rel="prefetch" href="./assets/js/32.b016f60e.js"><link rel="prefetch" href="./assets/js/33.ed48a654.js"><link rel="prefetch" href="./assets/js/35.5b55607b.js"><link rel="prefetch" href="./assets/js/36.f50b6e38.js"><link rel="prefetch" href="./assets/js/37.34409ac4.js"><link rel="prefetch" href="./assets/js/38.c7073f77.js"><link rel="prefetch" href="./assets/js/39.12f063e9.js"><link rel="prefetch" href="./assets/js/4.95c562bd.js"><link rel="prefetch" href="./assets/js/40.1bbd5377.js"><link rel="prefetch" href="./assets/js/41.6331a8cf.js"><link rel="prefetch" href="./assets/js/42.28acd6f5.js"><link rel="prefetch" href="./assets/js/43.905d2114.js"><link rel="prefetch" href="./assets/js/44.041132c5.js"><link rel="prefetch" href="./assets/js/45.d1a66b92.js"><link rel="prefetch" href="./assets/js/46.1c9100fe.js"><link rel="prefetch" href="./assets/js/47.3e75f768.js"><link rel="prefetch" href="./assets/js/48.7d7248fb.js"><link rel="prefetch" href="./assets/js/49.8d465809.js"><link rel="prefetch" href="./assets/js/5.a1a0df33.js"><link rel="prefetch" href="./assets/js/50.4aa56564.js"><link rel="prefetch" href="./assets/js/51.59674bf5.js"><link rel="prefetch" href="./assets/js/52.f3990683.js"><link rel="prefetch" href="./assets/js/53.092fe0ad.js"><link rel="prefetch" href="./assets/js/54.ac62e2a7.js"><link rel="prefetch" href="./assets/js/55.3530fa5a.js"><link rel="prefetch" href="./assets/js/56.6e9bc6f3.js"><link rel="prefetch" href="./assets/js/6.e534639a.js"><link rel="prefetch" href="./assets/js/7.bc868936.js"><link rel="prefetch" href="./assets/js/8.ce0f4f25.js"><link rel="prefetch" href="./assets/js/9.a57a9cf0.js">
    <link rel="stylesheet" href="./assets/css/0.styles.f4f644f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Gordon</h3> <p class="description" data-v-59e6cb88>会思考的芦苇。</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Gordon</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><img src="./logo.png" alt="个人博客" class="logo"> <span class="site-name">个人博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      计算引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./计算引擎/flink.html" class="nav-link"><i class="undefined"></i>
  flink
</a></li><li class="dropdown-item"><!----> <a href="/./计算引擎/spark.html" class="nav-link"><i class="undefined"></i>
  spark
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      存储引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./存储引擎/ElasticSearch.html" class="nav-link"><i class="undefined"></i>
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/hbase.html" class="nav-link"><i class="undefined"></i>
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/redis.html" class="nav-link"><i class="undefined"></i>
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      云原生
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./云原生/Docker.html" class="nav-link"><i class="undefined"></i>
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      中间件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./中间件/kafka.html" class="nav-link"><i class="undefined"></i>
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./中间件/Sqoop基本使用.html" class="nav-link"><i class="undefined"></i>
  Sqoop基本使用
</a></li></ul></div></div><div class="nav-item"><a href="/./tool/emoji/我的常用emoji.html" class="nav-link"><i class="undefined"></i>
  工具
</a></div><div class="nav-item"><a href="/./aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div> <a href="https://github.com/GordonChanFZ/gordonchanfz.github.io/" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="./avatar.jpeg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Gordon
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>30</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>47</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41><li class="social-item" data-v-1fad0c41><i class="iconfont reco-github" style="color:#e15b64;" data-v-1fad0c41></i></li></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      计算引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./计算引擎/flink.html" class="nav-link"><i class="undefined"></i>
  flink
</a></li><li class="dropdown-item"><!----> <a href="/./计算引擎/spark.html" class="nav-link"><i class="undefined"></i>
  spark
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      存储引擎
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./存储引擎/ElasticSearch.html" class="nav-link"><i class="undefined"></i>
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/hbase.html" class="nav-link"><i class="undefined"></i>
  hbase
</a></li><li class="dropdown-item"><!----> <a href="/./存储引擎/redis.html" class="nav-link"><i class="undefined"></i>
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      云原生
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./云原生/Docker.html" class="nav-link"><i class="undefined"></i>
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      中间件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./中间件/kafka.html" class="nav-link"><i class="undefined"></i>
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/./中间件/Sqoop基本使用.html" class="nav-link"><i class="undefined"></i>
  Sqoop基本使用
</a></li></ul></div></div><div class="nav-item"><a href="/./tool/emoji/我的常用emoji.html" class="nav-link"><i class="undefined"></i>
  工具
</a></div><div class="nav-item"><a href="/./aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div> <a href="https://github.com/GordonChanFZ/gordonchanfz.github.io/" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>geohash算法</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Gordon</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">geohash算法</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Gordon</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2019-9-8</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>索引</span><span class="tag-item" data-v-8a445198>空间索引</span><span class="tag-item" data-v-8a445198>附近的人</span></i></div></div> <div class="theme-reco-content content__default"><h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>用户附近位置如何计算？</p> <p>常见的很多app功能都有附近位置的计算，那是如何实现的？是通过两点经纬度距离计算？想快速了解附近100米的超市？遍历每个超市拿经纬度计算距离显然不合适。</p> <p>经纬度与物理距离介绍<br>
经纬度是经度与纬度的合称组成一个坐标系统，称为地理坐标系统，它是一种利用三度空间的球面来定义地球上的空间的球面坐标系统，能够标示地球上的任何一个位置。</p> <p><img src="./assets/img/57eb711c1d9cded841228b29b821eeba.d9478423.png" alt="img"></p> <p>在一定误差范围内，通常情况下，经纬线和米的换算为：经度或者纬度0.00001度，约等于1米。以下表格列出更细致的换算关系：</p> <table><thead><tr><th><strong>在纬度相等的情况下</strong></th> <th><strong>在经度相等的情况下</strong></th></tr></thead> <tbody><tr><td>经度每隔0.00001度，距离相差约1米；每隔0.0001度，距离相差约10米；每隔0.001度，距离相差约100米；每隔0.01度，距离相差约1000米；每隔0.1度，距离相差约10000米。</td> <td>纬度每隔0.00001度，距离相差约1.1米；每隔0.0001度，距离相差约11米；每隔0.001度，距离相差约111米；每隔0.01度，距离相差约1113米；每隔0.1度，距离相差约11132米。</td></tr></tbody></table> <h3 id="geohash算法介绍"><a href="#geohash算法介绍" class="header-anchor">#</a> Geohash算法介绍</h3> <p>GeoHash是<strong>空间索引</strong>的一种方式，其基本原理是将地球理解为一个二维平面，通过把二维的空间经纬度数据编码为一个字符串，可以<strong>把平面递归分解成更小的子块，每个子块在一定经纬度范围内拥有相同的编码。</strong></p> <p>以GeoHash方式建立空间索引，可以提高对空间poi数据进行经纬度检索的效率。</p> <p>编码规则为：先将纬度范围(-90, 90)平分成两个区间(-90, 0)和(0, 90)，如果目标维度位于前一个区间，则编码为0，否则编码为1，然后根据目标纬度所落的区间再平均分成两个区间进行编码，以此类推，直到精度满足要求，经度也用同样的算法，对(-180, 180)依次细分，然后合并经度和纬度的编码，<strong>奇数位放纬度，偶数位放经度</strong>，组成一串新的二进制编码，按照<strong>Base32</strong>进行编码。</p> <p><strong>示例</strong></p> <p>以当前所在办公区【两江国际】的位置坐标为例, <strong>经纬度为（104.059684，30.559545）</strong></p> <h3 id="第一步-将经纬度转换为二进制"><a href="#第一步-将经纬度转换为二进制" class="header-anchor">#</a> 第一步：将经纬度转换为二进制</h3> <table><thead><tr><th><strong>序号</strong></th> <th><strong>纬度范围</strong></th> <th><strong>划分区间0</strong></th> <th><strong>划分区间1</strong></th> <th><strong>30.559545所属区间</strong></th></tr></thead> <tbody><tr><td>1</td> <td>(-90, 90)</td> <td>(-90, 0.0)</td> <td>(0.0, 90)</td> <td>1</td></tr> <tr><td>2</td> <td>(0.0, 90)</td> <td>(0.0, 45.0)</td> <td>(45.0, 90)</td> <td>0</td></tr> <tr><td>3</td> <td>(0.0, 45.0)</td> <td>(0.0, 22.5)</td> <td>(22.5, 45.0)</td> <td>1</td></tr> <tr><td>4</td> <td>(22.5, 45.0)</td> <td>(22.5, 33.75)</td> <td>(33.75, 45.0)</td> <td>0</td></tr> <tr><td>5</td> <td>(22.5, 33.75)</td> <td>(22.5, 28.125)</td> <td>(28.125, 33.75)</td> <td>1</td></tr> <tr><td>6</td> <td>(28.125, 33.75)</td> <td>(28.125, 30.9375)</td> <td>(30.9375, 33.75)</td> <td>0</td></tr> <tr><td>7</td> <td>(28.125, 30.9375)</td> <td>(28.125, 29.53125)</td> <td>(29.53125, 30.9375)</td> <td>1</td></tr> <tr><td>8</td> <td>(29.53125, 30.9375)</td> <td>(29.53125, 30.234375)</td> <td>(30.234375, 30.9375)</td> <td>1</td></tr> <tr><td>9</td> <td>(30.234375, 30.9375)</td> <td>(30.234375, 30.5859375)</td> <td>(30.5859375, 30.9375)</td> <td>0</td></tr> <tr><td>10</td> <td>(30.234375, 30.5859375)</td> <td>(30.234375, 30.41015625)</td> <td>(30.41015625, 30.5859375)</td> <td>1</td></tr> <tr><td>11</td> <td>(30.41015625, 30.5859375)</td> <td>(30.41015625, 30.498046875)</td> <td>(30.498046875, 30.5859375)</td> <td>1</td></tr> <tr><td>12</td> <td>(30.498046875, 30.5859375)</td> <td>(30.498046875, 30.541992188)</td> <td>(30.541992188, 30.5859375)</td> <td>1</td></tr> <tr><td>13</td> <td>(30.541992188, 30.5859375)</td> <td>(30.541992188, 30.563964844)</td> <td>(30.563964844, 30.5859375)</td> <td>0</td></tr> <tr><td>14</td> <td>(30.541992188, 30.563964844)</td> <td>(30.541992188, 30.552978516)</td> <td>(30.552978516, 30.563964844)</td> <td>1</td></tr> <tr><td>15</td> <td>(30.552978516, 30.563964844)</td> <td>(30.552978516, 30.55847168)</td> <td>(30.55847168, 30.563964844)</td> <td>1</td></tr></tbody></table> <p>最后得到维度的二进制编码为：101010110111011, 用同样的方式可以得到精度(104.059684)的二进制编码：110010011111111。</p> <h3 id="第二步-将经纬度的二进制编码合并"><a href="#第二步-将经纬度的二进制编码合并" class="header-anchor">#</a> <strong>第二步：将经纬度的二进制编码合并</strong></h3> <p><strong>从偶数0开始，经度占偶数位，纬度占奇数位。</strong></p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>0</strong></th> <th><strong>1</strong></th> <th><strong>2</strong></th> <th><strong>3</strong></th> <th><strong>4</strong></th> <th><strong>5</strong></th> <th><strong>6</strong></th> <th><strong>7</strong></th> <th><strong>8</strong></th> <th><strong>9</strong></th> <th><strong>10</strong></th> <th><strong>11</strong></th> <th><strong>12</strong></th> <th><strong>13</strong></th> <th><strong>14</strong></th> <th><strong>15</strong></th> <th><strong>16</strong></th> <th><strong>17</strong></th> <th><strong>18</strong></th> <th><strong>19</strong></th> <th><strong>20</strong></th> <th><strong>21</strong></th> <th><strong>22</strong></th> <th><strong>23</strong></th> <th><strong>24</strong></th> <th><strong>25</strong></th> <th><strong>26</strong></th> <th><strong>27</strong></th> <th><strong>28</strong></th> <th><strong>29</strong></th></tr></thead> <tbody><tr><td><strong>编码</strong></td> <td>1</td> <td>1</td> <td>1</td> <td>0</td> <td>0</td> <td>1</td> <td>0</td> <td>0</td> <td>1</td> <td>1</td> <td>0</td> <td>0</td> <td>0</td> <td>1</td> <td>1</td> <td>1</td> <td>1</td> <td>0</td> <td>1</td> <td>1</td> <td>1</td> <td>1</td> <td>1</td> <td>1</td> <td>1</td> <td>0</td> <td>1</td> <td>1</td> <td>1</td> <td>1</td></tr></tbody></table> <h3 id="第三步-将合并后的二进制数做base32编码"><a href="#第三步-将合并后的二进制数做base32编码" class="header-anchor">#</a> 第三步：将合并后的二进制数做Base32编码</h3> <p><strong>按照每5位一组，分成6组，每组计算其对应的十进制数值，按照Base32进行编码。</strong></p> <p>Base32编码表的其中一种如下，是用0-9、b-z（去掉a, i, l, o）这32个字母进行编码.</p> <p><img src="./assets/img/image-20230315022500048.ed8efde2.png" alt="image-20230315022500048"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">11100</span> <span class="token number">10011</span> <span class="token number">00011</span> <span class="token number">11011</span> <span class="token number">11111</span> <span class="token number">01111</span>
<span class="token function">28</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token function">19</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token function">3</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token function">27</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token function">31</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token function">15</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>最终得到的经纬度编码为：wm3vzg</strong></p> <p>如上文二进制编码的计算过程，如果<strong>递归的次数越大，则生成的二进制编码越长</strong>，因此生成的geohash编码越长，<strong>位置越精确</strong>。目前<strong>Geohash</strong>使用的精度说明如下：</p> <p><img src="./assets/img/8eb57262b9cfb26dc94646465d72533c.9ac5a11b.png" alt="img"></p> <p>GeoHash用一个字符串表示经度和纬度两个坐标, 比直接用经纬度的高效很多，而且使用者可以发布地址编码，既能表明自己位于某位置附近，又不至于暴露自己的精确坐标，有助于隐私保护。</p> <p><strong>编码过程中，通过二分范围匹配的方式来决定某个经纬坐标是编码为1还是0，因此某些邻近坐标的编码是相同的，因此GeoHash表示的并不是一个点，而是一个矩形区域。 GeoHash编码的前缀可以表示更大的区域。例如wm3vzg，它的前缀wm3vz表示包含编码wm3vzg在内的更大范围。 这个特性可以用于附近地点搜索。</strong></p> <h3 id="网格与实际地理的精度"><a href="#网格与实际地理的精度" class="header-anchor">#</a> 网格与实际地理的精度</h3> <p>如果把某个区域或整个地图上的地理位置都按照Geohash编码，则会得到一个网格，编码递归粒度越细，网格的矩形区域越小，geohash编码的长度越大，则Geohash编码越精确。 不同的编码长度，生成的网格与实际地理的精度如下(Geohash字符串编码长度对应网格大小）:</p> <table><thead><tr><th><strong>字符串长度</strong></th> <th><strong>网格宽度</strong></th> <th><strong>网格高度</strong></th></tr></thead> <tbody><tr><td>1</td> <td>5000Km</td> <td>5000Km</td></tr> <tr><td>2</td> <td>1250Km</td> <td>625Km</td></tr> <tr><td>3</td> <td>156Km</td> <td>156Km</td></tr> <tr><td>4</td> <td>39.1Km</td> <td>19.5Km</td></tr> <tr><td>5</td> <td>4.89Km</td> <td>4.89Km</td></tr> <tr><td><strong>6</strong></td> <td><strong>1.22Km</strong></td> <td><strong>0.61Km</strong></td></tr> <tr><td><strong>7</strong></td> <td><strong>153m</strong></td> <td><strong>153m</strong></td></tr> <tr><td><strong>8</strong></td> <td>38.2m</td> <td><strong>19.1m</strong></td></tr> <tr><td>9</td> <td>4.77m</td> <td>4.77m</td></tr> <tr><td>10</td> <td>1.19m</td> <td>0.596m</td></tr></tbody></table> <p>Geohash编码与网格</p> <p>当前选取的编码长度为6，因此一个网格实际的地理差异在1.2公里与0.6公里，示例中两江国际对应的网格大致效果如图：</p> <p><img src="./assets/img/b6c5b5530af147249e9a870f076f9978-1678818658611.5136befa.png" alt="img"></p> <h3 id="使用geohash算法推算附近位置的弊端"><a href="#使用geohash算法推算附近位置的弊端" class="header-anchor">#</a> 使用geohash算法推算附近位置的弊端</h3> <p><img src="./assets/img/image-20230624011131681.cc1fd4a4.png" alt="image-20230624011131681"></p> <h3 id="邻近-8个-网格位置推算"><a href="#邻近-8个-网格位置推算" class="header-anchor">#</a> <strong>邻近(8个)网格位置推算</strong></h3> <p><strong>结论</strong><br>
根据Geohash的编码规则将经纬度分解到二进制，结合地理常识，**中心网格在南北（上下）方向上体现为纬度的变化，往北则维度的二进制加1，往南则维度的二进制减1，在东西（左右）方向上体现为经度的变化，往东则经度的二进制加1，往西则减1，**可以计算出上下左右四个网格经纬度的二进制编码，再将加减得出的经纬度两两组合，计算出左上、左下、右上和右下四个网格的经纬度二进制编码，从而就可以根据Geohash的编码规则计算出周围八个网格的字符串。</p> <h3 id="正向推导"><a href="#正向推导" class="header-anchor">#</a> 正向推导</h3> <p>以Geohash编码长度为6为基础，网格的宽高与实际距离换算为：1.2Km*0.6Km.</p> <p>参考上文提到的，在经度相同情况下，每隔0.001度，距离相差约111米。0.6Km换算为纬度为：0.005405405。</p> <p>当前两江国际粗粒度的wgs84坐标(<strong>104.05503，30.562251),</strong> 纬度二进制编码：101010110111011，经度二进制编码：110010011111111, Geohash值为：wm3vzg</p> <p>正北方向近邻的网格维度为增加一个网格的高度，即纬度增加0.005405405，为：<strong>30.562251 +</strong> 0.005405405 = 30.567656405， 转换为二进制编码后为(可用工具快速转换)：<strong>101010110111100</strong></p> <p><strong>正好是原纬度的二进制编码101010110111011 加1后的结果（101010110111011 + 000000000000001</strong> = <strong>101010110111100）</strong></p> <h3 id="反向推导"><a href="#反向推导" class="header-anchor">#</a> 反向推导</h3> <p>当前两江国际粗粒度的wgs84坐标(<strong>104.05503，30.562251),</strong> 纬度二进制编码：101010110111011，经度二进制编码：110010011111111, Geohash值为：wm3vzg</p> <p>基于当前坐标的网格，正北方向近邻的网格N，其纬度二进制加1后为：101010110111100，经度不变，其Geohash值为：<strong>wm3vzu</strong></p> <p>通过http://geohash.co/ 反向转换其经纬坐标为：(104.0570068359375,30.56671142578125）</p> <p>通过https://www.box3.cn/tools/lbs.html 查询2个坐标的实际位置，误差在531m(符合精度范围）</p> <p><img src="./assets/img/d34fee6fe2a510de033a1c103a952c4d.f6868af8.png" alt="img"></p> <p>邻近8个网格位置计算</p> <table><thead><tr><th>**<em>*Geohash编码：*<em>wm3vzs纬度二进制编码：101010110111100经度二进制编码：110010011111110公式：(Lat_bin + 1, Lon_bin - 1)</em></em></th> <th>**<em>*Geohash编码：*<em>wm3vzu纬度二进制编码：101010110111100经度二进制编码：110100101101010公式：(Lat_bin + 1, Lon_bin)</em></em></th> <th>**<em>*Geohash编码：*<em>wm6jbh纬度二进制编码：101010110111100经度二进制编码：110010100000000公式：(Lat_bin + 1, Lon_bin + 1)</em></em></th></tr></thead> <tbody><tr><td>**Geohash编码：**wm3vze纬度二进制编码：101010110111011经度二进制编码：110010011111110公式：(Lat_bin, Lon_bin - 1)</td> <td>**Geohash编码：**wm3vzg纬度二进制编码：101010110111011经度二进制编码：110010011111111公式：(Lat_bin, Lon_bin)</td> <td>**Geohash编码：**wm6jb5纬度二进制编码：101010110111011经度二进制编码：110010100000000公式：(Lat_bin, Lon_bin + 1)</td></tr> <tr><td>**Geohash编码：**wm3vzd纬度二进制编码：101010110111010经度二进制编码：110010011111110公式：(Lat_bin - 1, Lon_bin - 1)</td> <td>**Geohash编码：**wm3vzf纬度二进制编码：101010110111010经度二进制编码：110010011111111公式：(Lat_bin - 1, Lon_bin)</td> <td>**Geohash编码：**wm6jb4纬度二进制编码：101010110111010经度二进制编码：110010100000000公式：(Lat_bin - 1, Lon_bin + 1)</td></tr></tbody></table> <p>附近3公里网格模型</p> <p><img src="./assets/img/dc83cf2c5b09437938234726ca167a3e.6e1bacd4.png" alt="img"></p> <p><img src="./assets/img/image-20230315031553823.a41e7023.png" alt="image-20230315031553823"></p> <h3 id="geohash进阶原理-z阶曲线"><a href="#geohash进阶原理-z阶曲线" class="header-anchor">#</a> geohash进阶原理（Z阶曲线)</h3> <p>上文讲了GeoHash的计算步骤，仅仅说明是什么而没有说明为什么？为什么分别给经度和维度编码？为什么需要将经纬度两串编码<strong>交叉组合</strong>成一串编码？本节试图回答这一问题。</p> <p>如下图所示，我们将二进制编码的结果填写到空间中，当将空间划分为四块时候，编码的顺序分别是左下角00，左上角01，右下脚10，右上角11，也就是类似于Z的曲线，当我们递归的将各个块分解成更小的子块时，编码的顺序是自相似的（分形），每一个子快也形成Z曲线，这种类型的曲线被称为 Peano 空间填充曲线。</p> <p>这种类型的空间填充曲线的优点是将二维空间转换成一维曲线（事实上是分形维），对大部分而言，编码相似的距离也相近， 但Peano空间填充曲线最大的缺点就是<strong>突变性</strong>，有些编码相邻但距离却相差很远，比如<strong>0111与1000</strong>，编码是相邻的，但距离相差很大。</p> <p><img src="./assets/img/6f061d950a7b02080c4a5e7fd6dd51d4562cc8bd.a5920ab9.png" alt="img"></p> <p>除 Peano 空间填充曲线外，还有很多空间填充曲线，如图所示，其中效果公认较好是 <strong>Hilbert</strong> 空间填充曲线，相较于 Peano 曲线而言，Hilbert 曲线<strong>没有较大的突变</strong>。为什么 GeoHash 不选择 Hilbert 空间填充曲线呢？可能是 Peano曲线思路以及计算上比较简单吧，事实上，Peano 曲线就是一种<strong>四叉树线性编码方式。</strong></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2023-6-24 2:06:37 ├F10: AM┤</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#前言" class="sidebar-link reco-side-前言" data-v-b57cc07c>前言</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#geohash算法介绍" class="sidebar-link reco-side-geohash算法介绍" data-v-b57cc07c>Geohash算法介绍</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#第一步-将经纬度转换为二进制" class="sidebar-link reco-side-第一步-将经纬度转换为二进制" data-v-b57cc07c>第一步：将经纬度转换为二进制</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#第二步-将经纬度的二进制编码合并" class="sidebar-link reco-side-第二步-将经纬度的二进制编码合并" data-v-b57cc07c>第二步：将经纬度的二进制编码合并</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#第三步-将合并后的二进制数做base32编码" class="sidebar-link reco-side-第三步-将合并后的二进制数做base32编码" data-v-b57cc07c>第三步：将合并后的二进制数做Base32编码</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#网格与实际地理的精度" class="sidebar-link reco-side-网格与实际地理的精度" data-v-b57cc07c>网格与实际地理的精度</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#使用geohash算法推算附近位置的弊端" class="sidebar-link reco-side-使用geohash算法推算附近位置的弊端" data-v-b57cc07c>使用geohash算法推算附近位置的弊端</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#邻近-8个-网格位置推算" class="sidebar-link reco-side-邻近-8个-网格位置推算" data-v-b57cc07c>邻近(8个)网格位置推算</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#正向推导" class="sidebar-link reco-side-正向推导" data-v-b57cc07c>正向推导</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#反向推导" class="sidebar-link reco-side-反向推导" data-v-b57cc07c>反向推导</a></li><li class="level-3" data-v-b57cc07c><a href="/./2019/09/08/geohash%E7%AE%97%E6%B3%95/#geohash进阶原理-z阶曲线" class="sidebar-link reco-side-geohash进阶原理-z阶曲线" data-v-b57cc07c>geohash进阶原理（Z阶曲线)</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="./assets/js/app.764dede6.js" defer></script><script src="./assets/js/13.20e964b9.js" defer></script><script src="./assets/js/1.8757f81f.js" defer></script><script src="./assets/js/25.2fe13775.js" defer></script><script src="./assets/js/34.ec572062.js" defer></script>
  </body>
</html>
