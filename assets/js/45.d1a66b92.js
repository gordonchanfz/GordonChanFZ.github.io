(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1581:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一、sqoop-基本命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、sqoop-基本命令"}},[s._v("#")]),s._v(" 一、Sqoop 基本命令")]),s._v(" "),a("h3",{attrs:{id:"_1-查看所有命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看所有命令"}},[s._v("#")]),s._v(" 1. 查看所有命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sqoop help")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-查看某条命令的具体使用方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看某条命令的具体使用方法"}},[s._v("#")]),s._v(" 2. 查看某条命令的具体使用方法")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sqoop help 命令名")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"二、sqoop-与-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、sqoop-与-mysql"}},[s._v("#")]),s._v(" 二、Sqoop 与 MySQL")]),s._v(" "),a("h3",{attrs:{id:"_1-查询mysql所有数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查询mysql所有数据库"}},[s._v("#")]),s._v(" 1. 查询MySQL所有数据库")]),s._v(" "),a("p",[s._v("通常用于 Sqoop 与 MySQL 连通测试：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop list-databases "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_2-查询指定数据库中所有数据表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-查询指定数据库中所有数据表"}},[s._v("#")]),s._v(" 2. 查询指定数据库中所有数据表")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop list-tables "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"三、sqoop-与-hdfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、sqoop-与-hdfs"}},[s._v("#")]),s._v(" 三、Sqoop 与 HDFS")]),s._v(" "),a("h3",{attrs:{id:"_3-1-mysql数据导入到hdfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-mysql数据导入到hdfs"}},[s._v("#")]),s._v(" 3.1 MySQL数据导入到HDFS")]),s._v(" "),a("h4",{attrs:{id:"_1-导入命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-导入命令"}},[s._v("#")]),s._v(" 1. 导入命令")]),s._v(" "),a("p",[s._v("示例：导出 MySQL 数据库中的 "),a("code",[s._v("help_keyword")]),s._v(" 表到 HDFS 的 "),a("code",[s._v("/sqoop")]),s._v(" 目录下，如果导入目录存在则先删除再导入，使用 3 个 "),a("code",[s._v("map tasks")]),s._v(" 并行导入。")]),s._v(" "),a("blockquote",[a("p",[s._v("注：help_keyword 是 MySQL 内置的一张字典表，之后的示例均使用这张表。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("     \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--table")]),s._v(" help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 待导入的表")]),s._v("\n--delete-target-dir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目标目录存在则先删除")]),s._v("\n--target-dir /sqoop "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入的目标目录")]),s._v("\n--fields-terminated-by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定导出数据的分隔符")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定并行执行的 map tasks 数量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("日志输出如下，可以看到输入数据被平均 "),a("code",[s._v("split")]),s._v(" 为三份，分别由三个 "),a("code",[s._v("map task")]),s._v(" 进行处理。数据默认以表的主键列作为拆分依据，如果你的表没有主键，有以下两种方案：")]),s._v(" "),a("ul",[a("li",[s._v("添加 "),a("code",[s._v("-- autoreset-to-one-mapper")]),s._v(" 参数，代表只启动一个 "),a("code",[s._v("map task")]),s._v("，即不并行执行；")]),s._v(" "),a("li",[s._v("若仍希望并行执行，则可以使用 "),a("code",[s._v("--split-by <column-name>")]),s._v(" 指明拆分数据的参考列。")])]),s._v(" "),a("h4",{attrs:{id:"_2-导入验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入验证"}},[s._v("#")]),s._v(" 2. 导入验证")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看导入后的目录")]),s._v("\nhadoop fs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ls")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" /sqoop\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看导入内容")]),s._v("\nhadoop fs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-text")]),s._v("  /sqoop/part-m-00000\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查看 HDFS 导入目录,可以看到表中数据被分为 3 部分进行存储，这是由指定的并行度决定的。")]),s._v(" "),a("h3",{attrs:{id:"_3-2-hdfs数据导出到mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-hdfs数据导出到mysql"}},[s._v("#")]),s._v(" 3.2 HDFS数据导出到MySQL")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--table")]),s._v(" help_keyword_from_hdfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出数据存储在 MySQL 的 help_keyword_from_hdf 的表中")]),s._v("\n    --export-dir /sqoop  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --input-fields-terminated-by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("表必须预先创建，建表语句如下：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" help_keyword_from_hdfs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"四、sqoop-与-hive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、sqoop-与-hive"}},[s._v("#")]),s._v(" 四、Sqoop 与 Hive")]),s._v(" "),a("h3",{attrs:{id:"_4-1-mysql数据导入到hive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-mysql数据导入到hive"}},[s._v("#")]),s._v(" 4.1 MySQL数据导入到Hive")]),s._v(" "),a("p",[s._v("Sqoop 导入数据到 Hive 是通过先将数据导入到 HDFS 上的临时目录，然后再将数据从 HDFS 上 "),a("code",[s._v("Load")]),s._v(" 到 Hive 中，最后将临时目录删除。可以使用 "),a("code",[s._v("target-dir")]),s._v(" 来指定临时目录。")]),s._v(" "),a("h4",{attrs:{id:"_1-导入命令-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-导入命令-2"}},[s._v("#")]),s._v(" 1. 导入命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--table")]),s._v(" help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 待导入的表     ")]),s._v("\n  --delete-target-dir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果临时目录存在删除")]),s._v("\n  --target-dir /sqoop_hive  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时目录位置")]),s._v("\n  --hive-database sqoop_test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入到 Hive 的 sqoop_test 数据库，数据库需要预先创建。不指定则默认为 default 库")]),s._v("\n  --hive-import "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入到 Hive")]),s._v("\n  --hive-overwrite "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果 Hive 表中有数据则覆盖，这会清除表中原有的数据，然后再写入")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并行度")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("导入到 Hive 中的 "),a("code",[s._v("sqoop_test")]),s._v(" 数据库需要预先创建，不指定则默认使用 Hive 中的 "),a("code",[s._v("default")]),s._v(" 库。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 hive 中的所有数据库")]),s._v("\n hive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  SHOW DATABASES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 sqoop_test 数据库")]),s._v("\n hive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  CREATE DATABASE sqoop_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_2-导入验证-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入验证-2"}},[s._v("#")]),s._v(" 2. 导入验证")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 sqoop_test 数据库的所有表")]),s._v("\n hive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  SHOW  TABLES  IN  sqoop_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看表中数据")]),s._v("\n hive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT * FROM sqoop_test.help_keyword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_3-可能出现的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-可能出现的问题"}},[s._v("#")]),s._v(" 3. 可能出现的问题")]),s._v(" "),a("p",[s._v("如果执行报错 "),a("code",[s._v("java.io.IOException: java.lang.ClassNotFoundException: org.apache.hadoop.hive.conf.HiveConf")]),s._v("，则需将 Hive 安装目录下 "),a("code",[s._v("lib")]),s._v(" 下的 "),a("code",[s._v("hive-exec-**.jar")]),s._v(" 放到 sqoop 的 "),a("code",[s._v("lib")]),s._v(" 。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop001 lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll hive-exec-*")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1106")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19632031")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" 月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":45 hive-exec-1.1.0-cdh5.15.2.jar\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop001 lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp hive-exec-1.1.0-cdh5.15.2.jar  ${SQOOP_HOME}/lib")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("br"),s._v(" "),a("h3",{attrs:{id:"_4-2-hive-导出数据到mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-hive-导出数据到mysql"}},[s._v("#")]),s._v(" 4.2 Hive 导出数据到MySQL")]),s._v(" "),a("p",[s._v("由于 Hive 的数据是存储在 HDFS 上的，所以 Hive 导入数据到 MySQL，实际上就是 HDFS 导入数据到 MySQL。")]),s._v(" "),a("h4",{attrs:{id:"_1-查看hive表在hdfs的存储位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看hive表在hdfs的存储位置"}},[s._v("#")]),s._v(" 1. 查看Hive表在HDFS的存储位置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入对应的数据库")]),s._v("\nhive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use sqoop_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看表信息")]),s._v("\nhive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" desc formatted help_keyword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("code",[s._v("Location")]),s._v(" 属性为其存储位置：")]),s._v(" "),a("p",[s._v("这里可以查看一下这个目录，文件结构如下：")]),s._v(" "),a("h4",{attrs:{id:"_3-2-执行导出命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-执行导出命令"}},[s._v("#")]),s._v(" 3.2 执行导出命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--table")]),s._v(" help_keyword_from_hive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --export-dir /user/hive/warehouse/sqoop_test.db/help_keyword  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -input-fields-terminated-by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\001'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要注意的是 hive 中默认的分隔符为 \\001")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("MySQL 中的表需要预先创建：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" help_keyword_from_hive "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"五、sqoop-与-hbase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、sqoop-与-hbase"}},[s._v("#")]),s._v(" 五、Sqoop 与 HBase")]),s._v(" "),a("blockquote",[a("p",[s._v("本小节只讲解从 RDBMS 导入数据到 HBase，因为暂时没有命令能够从 HBase 直接导出数据到 RDBMS。")])]),s._v(" "),a("h3",{attrs:{id:"_5-1-mysql导入数据到hbase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-mysql导入数据到hbase"}},[s._v("#")]),s._v(" 5.1 MySQL导入数据到HBase")]),s._v(" "),a("h4",{attrs:{id:"_1-导入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-导入数据"}},[s._v("#")]),s._v(" 1. 导入数据")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("help_keyword")]),s._v(" 表中数据导入到 HBase 上的 "),a("code",[s._v("help_keyword_hbase")]),s._v(" 表中，使用原表的主键 "),a("code",[s._v("help_keyword_id")]),s._v(" 作为 "),a("code",[s._v("RowKey")]),s._v("，原表的所有列都会在 "),a("code",[s._v("keywordInfo")]),s._v(" 列族下，目前只支持全部导入到一个列族下，不支持分别指定列族。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--table")]),s._v(" help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 待导入的表")]),s._v("\n    --hbase-table help_keyword_hbase "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hbase 表名称，表需要预先创建")]),s._v("\n    --column-family keywordInfo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有列导入到 keywordInfo 列族下 ")]),s._v("\n    --hbase-row-key help_keyword_id     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用原表的 help_keyword_id 作为 RowKey")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("导入的 HBase 表需要预先创建：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有表")]),s._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" list\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建表")]),s._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help_keyword_hbase'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keywordInfo'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看表信息")]),s._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" desc "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help_keyword_hbase'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_2-导入验证-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入验证-3"}},[s._v("#")]),s._v(" 2. 导入验证")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("scan")]),s._v(" 查看表数据：")]),s._v(" "),a("h2",{attrs:{id:"六、全库导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、全库导出"}},[s._v("#")]),s._v(" 六、全库导出")]),s._v(" "),a("p",[s._v("Sqoop 支持通过 "),a("code",[s._v("import-all-tables")]),s._v(" 命令进行全库导出到 HDFS/Hive，但需要注意有以下两个限制：")]),s._v(" "),a("ul",[a("li",[s._v("所有表必须有主键；或者使用 "),a("code",[s._v("--autoreset-to-one-mapper")]),s._v("，代表只启动一个 "),a("code",[s._v("map task")]),s._v(";")]),s._v(" "),a("li",[s._v("你不能使用非默认的分割列，也不能通过 WHERE 子句添加任何限制。")])]),s._v(" "),a("blockquote",[a("p",[s._v("第二点解释得比较拗口，这里列出官方原本的说明：")]),s._v(" "),a("ul",[a("li",[s._v("You must not intend to use non-default splitting column, nor impose any conditions via a "),a("code",[s._v("WHERE")]),s._v(" clause.")])])]),s._v(" "),a("p",[s._v("全库导出到 HDFS：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop import-all-tables "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/数据库名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --warehouse-dir  /sqoop_all "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个表会单独导出到一个目录，需要用此参数指明所有目录的父目录")]),s._v("\n    --fields-terminated-by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("全库导出到 Hive：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop import-all-tables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dorg.apache.sqoop.splitter.allow_text_splitter")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/数据库名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --hive-database sqoop_test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出到 Hive 对应的库   ")]),s._v("\n  --hive-import "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --hive-overwrite "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"七、sqoop-数据过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、sqoop-数据过滤"}},[s._v("#")]),s._v(" 七、Sqoop 数据过滤")]),s._v(" "),a("h3",{attrs:{id:"_7-1-query参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-query参数"}},[s._v("#")]),s._v(" 7.1 query参数")]),s._v(" "),a("p",[s._v("Sqoop 支持使用 "),a("code",[s._v("query")]),s._v(" 参数定义查询 SQL，从而可以导出任何想要的结果集。sqoop暂不支持export +query使用示例如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--query")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'select * from help_keyword where  $CONDITIONS and  help_keyword_id < 50'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  \n  --delete-target-dir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("            \n  --target-dir /sqoop_hive  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n  --hive-database sqoop_test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定导入目标数据库 不指定则默认使用 Hive 中的 default 库")]),s._v("\n  --hive-table filter_help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定导入目标表")]),s._v("\n  --split-by help_keyword_id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定用于 split 的列      ")]),s._v("\n  --hive-import "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入到 Hive")]),s._v("\n  --hive-overwrite "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("                     、\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("在使用 "),a("code",[s._v("query")]),s._v(" 进行数据过滤时，需要注意以下三点：")]),s._v(" "),a("ul",[a("li",[s._v("必须用 "),a("code",[s._v("--hive-table")]),s._v(" 指明目标表；")]),s._v(" "),a("li",[s._v("如果并行度 "),a("code",[s._v("-m")]),s._v(" 不为 1 或者没有指定 "),a("code",[s._v("--autoreset-to-one-mapper")]),s._v("，则需要用 "),a("code",[s._v("--split-by")]),s._v(" 指明参考列；")]),s._v(" "),a("li",[s._v("SQL 的 "),a("code",[s._v("where")]),s._v(" 字句必须包含 "),a("code",[s._v("$CONDITIONS")]),s._v("，这是固定写法，作用是动态替换。")])]),s._v(" "),a("h3",{attrs:{id:"_7-2-增量导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-增量导入"}},[s._v("#")]),s._v(" 7.2 增量导入")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sqoop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--connect")]),s._v(" jdbc:mysql://hadoop001:3306/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--table")]),s._v(" help_keyword "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --target-dir /sqoop_hive  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --hive-database sqoop_test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("         \n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--incremental")]),s._v("  append  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指明模式")]),s._v("\n    --check-column  help_keyword_id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指明用于增量导入的参考列")]),s._v("\n    --last-value "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定参考列上次导入的最大值")]),s._v("\n    --hive-import "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("   \n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("code",[s._v("incremental")]),s._v(" 参数有以下两个可选的选项：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("append")]),s._v("：要求参考列的值必须是递增的，所有大于 "),a("code",[s._v("last-value")]),s._v(" 的值都会被导入；")]),s._v(" "),a("li",[a("strong",[s._v("lastmodified")]),s._v("：要求参考列的值必须是 "),a("code",[s._v("timestamp")]),s._v(" 类型，且插入数据时候要在参考列插入当前时间戳，更新数据时也要更新参考列的时间戳，所有时间晚于 "),a("code",[s._v("last-value")]),s._v(" 的数据都会被导入。")])]),s._v(" "),a("p",[s._v("通过上面的解释我们可以看出来，其实 Sqoop 的增量导入并没有太多神器的地方，就是依靠维护的参考列来判断哪些是增量数据。当然我们也可以使用上面介绍的 "),a("code",[s._v("query")]),s._v(" 参数来进行手动的增量导入，这样反而更加灵活。")]),s._v(" "),a("h2",{attrs:{id:"八、类型支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、类型支持"}},[s._v("#")]),s._v(" 八、类型支持")]),s._v(" "),a("p",[s._v("Sqoop 默认支持数据库的大多数字段类型，但是某些特殊类型是不支持的。遇到不支持的类型，程序会抛出异常 "),a("code",[s._v("Hive does not support the SQL type for column xxx")]),s._v(" 异常，此时可以通过下面两个参数进行强制类型转换：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("--map-column-java<mapping>")]),s._v("   ：重写 SQL 到 Java 类型的映射；")]),s._v(" "),a("li",[a("strong",[s._v("--map-column-hive <mapping>")]),s._v(" ： 重写 Hive 到 Java 类型的映射。")])]),s._v(" "),a("p",[s._v("示例如下，将原先 "),a("code",[s._v("id")]),s._v(" 字段强制转为 String 类型，"),a("code",[s._v("value")]),s._v(" 字段强制转为 Integer 类型：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sqoop import ... --map-column-java id=String,value=Integer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("导入和导出的目标表不能有数据。")]),s._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sqoop User Guide (v1.4.7)"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);