(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1575:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-docker-的介绍和安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-的介绍和安装"}},[s._v("#")]),s._v(" 1. Docker 的介绍和安装")]),s._v(" "),a("h3",{attrs:{id:"容器技术的介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器技术的介绍"}},[s._v("#")]),s._v(" 容器技术的介绍")]),s._v(" "),a("p",[s._v("注意我们这里所说的容器container是指的一种技术，而Docker只是一个容器技术的实现，或者说让容器技术普及开来的最成功的实现")]),s._v(" "),a("p",[a("strong",[s._v("容器正在引领基础架构的一场新的革命")])]),s._v(" "),a("ul",[a("li",[s._v("90年代的PC")]),s._v(" "),a("li",[s._v("00年代的虚拟化")]),s._v(" "),a("li",[s._v("10年代的cloud")]),s._v(" "),a("li",[s._v("11年代的container")])]),s._v(" "),a("p",[a("strong",[s._v("什么是container(容器）？")])]),s._v(" "),a("p",[s._v("容器是一种快速的打包技术")]),s._v(" "),a("p",[s._v("Package Software into Standardized Units for Development, Shipment and Deployment")]),s._v(" "),a("ul",[a("li",[s._v("标准化")]),s._v(" "),a("li",[s._v("轻量级")]),s._v(" "),a("li",[s._v("易移植")])]),s._v(" "),a("p",[a("strong",[s._v("为什么容器技术会出现？")])]),s._v(" "),a("p",[s._v("容器技术出现之前")]),s._v(" "),a("p",[a("img",{attrs:{src:t(515),alt:"why_container1"}})]),s._v(" "),a("p",[s._v("容器技术出现之后")]),s._v(" "),a("p",[a("img",{attrs:{src:t(516),alt:"why_container2"}})]),s._v(" "),a("p",[s._v("容器 vs 虚拟机")]),s._v(" "),a("p",[a("img",{attrs:{src:t(517),alt:"container_vs_vm"}})]),s._v(" "),a("p",[s._v("Linux Container容器技术的诞生于2008年（Docker诞生于2013年），解决了IT世界里“集装箱运输”的问题。Linux Container（简称LXC）它是一种内核轻量级的操作系统层虚拟化技术。Linux Container主要由Namespace 和Cgroups  两大机制来保证实现")]),s._v(" "),a("ul",[a("li",[s._v("Namespace命名空间主要用于资源的隔离（诞生于2002年）")]),s._v(" "),a("li",[s._v("Cgroups(Control Groups)就负责资源管理控制作用，比如进程组使用CPU/MEM的限制，进程组的优先级控制，进程组的挂起和恢复等等。（由Google贡献，2008年合并到了Linux Kernel）")])]),s._v(" "),a("p",[a("strong",[s._v("容器的标准化")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker != container\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在2015年，由Google，Docker、红帽等厂商联合发起了OCI（Open Container Initiative）组织，致力于容器技术的标准化")]),s._v(" "),a("p",[a("strong",[s._v("容器运行时标准 （runtime spec）")])]),s._v(" "),a("p",[s._v("简单来讲就是规定了容器的基本操作规范，比如如何下载镜像，创建容器，启动容器等。")]),s._v(" "),a("p",[a("strong",[s._v("容器镜像标准（image spec）")])]),s._v(" "),a("p",[s._v("主要定义镜像的基本格式。")]),s._v(" "),a("p",[a("strong",[s._v("容器是关乎“速度”")])]),s._v(" "),a("ul",[a("li",[s._v("容器会加速你的软件开发")]),s._v(" "),a("li",[s._v("容器会加速你的程序编译和构建")]),s._v(" "),a("li",[s._v("容器会加速你的测试")]),s._v(" "),a("li",[s._v("容器会速度你的部署")]),s._v(" "),a("li",[s._v("容器会加速你的更新")]),s._v(" "),a("li",[s._v("容器会速度你的故障恢复")])]),s._v(" "),a("p",[a("strong",[s._v("容器的快速发展和普及")])]),s._v(" "),a("p",[s._v("到2020年，全球超过50%的公司将在生产环境中使用container —— Gartner")]),s._v(" "),a("p",[a("img",{attrs:{src:t(518),alt:"dockerhub2020"}})]),s._v(" "),a("h3",{attrs:{id:"在-linux-系统上安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-linux-系统上安装-docker"}},[s._v("#")]),s._v(" 在 Linux 系统上安装 Docker")]),s._v(" "),a("p",[s._v("使用脚本快速安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载安装脚本到get-dcoker.sh,version为可选")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fsSL")]),s._v(" get.docker.com "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" get-docker.sh  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" get-docker.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VERSION"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确认是否安装成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:t(519),alt:"image-20230613194139663"}})]),s._v(" "),a("h2",{attrs:{id:"_2-容器的快速上手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-容器的快速上手"}},[s._v("#")]),s._v(" 2.容器的快速上手")]),s._v(" "),a("h3",{attrs:{id:"docker命令行的认识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker命令行的认识"}},[s._v("#")]),s._v(" docker命令行的认识")]),s._v(" "),a("p",[a("strong",[s._v("docker + 管理的对象（比如容器，镜像） + 具体操作（比如创建，启动，停止，删除）")])]),s._v(" "),a("p",[s._v("例如")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("docker image pull nginx")]),s._v(" 拉取一个叫nginx的docker image镜像")]),s._v(" "),a("li",[a("code",[s._v("docker container stop web")]),s._v(" 停止一个叫web的docker container容器")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" version 或docker info "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看docker的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前运行的容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前所有的容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#与ps效果一样，ps是老版的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"理解image-vs-container-镜像-vs-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理解image-vs-container-镜像-vs-容器"}},[s._v("#")]),s._v(" 理解Image vs Container 镜像 vs 容器")]),s._v(" "),a("p",[a("strong",[s._v("image镜像")])]),s._v(" "),a("ul",[a("li",[s._v("Docker image是一个 "),a("code",[s._v("read-only")]),s._v(" 文件")]),s._v(" "),a("li",[s._v("这个文件包含文件系统，源码，库文件，依赖，工具等一些运行application所需要的文件")]),s._v(" "),a("li",[s._v("可以理解成一个模板")]),s._v(" "),a("li",[s._v("docker image具有分层的概念")])]),s._v(" "),a("p",[a("strong",[s._v("container容器")])]),s._v(" "),a("ul",[a("li",[s._v("“一个运行中的docker image”")]),s._v(" "),a("li",[s._v("实质是复制image并在image最上层加上一层 "),a("code",[s._v("read-write")]),s._v(" 的层 （称之为 "),a("code",[s._v("container layer")]),s._v(" ,容器层）")]),s._v(" "),a("li",[s._v("基于同一个image可以创建多个container")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(520),alt:"docker-image-vs-container"}})]),s._v(" "),a("p",[a("strong",[s._v("docker image的获取")])]),s._v(" "),a("ul",[a("li",[s._v("自己制作")]),s._v(" "),a("li",[s._v("从registry拉取（比如docker hub）")])]),s._v(" "),a("p",[a("strong",[s._v("配置国内镜像仓库加速拉取，跟maven配置镜像源一个道理")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("为docker配置国内镜像地址，用于在pull镜像下载加速")]),s._v(" "),a("ol",[a("li",[s._v("创建配置文件daemon.json")])]),s._v(" "),a("p",[s._v("在目录/etc/docker/daemon.json下，如果没，则创建该文件")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("按如下格式化添加镜像地址")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://hub-mirror.c.163.com"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.mirrors.ustc.edu.cn"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#docker中国镜像地址：    "https://registry.docker-cn.com",')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#网络docker镜像地址  "http://hub-mirror.c.163.com",')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#ustc大学镜像地址 "https://docker.mirrors.ustc.edu.cn"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("添加完重启docker，并使用docker info 命令查看")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("docker信息:")])])]),s._v(" "),a("p",[a("img",{attrs:{src:t(521),alt:"image-20230613203418772"}})]),s._v(" "),a("h3",{attrs:{id:"容器的基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器的基本操作"}},[s._v("#")]),s._v(" 容器的基本操作")]),s._v(" "),a("p",[a("img",{attrs:{src:t(522),alt:"image-20230704213534149"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(523),alt:"image-20230613212427849"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(524),alt:"image-20230613212507558"}})]),s._v(" "),a("h3",{attrs:{id:"docker-container-命令小技巧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-container-命令小技巧"}},[s._v("#")]),s._v(" docker container 命令小技巧")]),s._v(" "),a("ul",[a("li",[a("h2",{attrs:{id:"批量停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量停止"}},[s._v("#")]),s._v(" 批量停止")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES\ncd3a825fedeb   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" seconds ago    Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" seconds    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp    mystifying_leakey\n269494fe89fa   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" seconds ago    Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" seconds    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp    funny_gauss\n34b68af9deef   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp    interesting_mahavira\n7513949674fc   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp    kind_nobel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("方法1")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container stop cd3 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("269")]),s._v(" 34b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("751")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("方法2")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aq")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\ncd3a825fedeb\n269494fe89fa\n34b68af9deef\n7513949674fc\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES\ncd3a825fedeb   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" seconds ago   Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds ago             mystifying_leakey\n269494fe89fa   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" seconds ago   Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds ago             funny_gauss\n34b68af9deef   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" seconds ago   Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds ago             interesting_mahavira\n7513949674fc   nginx     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v(" seconds ago   Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds ago             kind_nobel\n$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("h2",{attrs:{id:"批量删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量删除"}},[s._v("#")]),s._v(" 批量删除")])])]),s._v(" "),a("p",[s._v("和批量停止类似，可以使用 "),a("code",[s._v("docker container rm $(docker container ps -aq)")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("docker system prune -a -f")]),s._v(" 可以快速对系统进行清理，删除停止的容器，不用的image，等等")])]),s._v(" "),a("h3",{attrs:{id:"container-mode-容器运行的各种模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#container-mode-容器运行的各种模式"}},[s._v("#")]),s._v(" Container Mode 容器运行的各种模式")]),s._v(" "),a("h4",{attrs:{id:"attach-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attach-模式"}},[s._v("#")]),s._v(" attach 模式")]),s._v(" "),a("p",[s._v("范例指令: docker container run -p 80:80 nginx")]),s._v(" "),a("ul",[a("li",[s._v("透过这种方式创建容器的话，容器在前台执行")]),s._v(" "),a("li",[s._v("容器的输入输出结果会反映到本地端，本地端的输入输出也会反映到容器，例如能在终端机看到网页浏览器的 log，ctrl + c 会让容器停止执行")]),s._v(" "),a("li",[s._v("一般情况不推荐使用")])]),s._v(" "),a("h4",{attrs:{id:"detach-模式-一般生产中使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#detach-模式-一般生产中使用"}},[s._v("#")]),s._v(" detach 模式(一般生产中使用)")]),s._v(" "),a("p",[s._v("范例指令:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("容器会在后台执行")])]),s._v(" "),a("li",[a("p",[s._v("想进入查看log 可通过")])]),s._v(" "),a("li",[a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这种方式进入 ctl+c退出，容器也会stop")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container attach "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#故查看日志，推荐docker logs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container logs "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:t(525),alt:"image-20230613221008147"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(526),alt:"image-20230613221825728"}})]),s._v(" "),a("h3",{attrs:{id:"连接容器的-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接容器的-shell"}},[s._v("#")]),s._v(" 连接容器的 shell")]),s._v(" "),a("p",[a("strong",[s._v("创建一个容器并进入交互式模式")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" busybox "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nbin   dev   etc   home  proc  root  sys   tmp   usr   var\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps")]),s._v("\nPID   "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("     TIME  COMMAND\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("在一个已经运行的容器里执行一个额外的command")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("➜  ~ docker container run -d nginx\n33d2ee50cfc46b5ee0b290f6ad75d724551be50217f691e68d15722328f11ef6\n➜  ~\n➜  ~ docker container exec -it 33d sh\n#\n#\n# ls\nbin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n#\n# exit\n➜  ~\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"容器和虚拟机-container-vs-vm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器和虚拟机-container-vs-vm"}},[s._v("#")]),s._v(" 容器和虚拟机 Container vs VM")]),s._v(" "),a("p",[a("img",{attrs:{src:t(527),alt:"docker-vs-vm"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("容器不是Mini虚拟机")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("容器其实是进程Containers are just processes")])])]),s._v(" "),a("li",[a("p",[s._v("容器中的进程被限制了对CPU内存等资源的访问")])]),s._v(" "),a("li",[a("p",[s._v("当进程停止后，容器就退出了")])])]),s._v(" "),a("p",[a("img",{attrs:{src:t(528),alt:"image-20230613232708883"}})]),s._v(" "),a("h3",{attrs:{id:"docker-container-run-背后发生了什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-container-run-背后发生了什么"}},[s._v("#")]),s._v(" docker container run 背后发生了什么？")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker container run -d --publish 80:80 --name webhost nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("ol",[a("li",[s._v("在本地查找是否有nginx这个image镜像，但是没有发现")])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("去远程的image registry查找nginx镜像（默认的registry是Docker Hub)")])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("下载最新版本的nginx镜像 （nginx:latest 默认)")])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("基于nginx镜像来创建一个新的容器，并且准备运行")])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("docker engine分配给这个容器一个虚拟IP地址")])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("在宿主机上打开80端口并把容器的80端口转发到宿主机上")])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("启动容器，运行指定的命令（这里是一个shell脚本去启动nginx）")])])])]),s._v(" "),a("h2",{attrs:{id:"_3-镜像的获取的三种方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-镜像的获取的三种方式"}},[s._v("#")]),s._v(" 3. 镜像的获取的三种方式")]),s._v(" "),a("ul",[a("li",[s._v("pull from "),a("code",[s._v("registry")]),s._v(" (online) 从registry拉取\n"),a("ul",[a("li",[s._v("public（公有）")]),s._v(" "),a("li",[s._v("private（私有）")])])]),s._v(" "),a("li",[s._v("build from "),a("code",[s._v("Dockerfile")]),s._v(" (online) 从Dockerfile构建")]),s._v(" "),a("li",[s._v("load from "),a("code",[s._v("file")]),s._v(" (offline) 文件导入 （离线）")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(529),alt:"docker-image"}})]),s._v(" "),a("p",[a("strong",[s._v("镜像的命令查询")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image COMMAND\n\nManage images\n\nCommands:\nbuild       Build an image from a Dockerfile\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v("     Show the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" of an image\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v("      Import the contents from a tarball to create a filesystem image\ninspect     Display detailed information on one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" images\nload        Load an image from a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive or STDIN\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("          List images\nprune       Remove unused images\npull        Pull an image or a repository from a registry\npush        Push an image or a repository to a registry\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("          Remove one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" images\nsave        Save one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" images to a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("streamed to STDOUT by default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE\n\nRun "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker image COMMAND --help'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information on a command.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"从registry拉取pull"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从registry拉取pull"}},[s._v("#")]),s._v(" 从registry拉取pull")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认从Docker Hub拉取，如果不指定版本，会拉取最新版")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx:1.20.0 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull quay.io/bitnami/nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从指定仓库Quay上拉取镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像的查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像的删除")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"从离线导入load"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从离线导入load"}},[s._v("#")]),s._v(" 从离线导入load")]),s._v(" "),a("p",[s._v("模拟生成一个离线的镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image save nginx:1.20.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" nginx.myself\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(530),alt:"image-20230614002229573"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image load "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" nginx.myself\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(531),alt:"image-20230614002610129"}})]),s._v(" "),a("h3",{attrs:{id:"从dockerfile-build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从dockerfile-build"}},[s._v("#")]),s._v(" 从dockerfile build")]),s._v(" "),a("h4",{attrs:{id:"dockerfile-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-介绍"}},[s._v("#")]),s._v(" Dockerfile 介绍")]),s._v(" "),a("p",[s._v("Docker can build images automatically by reading the instructions from a "),a("code",[s._v("Dockerfile")]),s._v(". A Dockerfile is a "),a("code",[s._v("text")]),s._v(" document that contains all the commands a user could call on the command line to assemble an image. Using docker build users can create an automated build that executes several command-line instructions in succession.")]),s._v(" "),a("p",[s._v("https://docs.docker.com/engine/reference/builder/")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Dockerfile是用于构建docker镜像的文件")])]),s._v(" "),a("li",[s._v("Dockerfile里包含了构建镜像所需的“指令”")]),s._v(" "),a("li",[s._v("Dockerfile有其特定的语法规则")])]),s._v(" "),a("h4",{attrs:{id:"dockerfile的构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile的构建"}},[s._v("#")]),s._v(" Dockerfile的构建")]),s._v(" "),a("p",[a("strong",[s._v('示例：使用centos 脚本打印"hello docker !"')])]),s._v(" "),a("p",[s._v("hello.sh")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker !"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" hello.sh /")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello.sh"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(532),alt:"image-20230614065355333"}})]),s._v(" "),a("p",[a("strong",[s._v("示例：部署一个Hello Docker java项目")])]),s._v(" "),a("p",[s._v("新建HelloWorld,并将项目打包")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloDocker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello Docker !"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("新建一个Dockerfile文件")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8-jdk-alpine")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" *.jar app.jar")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("将文件上传到linux服务器上")]),s._v(" "),a("p",[a("img",{attrs:{src:t(533),alt:"image-20230614043947938"}})]),s._v(" "),a("p",[s._v("构建镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" docker-demo-java "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(534),alt:"image-20230614044514049"}})]),s._v(" "),a("p",[s._v("重新打标签")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image tag docker-demo-java docker-demo-java:2.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实际应按照远程仓库的规则打标签")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ImageId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" registry.cn-shenzhen.aliyuncs.com/gordonchan/quickstart:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(535),alt:"image-20230614050147206"}})]),s._v(" "),a("h4",{attrs:{id:"推送镜像到远程仓库进行共享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像到远程仓库进行共享"}},[s._v("#")]),s._v(" 推送镜像到远程仓库进行共享")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("XXXXXXX registry.cn-shenzhen.aliyuncs.com\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push registry.cn-shenzhen.aliyuncs.com/gordonchan/quickstart:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(536),alt:"image-20230614054131643"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(537),alt:"image-20230614053824763"}})]),s._v(" "),a("p",[s._v("拉取镜像并构建容器运行")]),s._v(" "),a("p",[a("img",{attrs:{src:t(538),alt:"image-20230614055202954"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(539),alt:"image-20230614055347798"}})]),s._v(" "),a("p",[a("strong",[s._v("示例：执行一个Python程序")])]),s._v(" "),a("p",[s._v("容器及进程，所以镜像就是一个运行这个进程所需要的环境。")]),s._v(" "),a("p",[s._v("假如我们要在centos:7上运行下面这个hello.py的Python程序")]),s._v(" "),a("p",[s._v("hello.py的文件内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('print("hello docker")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("第一步，"),a("strong",[s._v("准备Python环境")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum install -y python3.9 python3-pip python3.9-dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("第二步，"),a("strong",[s._v("运行hello.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ python3 hello.py\nhello docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("p",[a("strong",[s._v("把上面的程序构建成一个Dockerfile")])]),s._v(" "),a("p",[s._v("Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" image=centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v("  yum install -y python3.9 python3-pip python3.9-dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" hello.py /")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python3"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello.py"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_4-dockerfile命令详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-dockerfile命令详解"}},[s._v("#")]),s._v(" 4.Dockerfile命令详解")]),s._v(" "),a("h3",{attrs:{id:"基础镜像的选择-from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础镜像的选择-from"}},[s._v("#")]),s._v(" 基础镜像的选择 (FROM)")]),s._v(" "),a("p",[a("strong",[s._v("基本原则")])]),s._v(" "),a("ul",[a("li",[s._v("官方镜像优于非官方的镜像，如果没有官方镜像，则尽量选择Dockerfile开源的")]),s._v(" "),a("li",[s._v("固定版本tag而不是每次都使用latest")]),s._v(" "),a("li",[s._v("尽量选择体积小的镜像")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY      TAG             IMAGE ID       CREATED          SIZE\nbitnami/nginx   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.18")]),s._v(".0          dfe237636dde   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" minutes ago   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(".3MB\nnginx           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.21")]),s._v(".0-alpine   a6eb2a334a9f   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".6MB\nnginx           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.21")]),s._v(".0          d1a364dc548d   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago       133MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("Build一个Nginx镜像")])]),s._v(" "),a("p",[s._v("假如我们有一个 "),a("code",[s._v("index.html")]),s._v(" 文件")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Hello Docker"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("准备一个Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx:1.21.0-alpine")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" ../其他/index.html /usr/share/nginx/html/index.html")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"在image里run-执行指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在image里run-执行指令"}},[s._v("#")]),s._v(" 在image里RUN 执行指令")]),s._v(" "),a("p",[a("code",[s._v("RUN")]),s._v(" 主要用于在build Image里执行指令，比如安装软件，下载文件等。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf ipinfo_2.0.1_linux_amd64.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" ipinfo_2.0.1_linux_amd64.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("Dockerfile")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu:20.04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get install -y wget")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" tar zxf ipinfo_2.0.1_linux_amd64.tar.gz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" rm -rf ipinfo_2.0.1_linux_amd64.tar.gz")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("镜像的大小和分层")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nipinfo       latest    97bb429363fb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   138MB\nubuntu       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.04")]),s._v("     478aa0080b60   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v(".1MB\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" 97b\nIMAGE          CREATED         CREATED BY                                      SIZE      COMMENT\n97bb429363fb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" ipinfo_2.0.1_linux_amd…   0B        buildkit.dockerfile.v0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ipinfo_2.0.1_linux_amd64 /…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".36MB    buildkit.dockerfile.v0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf ipinfo_2.0.1_linux_am…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".36MB    buildkit.dockerfile.v0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/ipinf…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".85MB    buildkit.dockerfile.v0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bui…   7.58MB    buildkit.dockerfile.v0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# buildkit        33MB      buildkit.dockerfile.v0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#(nop)  CMD ["/bin/bash"]            0B')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /run/systemd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'do…   7B\n<missing>      4 days ago      /bin/sh -c [ -z \"$(apt-get indextargets)\" ]     0B\n<missing>      4 days ago      /bin/sh -c set -xe   && echo '")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh' > /…   811B")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) ADD file:d6b6ba642344138dc…   74.1MB")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("每一行的RUN命令都会产生一层image layer, 导致镜像的臃肿。")]),s._v(" "),a("p",[a("strong",[s._v("改进版Dockerfile")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu:20.04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y wget && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    tar zxf ipinfo_2.0.1_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -rf ipinfo_2.0.1_linux_amd64.tar.gz")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY   TAG       IMAGE ID       CREATED          SIZE\nipinfo-new   latest    fe551bc26b92   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago    124MB\nipinfo       latest    97bb429363fb   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" minutes ago   138MB\nubuntu       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.04")]),s._v("     478aa0080b60   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v(".1MB\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" fe5\nIMAGE          CREATED          CREATED BY                                      SIZE      COMMENT\nfe551bc26b92   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" seconds ago   RUN /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("     apt-get…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(".9MB    buildkit.dockerfile.v0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago       /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#(nop)  CMD ["/bin/bash"]            0B')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago       /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /run/systemd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'do…   7B\n<missing>      4 days ago       /bin/sh -c [ -z \"$(apt-get indextargets)\" ]     0B\n<missing>      4 days ago       /bin/sh -c set -xe   && echo '")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh' > /…   811B")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago       /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) ADD file:d6b6ba642344138dc…   74.1MB")]),s._v("\n$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"文件复制-add-copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件复制-add-copy"}},[s._v("#")]),s._v(" 文件复制 (ADD,COPY)")]),s._v(" "),a("p",[s._v("往镜像里复制文件有两种方式，"),a("code",[s._v("COPY")]),s._v(" 和 "),a("code",[s._v("ADD")]),s._v(" , 我们来看一下两者的不同。")]),s._v(" "),a("p",[a("strong",[s._v("复制普通文件")])]),s._v(" "),a("p",[a("code",[s._v("COPY")]),s._v(" 和 "),a("code",[s._v("ADD")]),s._v(" 都可以"),a("strong",[s._v("把local的一个文件复制到镜像里")]),s._v("，如果目标目录不存在，则会自动创建")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-alpine3.13")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" hello.py /app/hello.py")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("比如把本地的 hello.py 复制到 /app 目录下。 /app这个folder不存在，则会自动创建")]),s._v(" "),a("p",[a("strong",[s._v("复制压缩文件")])]),s._v(" "),a("p",[a("code",[s._v("ADD")]),s._v(" 比 COPY高级一点的地方就是，如果复制的是一个gzip等压缩文件时，ADD会帮助我们自动去解压缩文件。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-alpine3.13")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" hello.tar.gz /app/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("如何选择")])]),s._v(" "),a("p",[s._v("因此在 COPY 和 ADD 指令中选择的时候，可以遵循这样的原则，所有的文件复制均使用 COPY 指令，仅在需要自动解压缩的场合使用 ADD。")]),s._v(" "),a("h3",{attrs:{id:"构建参数和环境变量-arg↑-vs-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建参数和环境变量-arg↑-vs-env"}},[s._v("#")]),s._v(" 构建参数和环境变量 (ARG↑ vs ENV)")]),s._v(" "),a("p",[a("code",[s._v("ARG")]),s._v(" 和 "),a("code",[s._v("ENV")]),s._v(" 是经常容易被混淆的两个Dockerfile的语法，都可以用来设置一个“变量”。 但实际上两者有很多的不同。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu:20.04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y wget && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    tar zxf ipinfo_2.0.1_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -rf ipinfo_2.0.1_linux_amd64.tar.gz")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("ENV")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu:20.04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" VERSION=2.0.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y wget && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("/ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    tar zxf ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    mv ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64 /usr/bin/ipinfo && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -rf ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64.tar.gz")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("ARG")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu:20.04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" VERSION=2.0.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt-get update && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y wget && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("/ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    tar zxf ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64.tar.gz && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    mv ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64 /usr/bin/ipinfo && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    rm -rf ipinfo_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VERSION}")]),s._v("_linux_amd64.tar.gz")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("区别")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(540),alt:"docker-image"}})]),s._v(" "),a("p",[s._v("ARG 可以在镜像build的时候动态修改value, 通过 "),a("code",[s._v("--build-arg")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[s._v("$ docker image build -f .\\Dockerfile-arg -t ipinfo-arg-2.0.0 --build-arg VERSION=2.0.0 .\n$ docker image ls\nREPOSITORY         TAG       IMAGE ID       CREATED          SIZE\nipinfo-arg-2.0.0   latest    0d9c964947e2   6 seconds ago    124MB\n$ docker container run -it ipinfo-arg-2.0.0\nroot@b64285579756:/#\nroot@b64285579756:/# ipinfo version\n2.0.0\nroot@b64285579756:/#\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ENV 设置的变量可以在Image中保持，并在容器中的环境变量里")]),s._v(" "),a("h3",{attrs:{id:"容器启动命令-cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器启动命令-cmd"}},[s._v("#")]),s._v(" 容器启动命令 CMD")]),s._v(" "),a("p",[s._v("CMD可以用来设置容器启动时默认会执行的命令。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("容器启动时默认执行的命令")])]),s._v(" "),a("li",[a("strong",[s._v("如果docker container run启动容器时指定了其它命令，则CMD命令会被忽略")])]),s._v(" "),a("li",[a("strong",[s._v("如果定义了多个CMD，只有最后一个会被执行。")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("FROM ubuntu:20.04\nENV VERSION=2.0.1\nRUN apt-get update && \\\n    apt-get install -y wget && \\\n    wget https://github.com/ipinfo/cli/releases/download/ipinfo-${VERSION}/ipinfo_${VERSION}_linux_amd64.tar.gz && \\\n    tar zxf ipinfo_${VERSION}_linux_amd64.tar.gz && \\\n    mv ipinfo_${VERSION}_linux_amd64 /usr/bin/ipinfo && \\\n    rm -rf ipinfo_${VERSION}_linux_amd64.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker image build -t ipinfo .\n$ docker container run -it ipinfo\nroot@8cea7e5e8da8:/#\nroot@8cea7e5e8da8:/#\nroot@8cea7e5e8da8:/#\nroot@8cea7e5e8da8:/# pwd\n/\nroot@8cea7e5e8da8:/#\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("默认进入到shell是因为在ubuntu的基础镜像里有定义CMD")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$docker image history ipinfo\nIMAGE          CREATED        CREATED BY                                      SIZE      COMMENT\ndb75bff5e3ad   24 hours ago   RUN /bin/sh -c apt-get update &&     apt-get…   50MB      buildkit.dockerfile.v0\n<missing>      24 hours ago   ENV VERSION=2.0.1                               0B        buildkit.dockerfile.v0\n<missing>      7 days ago     /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B\n<missing>      7 days ago     /bin/sh -c mkdir -p /run/systemd && echo \'do…   7B\n<missing>      7 days ago     /bin/sh -c [ -z "$(apt-get indextargets)" ]     0B\n<missing>      7 days ago     /bin/sh -c set -xe   && echo \'#!/bin/sh\' > /…   811B\n<missing>      7 days ago     /bin/sh -c #(nop) ADD file:d6b6ba642344138dc…   74.1MB\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"容器启动命令-entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器启动命令-entrypoint"}},[s._v("#")]),s._v(" 容器启动命令 ENTRYPOINT")]),s._v(" "),a("p",[s._v("ENTRYPOINT 也可以设置容器启动时要执行的命令，但是和CMD是有区别的。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("CMD")]),s._v(" 设置的命令，可以在docker container run 时传入其它命令，覆盖掉 "),a("code",[s._v("CMD")]),s._v(" 的命令，但是 "),a("code",[s._v("ENTRYPOINT")]),s._v(" 所设置的命令是一定会被执行的。")]),s._v(" "),a("li",[a("code",[s._v("ENTRYPOINT")]),s._v(" 和 "),a("code",[s._v("CMD")]),s._v(" 可以联合使用，"),a("code",[s._v("ENTRYPOINT")]),s._v(" 设置执行的命令，CMD传递参数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM ubuntu:20.04\nCMD ["echo", "hello docker"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("把上面的Dockerfile build成一个叫 "),a("code",[s._v("demo-cmd")]),s._v(" 的镜象")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker image ls\nREPOSITORY        TAG       IMAGE ID       CREATED      SIZE\ndemo-cmd          latest    5bb63bb9b365   8 days ago   74.1MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM ubuntu:20.04\nENTRYPOINT ["echo", "hello docker"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("build成一个叫 "),a("code",[s._v("demo-entrypoint")]),s._v(" 的镜像")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker image ls\nREPOSITORY        TAG       IMAGE ID       CREATED      SIZE\ndemo-entrypoint   latest    b1693a62d67a   8 days ago   74.1MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("CMD的镜像，如果执行创建容器，不指定运行时的命令，则会默认执行CMD所定义的命令，打印出hello docker")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker container run -it --rm demo-cmd\nhello docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("但是如果我们docker container run的时候指定命令，则该命令会覆盖掉CMD的命令，如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker container run -it --rm demo-cmd echo "hello world"\nhello world\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("但是ENTRYPOINT的容器里ENTRYPOINT所定义的命令则无法覆盖，一定会执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker container run -it --rm demo-entrypoint\nhello docker\n$ docker container run -it --rm demo-entrypoint echo "hello world"\nhello docker echo hello world\n$\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"shell-格式和-exec-格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shell-格式和-exec-格式"}},[s._v("#")]),s._v(" Shell 格式和 Exec 格式")]),s._v(" "),a("p",[a("strong",[s._v("容器的启动命令中带有参数传递的处理方式")])]),s._v(" "),a("p",[s._v("CMD和ENTRYPOINT同时支持shell格式和Exec格式。")]),s._v(" "),a("p",[a("strong",[s._v("Shell格式")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('CMD echo "hello docker"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('ENTRYPOINT echo "hello docker"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("Exec格式")])]),s._v(" "),a("p",[s._v("以可执行命令的方式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('ENTRYPOINT ["echo", "hello docker"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('CMD ["echo", "hello docker"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意shell脚本的问题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM ubuntu:20.04\nENV NAME=docker\nCMD echo "hello $NAME"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("假如我们要把上面的CMD改成Exec格式，下面这样改是不行的, 大家可以试试。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM ubuntu:20.04\nENV NAME=docker\nCMD ["echo", "hello $NAME"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("它会打印出 "),a("code",[s._v("hello $NAME")]),s._v(" , 而不是 "),a("code",[s._v("hello docker")]),s._v(" ,那么需要怎么写呢？ 我们需要以shell脚本的方式去执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM ubuntu:20.04\nENV NAME=docker\nCMD ["sh", "-c", "echo hello $NAME"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"实战-构建一个-python-flask-镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战-构建一个-python-flask-镜像"}},[s._v("#")]),s._v(" 实战：构建一个 Python Flask 镜像")]),s._v(" "),a("p",[s._v("Python 程序")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" flask "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Flask\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello_world")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello, World!'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-slim")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" app.py /src/app.py")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install flask")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_APP=app.py")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 5000")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" flask "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 flask\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(541),alt:"image-20230614183643911"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(542),alt:"image-20230614183813272"}})]),s._v(" "),a("h4",{attrs:{id:"dockerfile-技巧-合理使用缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-技巧-合理使用缓存"}},[s._v("#")]),s._v(" Dockerfile 技巧——合理使用缓存")]),s._v(" "),a("p",[s._v("如果按照上述Dockerfile，修改app.py后，之后的操作比如install flask都不会使用cache，这样影响构建效率，因此，把经常改变的内容放在后面，尽可能的使用缓存，提高构建速度。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-slim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install flask")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_APP=app.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 5000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" app.py /src/app.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:t(543),alt:"image-20230614185305649"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(544),alt:"image-20230614185826404"}})]),s._v(" "),a("h4",{attrs:{id:"dockerfile-技巧-合理使用-dockerignore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-技巧-合理使用-dockerignore"}},[s._v("#")]),s._v(" Dockerfile 技巧——合理使用 .dockerignore")]),s._v(" "),a("p",[a("strong",[s._v("什么是Docker build context")])]),s._v(" "),a("p",[s._v("Docker是client-server架构，理论上Client和Server可以不在一台机器上。")]),s._v(" "),a("p",[s._v("在构建docker镜像的时候，需要把所需要的文件由CLI（client）发给Server，这些文件实际上就是build context")]),s._v(" "),a("p",[s._v("加入文件夹下有些文件不是必须的，可以过滤掉。")]),s._v(" "),a("p",[s._v("Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-slim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install flask")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_APP=app.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 5000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./ /src/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:t(545),alt:"image-20230614204910784"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(546),alt:"image-20230614205051618"}})]),s._v(" "),a("p",[s._v("增加vim .dockerignore")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("./hello.image\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("有了.dockerignore文件后，我们再build, build context就小了很多")]),s._v(" "),a("p",[a("img",{attrs:{src:t(547),alt:"image-20230614205127406"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(548),alt:"image-20230614205156437"}})]),s._v(" "),a("h3",{attrs:{id:"dockerfile-技巧-镜像的多阶段构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-技巧-镜像的多阶段构建"}},[s._v("#")]),s._v(" Dockerfile 技巧——镜像的多阶段构建")]),s._v(" "),a("p",[s._v("这一节来聊聊多阶段构建，以及为什么要使用它。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("C语言例子")])])]),s._v(" "),a("p",[s._v("假如有一个C的程序，我们想用Docker去做编译，然后执行可执行文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#include <stdio.h>\n\nvoid main(int argc, char *argv[])\n{\n    printf("hello %s\\n", argv[argc - 1]);\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("本地测试（如果你本地有C环境）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ gcc --static -o hello hello.c\n$ ls\nhello  hello.c\n$ ./hello docker\nhello docker\n$ ./hello world\nhello world\n$ ./hello friends\nhello friends\n$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("构建一个Docker镜像，因为要有C的环境，所以我们选择gcc这个image")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM gcc:9.4\n\nCOPY hello.c /src/hello.c\n\nWORKDIR /src\n\nRUN gcc --static -o hello hello.c\n\nENTRYPOINT [ "/src/hello" ]\n\nCMD []\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("build和测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker build -t hello .\nSending build context to Docker daemon   5.12kB\nStep 1/6 : FROM gcc:9.4\n---\x3e be1d0d9ce039\nStep 2/6 : COPY hello.c /src/hello.c\n---\x3e Using cache\n---\x3e 70a624e3749b\nStep 3/6 : WORKDIR /src\n---\x3e Using cache\n---\x3e 24e248c6b27c\nStep 4/6 : RUN gcc --static -o hello hello.c\n---\x3e Using cache\n---\x3e db8ae7b42aff\nStep 5/6 : ENTRYPOINT [ "/src/hello" ]\n---\x3e Using cache\n---\x3e 7f307354ee45\nStep 6/6 : CMD []\n---\x3e Using cache\n---\x3e 7cfa0cbe4e2a\nSuccessfully built 7cfa0cbe4e2a\nSuccessfully tagged hello:latest\n$ docker image ls\nREPOSITORY     TAG          IMAGE ID       CREATED       SIZE\nhello          latest       7cfa0cbe4e2a   2 hours ago   1.14GB\ngcc            9.4          be1d0d9ce039   9 days ago    1.14GB\n$ docker run --rm -it hello docker\nhello docker\n$ docker run --rm -it hello world\nhello world\n$ docker run --rm -it hello friends\nhello friends\n$\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("可以看到镜像非常的大，1.14GB")]),s._v(" "),a("p",[s._v("实际上当我们把hello.c编译完以后，并不需要这样一个大的GCC环境，一个小的alpine镜像就可以了。")]),s._v(" "),a("p",[s._v("这时候我们就可以使用多阶段构建了。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM gcc:9.4 AS builder\n\nCOPY hello.c /src/hello.c\n\nWORKDIR /src\n\nRUN gcc --static -o hello hello.c\n\n\n\nFROM alpine:3.13.5\n\nCOPY --from=builder /src/hello /src/hello\n\nENTRYPOINT [ "/src/hello" ]\n\nCMD []\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("测试")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker build -t hello-apline -f Dockerfile-new .\nSending build context to Docker daemon   5.12kB\nStep 1/8 : FROM gcc:9.4 AS builder\n---\x3e be1d0d9ce039\nStep 2/8 : COPY hello.c /src/hello.c\n---\x3e Using cache\n---\x3e 70a624e3749b\nStep 3/8 : WORKDIR /src\n---\x3e Using cache\n---\x3e 24e248c6b27c\nStep 4/8 : RUN gcc --static -o hello hello.c\n---\x3e Using cache\n---\x3e db8ae7b42aff\nStep 5/8 : FROM alpine:3.13.5\n---\x3e 6dbb9cc54074\nStep 6/8 : COPY --from=builder /src/hello /src/hello\n---\x3e Using cache\n---\x3e 18c2bce629fb\nStep 7/8 : ENTRYPOINT [ "/src/hello" ]\n---\x3e Using cache\n---\x3e 8dfb9d9d6010\nStep 8/8 : CMD []\n---\x3e Using cache\n---\x3e 446baf852214\nSuccessfully built 446baf852214\nSuccessfully tagged hello-apline:latest\n$ docker image ls\nREPOSITORY     TAG          IMAGE ID       CREATED       SIZE\nhello-alpine   latest       446baf852214   2 hours ago   6.55MB\nhello          latest       7cfa0cbe4e2a   2 hours ago   1.14GB\ndemo           latest       079bae887a47   2 hours ago   125MB\ngcc            9.4          be1d0d9ce039   9 days ago    1.14GB\n$ docker run --rm -it hello-alpine docker\nhello docker\n$ docker run --rm -it hello-alpine world\nhello world\n$ docker run --rm -it hello-alpine friends\nhello friends\n$\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("p",[s._v("可以看到这个镜像非常小，只有6.55MB")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Java 语言例子")])])]),s._v(" "),a("p",[s._v("使用的openjdk:8-jdk-alpine就是瘦身过的镜像，不过要注意时区问题，要自己设置。")]),s._v(" "),a("h3",{attrs:{id:"dockerfile-技巧-尽量使用非root用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-技巧-尽量使用非root用户"}},[s._v("#")]),s._v(" Dockerfile 技巧——尽量使用非root用户")]),s._v(" "),a("p",[a("strong",[s._v("Root的危险性")])]),s._v(" "),a("p",[s._v("docker的root权限一直是其遭受诟病的地方，docker的root权限有那么危险么？我们举个例子。")]),s._v(" "),a("p",[s._v("假如我们有一个用户，叫demo，它本身不具有sudo的权限，所以就有很多文件无法进行读写操作，比如/root目录它是无法查看的。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[demo@docker-host ~]$ sudo ls /root\n[sudo] password for demo:\ndemo is not in the sudoers file.  This incident will be reported.\n[demo@docker-host ~]$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("但是这个用户有执行docker的权限，也就是它在docker这个group里。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[demo@docker-host ~]$ groups\ndemo docker\n[demo@docker-host ~]$ docker image ls\nREPOSITORY   TAG       IMAGE ID       CREATED      SIZE\nbusybox      latest    a9d583973f65   2 days ago   1.23MB\n[demo@docker-host ~]$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这时，我们就可以通过Docker做很多越权的事情了，比如，我们可以把这个无法查看的/root目录映射到docker container里，你就可以自由进行查看了。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[demo@docker-host vagrant]$ docker run -it -v /root/:/root/tmp busybox sh\n/ # cd /root/tmp\n~/tmp # ls\nanaconda-ks.cfg  original-ks.cfg\n~/tmp # ls -l\ntotal 16\n-rw-------    1 root     root          5570 Apr 30  2020 anaconda-ks.cfg\n-rw-------    1 root     root          5300 Apr 30  2020 original-ks.cfg\n~/tmp #\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("更甚至我们可以给我们自己加sudo权限。我们现在没有sudo权限")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[demo@docker-host ~]$ sudo vim /etc/sudoers\n[sudo] password for demo:\ndemo is not in the sudoers file.  This incident will be reported.\n[demo@docker-host ~]$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("但是我可以给自己添加。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[demo@docker-host ~]$ docker run -it -v /etc/sudoers:/root/sudoers busybox sh\n/ # echo "demo    ALL=(ALL)       ALL" >> /root/sudoers\n/ # more /root/sudoers | grep demo\ndemo    ALL=(ALL)       ALL\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("然后退出container，bingo，我们有sudo权限了。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[demo@docker-host ~]$ sudo more /etc/sudoers | grep demo\ndemo    ALL=(ALL)       ALL\n[demo@docker-host ~]$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("如何使用非root用户")])]),s._v(" "),a("p",[s._v("我们准备两个Dockerfile，第一个Dockerfile如下，")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM python:3.9.5-slim\n\nRUN pip install flask\n\nCOPY app.py /src/app.py\n\nWORKDIR /src\nENV FLASK_APP=app.py\n\nEXPOSE 5000\n\nCMD ["flask", "run", "-h", "0.0.0.0"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("假设构建的镜像名字为 "),a("code",[s._v("flask-demo")])]),s._v(" "),a("p",[s._v("第二个Dockerfile，使用非root用户来构建这个镜像，名字叫 "),a("code",[s._v("flask-no-root")]),s._v(" Dockerfile如下：")]),s._v(" "),a("ul",[a("li",[s._v("通过groupadd和useradd创建一个flask的组和用户")]),s._v(" "),a("li",[s._v("通过USER指定后面的命令要以flask这个用户的身份运行")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM python:3.9.5-slim\n\nRUN pip install flask && \\\n    groupadd -r flask && useradd -r -g flask flask && \\\n    mkdir /src && \\\n    chown -R flask:flask /src\n\nUSER flask\n\nCOPY app.py /src/app.py\n\nWORKDIR /src\nENV FLASK_APP=app.py\n\nEXPOSE 5000\n\nCMD ["flask", "run", "-h", "0.0.0.0"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker image ls\nREPOSITORY      TAG          IMAGE ID       CREATED          SIZE\nflask-no-root   latest       80996843356e   41 minutes ago   126MB\nflask-demo      latest       2696c68b51ce   49 minutes ago   125MB\npython          3.9.5-slim   609da079b03a   2 weeks ago      115MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("分别使用这两个镜像创建两个容器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker run -d --name flask-root flask-demo\nb31588bae216951e7981ce14290d74d377eef477f71e1506b17ee505d7994774\n$ docker run -d --name flask-no-root flask-no-root\n83aaa4a116608ec98afff2a142392119b7efe53617db213e8c7276ab0ae0aaa0\n$ docker container ps\nCONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS      NAMES\n83aaa4a11660   flask-no-root   "flask run -h 0.0.0.0"   4 seconds ago    Up 3 seconds    5000/tcp   flask-no-root\nb31588bae216   flask-demo      "flask run -h 0.0.0.0"   16 seconds ago   Up 15 seconds   5000/tcp   f\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_5-docker的存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-docker的存储"}},[s._v("#")]),s._v(" 5.Docker的存储")]),s._v(" "),a("h3",{attrs:{id:"data-volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-volume"}},[s._v("#")]),s._v(" Data Volume")]),s._v(" "),a("p",[a("strong",[s._v("示例：保存数据了解数据是如何持久化？")])]),s._v(" "),a("p",[s._v("环境准备")]),s._v(" "),a("p",[s._v("准备一个Dockerfile 和一个 my-cron的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ ls\nDockerfile  my-cron\n$ more Dockerfile\nFROM alpine:latest\nRUN apk update\nRUN apk --no-cache add curl\nENV SUPERCRONIC_URL=https://github.com/aptible/supercronic/releases/download/v0.1.12/supercronic-linux-amd64 \\\n    SUPERCRONIC=supercronic-linux-amd64 \\\n    SUPERCRONIC_SHA1SUM=048b95b48b708983effb2e5c935a1ef8483d9e3e\nRUN curl -fsSLO "$SUPERCRONIC_URL" \\\n    && echo "${SUPERCRONIC_SHA1SUM}  ${SUPERCRONIC}" | sha1sum -c - \\\n    && chmod +x "$SUPERCRONIC" \\\n    && mv "$SUPERCRONIC" "/usr/local/bin/${SUPERCRONIC}" \\\n    && ln -s "/usr/local/bin/${SUPERCRONIC}" /usr/local/bin/supercronic\nCOPY my-cron /app/my-cron\nWORKDIR /app\n\nVOLUME ["/app"]\n\n# RUN cron job\nCMD ["/usr/local/bin/supercronic", "/app/my-cron"]\n$\n$ more my-cron\n*/1 * * * * date >> /app/test.txt\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("工具supercronic：https://github.com/aptible/supercronic/ 这个专为容器而生的计划任务工具。")]),s._v(" "),a("p",[s._v("my-cron的意思是使用的my-cron就是一个crontab格式的计划任务，比如, 每隔一分钟输出时间到一个文件里")]),s._v(" "),a("p",[s._v("构建镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-cron "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nmy-cron      latest    e9fbd9a562c9   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(".7MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("创建容器(不指定-v参数)，在这个Volume的mountpoint可以发现容器创建的文件。此时Docker会自动创建一个随机名字的volume，去存储我们在Dockerfile定义的volume "),a("code",[s._v('VOLUME ["/app"]')])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" my-cron\n9a8fa93f03c42427a498b21ac520660752122e20bcdbf939661646f71d277f8f\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nDRIVER    VOLUME NAME\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("     043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect 043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CreatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-06-22T23:06:13+02:00"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mountpoint"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264/_data"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"043a196c21202c484c69f2098b6b9ec22b9a9e4e4bb8d4f55a4c3dce13c15264"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Scope"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[a("strong",[s._v("创建容器(指定-v参数)")])]),s._v(" "),a("p",[s._v("在创建容器的时候通过 "),a("code",[s._v("-v")]),s._v(" 参数我们可以手动的指定需要创建Volume的名字，以及对应于容器内的路径，这个路径是可以任意的，不必需要在Dockerfile里通过VOLUME定义")]),s._v(" "),a("p",[s._v("比如我们把上面的Dockerfile里的VOLUME删除")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM alpine:latest\nRUN apk update\nRUN apk --no-cache add curl\nENV SUPERCRONIC_URL=https://github.com/aptible/supercronic/releases/download/v0.1.12/supercronic-linux-amd64 \\\n    SUPERCRONIC=supercronic-linux-amd64 \\\n    SUPERCRONIC_SHA1SUM=048b95b48b708983effb2e5c935a1ef8483d9e3e\nRUN curl -fsSLO "$SUPERCRONIC_URL" \\\n    && echo "${SUPERCRONIC_SHA1SUM}  ${SUPERCRONIC}" | sha1sum -c - \\\n    && chmod +x "$SUPERCRONIC" \\\n    && mv "$SUPERCRONIC" "/usr/local/bin/${SUPERCRONIC}" \\\n    && ln -s "/usr/local/bin/${SUPERCRONIC}" /usr/local/bin/supercronic\nCOPY my-cron /app/my-cron\nWORKDIR /app\n\n# RUN cron job\nCMD ["/usr/local/bin/supercronic", "/app/my-cron"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("重新build镜像，然后创建容器，加-v参数 容器外路径:容器内路径")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my-cron "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" cron-data:/app my-cron\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('43c6d0357b0893861092a752c61ab01bdfa62ea766d01d2fcb8b3ecb6c88b3de\n$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     cron-data\n$ docker volume inspect cron-data\n[\n    {\n        "CreatedAt": "2021-06-22T23:25:02+02:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/cron-data/_data",\n        "Name": "cron-data",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n$ ls /var/lib/docker/volumes/cron-data/_data\nmy-cron\n$ ls /var/lib/docker/volumes/cron-data/_data\nmy-cron  test.txt\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("环境清理")]),s._v(" "),a("p",[s._v("强制删除所有容器，系统清理和volume清理")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aq")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#强制删除所有容器")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" system prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除不在运行的contianer cache")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Remove all unused local volumes")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"data-volume-练习-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-volume-练习-mysql"}},[s._v("#")]),s._v(" Data Volume 练习 MySQL")]),s._v(" "),a("p",[s._v("使用MySQL官方镜像，tag版本5.7")]),s._v(" "),a("p",[s._v("Dockerfile可以在这里查看 https://github.com/docker-library/mysql/tree/master/5.7")]),s._v(" "),a("p",[a("strong",[s._v("准备镜像")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull mysql:5.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("创建容器")])]),s._v(" "),a("p",[s._v("关于MySQL的镜像使用，可以参考dockerhub https://hub.docker.com/_/mysql?tab=description&page=1&ordering=last_updated")]),s._v(" "),a("p",[s._v("关于Dockerfile Volume的定义，可以参考 https://github.com/docker-library/mysql/tree/master/5.7")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--name 容器名docker-mysql  -e 编辑密码 -v磁盘映射到docker下的mysql-data目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" docker-mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" mysql-data:/var/lib/mysql mysql:5.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n$ docker volume ls\nDRIVER    VOLUME NAME\nlocal     mysql-data\n$ docker volume inspect mysql-data\n[\n    {\n        "CreatedAt": "2021-06-21T23:55:23+02:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/mysql-data/_data",\n        "Name": "mysql-data",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n$\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[a("strong",[s._v("数据库写入数据")])]),s._v(" "),a("p",[s._v("进入MySQL的shell")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" 022 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\nmysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Enter password:\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2\nServer version: 5.7.34 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2021, Oracle and/or its affiliates.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n\nmysql> create database demo;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| demo               |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.00 sec)\n\nmysql> exit\nBye\n# exit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[s._v("创建了一个叫 demo的数据库")]),s._v(" "),a("p",[s._v("查看data volume")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect mysql-data\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CreatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-06-22T00:01:34+02:00"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mountpoint"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/mysql-data/_data"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql-data"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Scope"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("  /var/lib/docker/volumes/mysql-data/_data\nauto.cnf    client-cert.pem  ib_buffer_pool  ibdata1  performance_schema  server-cert.pem\nca-key.pem  client-key.pem   ib_logfile0     ibtmp1   private_key.pem     server-key.pem\nca.pem      demo             ib_logfile1     mysql    public_key.pem      sys\n$\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"多个机器之间的容器共享数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多个机器之间的容器共享数据"}},[s._v("#")]),s._v(" 多个机器之间的容器共享数据")]),s._v(" "),a("p",[a("img",{attrs:{src:t(549),alt:"multi-host-volume"}})]),s._v(" "),a("p",[s._v("官方参考链接 https://docs.docker.com/storage/volumes/#share-data-among-machines")]),s._v(" "),a("p",[s._v("Docker的volume支持多种driver。默认创建的volume driver都是local")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker volume inspect vscode\n[\n    {\n        "CreatedAt": "2021-06-23T21:33:57Z",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/vscode/_data",\n        "Name": "vscode",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("这一节我们看看一个叫sshfs的driver，如何让docker使用不在同一台机器上的文件系统做volume")]),s._v(" "),a("p",[a("strong",[s._v("环境准备")])]),s._v(" "),a("p",[s._v("准备三台Linux机器，之间可以通过SSH相互通信。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("hostname")]),s._v(" "),a("th",[s._v("ip")]),s._v(" "),a("th",[s._v("ssh username")]),s._v(" "),a("th",[s._v("ssh password")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("docker-host1")]),s._v(" "),a("td",[s._v("192.168.200.10")]),s._v(" "),a("td",[s._v("vagrant")]),s._v(" "),a("td",[s._v("vagrant")])]),s._v(" "),a("tr",[a("td",[s._v("docker-host2")]),s._v(" "),a("td",[s._v("192.168.200.11")]),s._v(" "),a("td",[s._v("vagrant")]),s._v(" "),a("td",[s._v("vagrant")])]),s._v(" "),a("tr",[a("td",[s._v("docker-host3")]),s._v(" "),a("td",[s._v("192.168.200.12")]),s._v(" "),a("td",[s._v("vagrant")]),s._v(" "),a("td",[s._v("vagrant")])])])]),s._v(" "),a("p",[a("strong",[s._v("安装plugin")])]),s._v(" "),a("p",[s._v("在其中两台机器上安装一个plugin "),a("code",[s._v("vieux/sshfs")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[vagrant@docker-host1 ~]$ docker plugin install --grant-all-permissions vieux/sshfs\nlatest: Pulling from vieux/sshfs\nDigest: sha256:1d3c3e42c12138da5ef7873b97f7f32cf99fb6edde75fa4f0bcf9ed277855811\n52d435ada6a4: Complete\nInstalled plugin vieux/sshfs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[vagrant@docker-host2 ~]$ docker plugin install --grant-all-permissions vieux/sshfs\nlatest: Pulling from vieux/sshfs\nDigest: sha256:1d3c3e42c12138da5ef7873b97f7f32cf99fb6edde75fa4f0bcf9ed277855811\n52d435ada6a4: Complete\nInstalled plugin vieux/sshfs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("创建volume")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[vagrant@docker-host1 ~]$ docker volume create --driver vieux/sshfs \\\n                          -o sshcmd=vagrant@192.168.200.12:/home/vagrant \\\n                          -o password=vagrant \\\n                          sshvolume\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查看")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[vagrant@docker-host1 ~]$ docker volume ls\nDRIVER               VOLUME NAME\nvieux/sshfs:latest   sshvolume\n[vagrant@docker-host1 ~]$ docker volume inspect sshvolume\n[\n    {\n        "CreatedAt": "0001-01-01T00:00:00Z",\n        "Driver": "vieux/sshfs:latest",\n        "Labels": {},\n        "Mountpoint": "/mnt/volumes/f59e848643f73d73a21b881486d55b33",\n        "Name": "sshvolume",\n        "Options": {\n            "password": "vagrant",\n            "sshcmd": "vagrant@192.168.200.12:/home/vagrant"\n        },\n        "Scope": "local"\n    }\n]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("strong",[s._v("创建容器挂载Volume")])]),s._v(" "),a("p",[s._v("创建容器，挂载sshvolume到/app目录，然后进入容器的shell，在/app目录创建一个test.txt文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[vagrant@docker-host1 ~]$ docker run -it -v sshvolume:/app busybox sh\nUnable to find image 'busybox:latest' locally\nlatest: Pulling from library/busybox\nb71f96345d44: Pull complete\nDigest: sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d\nStatus: Downloaded newer image for busybox:latest\n/ #\n/ # ls\napp   bin   dev   etc   home  proc  root  sys   tmp   usr   var\n/ # cd /app\n/app # ls\n/app # echo \"this is ssh volume\"> test.txt\n/app # ls\ntest.txt\n/app # more test.txt\nthis is ssh volume\n/app #\n/app #\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("这个文件我们可以在docker-host3上看到")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[vagrant@docker-host3 ~]$ pwd\n/home/vagrant\n[vagrant@docker-host3 ~]$ ls\ntest.txt\n[vagrant@docker-host3 ~]$ more test.txt\nthis is ssh volume\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("如何给已创建的容器额外挂载共享文件夹")])]),s._v(" "),a("p",[a("strong",[s._v("一、背景")])]),s._v(" "),a("p",[s._v("在使用docker过程中，有时候创建容器时候没有设置挂载本地数据卷进行文件夹共享，但已经在容器中配置完了环境，此时再重新创建一个容器非常麻烦，因此需要对已有的容器挂载数据卷。")]),s._v(" "),a("p",[a("strong",[s._v("二、挂载原理")])]),s._v(" "),a("p",[s._v("Docker中所有的容器的配置，如挂载点、运行方式等都是以json文件进行配置，修改对应的json文件参数即可挂载指定文件夹。")]),s._v(" "),a("p",[s._v("配置容器的json文件"),a("br"),s._v(" "),a("code",[s._v("/var/lib/docker/containers/<容器ID>/config.v2.json")]),a("br"),s._v(" "),a("code",[s._v("/var/lib/docker/containers/<容器ID>/hostconfig.json")])]),s._v(" "),a("p",[a("strong",[s._v("三、打开文件")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("使用 "),a("code",[s._v("docker ps -a")]),s._v("拿到需要更改的container的12位ID，然后"),a("code",[s._v("docker inspect id")]),s._v("，拿到64位ID(终端最上面的那个ID)")])]),s._v(" "),a("li",[a("p",[s._v("停止所有container 并使用"),a("code",[s._v("service docker stop")]),s._v("关闭docker服务（"),a("strong",[s._v("必须关闭Docker服务，否则无法修改成功")]),s._v("）")])]),s._v(" "),a("li",[a("p",[s._v("到目录"),a("code",[s._v("/var/lib/docker/containers/<64位容器ID>/")]),s._v("中复制 "),a("code",[s._v("config.v2.json")]),s._v("和 "),a("code",[s._v("hostconfig.json")]),s._v("两个文件到任意不用root权限的目录下，同时对原文件进行备份。")]),s._v(" "),a("p",[s._v("4.在"),a("code",[s._v("~/")]),s._v("下新建两个同名文件(避免权限问题)"),a("br"),s._v(" "),a("code",[s._v("cd ~/")]),a("br"),s._v(" "),a("code",[s._v("touch config.v2.json hostconfig.json")])])])]),s._v(" "),a("p",[s._v("5.新开一个终端，进入到容器目录下，打开文件"),a("br"),s._v(" "),a("code",[s._v("sudo -i")]),s._v(" ，提升权限"),a("br"),s._v(" "),a("code",[s._v("cd /var/lib/docker/containers/<64位容器ID>/")])]),s._v(" "),a("p",[s._v("修改前一定要先备份下，否则改错了就GG！"),a("br"),s._v(" "),a("code",[s._v("cp config.v2.json config.v2.json.back")]),a("br"),s._v(" "),a("code",[s._v("cp hostconfig.json hostconfig.back")])]),s._v(" "),a("p",[a("strong",[s._v("四、添加共享文件夹挂载信息")])]),s._v(" "),a("p",[s._v("打开**"),a("code",[s._v("~/")]),s._v("目录**下的这两个文件")]),s._v(" "),a("p",[s._v("1.修改"),a("code",[s._v("config.v2.json")]),s._v("文件")]),s._v(" "),a("p",[a("img",{attrs:{src:t(550),alt:"image-20230624001942212"}})]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("MountPoints")]),s._v("参数下按照相应的格式进行添加相应的字段，"),a("strong",[s._v("注意，必须是绝对路径，且不能是/root，必须是/root/的二级子目录")]),s._v("。")]),s._v(" "),a("p",[s._v("2.修改"),a("code",[s._v("hostconfig.json")]),s._v("文件")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("hostconfig.json")]),s._v("文件中的"),a("code",[s._v("Binds")]),s._v("参数添加宿主机和容器共享文件夹目录（"),a("strong",[s._v("注意，必须是绝对路径，且不能是/root，必须是/root/dataset这样的二级子目录")]),s._v("）")]),s._v(" "),a("p",[a("img",{attrs:{src:t(551),alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("五、修改容器配置")])]),s._v(" "),a("p",[a("strong",[s._v("把")]),a("code",[s._v("～/")]),s._v("目录下的"),a("code",[s._v("config.v2.json")]),s._v("和"),a("code",[s._v("hostconfig.json")]),s._v("两个文件内容，对应复制到以下文件中。"),a("br"),s._v(" "),a("code",[s._v("/var/lib/docker/containers/<容器ID>/config.v2.json")]),a("br"),s._v(" "),a("code",[s._v("/var/lib/docker/containers/<容器ID>/hostconfig.json")])]),s._v(" "),a("p",[a("strong",[s._v("六、启动docker 服务")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("service docker start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_6-docker网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-docker网络"}},[s._v("#")]),s._v(" 6.Docker网络")]),s._v(" "),a("p",[a("strong",[s._v("Bridge 网络")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(552),alt:"docker-volume"}})]),s._v(" "),a("h3",{attrs:{id:"容器间通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器间通信"}},[s._v("#")]),s._v(" "),a("strong",[s._v("容器间通信")])]),s._v(" "),a("p",[a("strong",[s._v("两个容器都连接到了一个叫 docker0 的Linux bridge上")])]),s._v(" "),a("p",[s._v("创建两个容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" box1 busybox /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true; do sleep 3600; done"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" box2 busybox /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true; do sleep 3600; done"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network inspect bridge\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络")]),s._v("\nbrctl show\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("NETWORK ID     NAME      DRIVER    SCOPE\n1847e179a316   bridge    bridge    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\na647a4ad0b4f   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nfbd81b56c009   none      null      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network inspect bridge\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1847e179a316ee5219c951c2c21cf2c787d431d1ffb3ef621b8f0d1edd197b24"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Created"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-07-01T15:28:09.265408946Z"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Scope"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EnableIPv6"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAM"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.0/16"')]),s._v(",\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.1"')]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Internal"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attachable"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ingress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ConfigFrom"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Network"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ConfigOnly"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"03494b034694982fa085cc4052b6c7b8b9c046f9d5f85f30e3a9e716fad20741"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"box1"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"072160448becebb7c9c333dce9bbdf7601a92b1d3e7a5820b8b35976cf4fd6ff"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:11:00:02"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.2/16"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4f3303c84e5391ea37db664fd08683b01decdadae636aaa1bfd7bb9669cbd8de"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"box2"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4cf0f635d4273066acd3075ec775e6fa405034f94b88c1bcacdaae847612f2c5"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:11:00:03"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.3/16"')]),s._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.docker.network.bridge.default_bridge"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.docker.network.bridge.enable_icc"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.docker.network.bridge.enable_ip_masquerade"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.docker.network.bridge.host_binding_ipv4"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.docker.network.bridge.name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker0"')]),s._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.docker.network.driver.mtu"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1500"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("brctl` 使用前需要安装, 对于CentOS, 可以通过 `sudo yum install -y bridge-utils` 安装. 对于Ubuntu, 可以通过 `sudo apt-get install -y bridge-utils\n$ brctl show\nbridge name     bridge id               STP enabled     interfaces\ndocker0         8000.0242759468cf       no              veth8c9bb82\n                                                        vethd8f9afb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("查看路由")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ ip route\ndefault via 10.0.2.2 dev eth0 proto dhcp metric 100\n10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15 metric 100\n172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1\n192.168.200.0/24 dev eth1 proto kernel scope link src 192.168.200.10 metric 101\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"外部访问容器-端口转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#外部访问容器-端口转发"}},[s._v("#")]),s._v(" "),a("strong",[s._v("外部访问容器：端口转发")])]),s._v(" "),a("p",[s._v("不同host主机之间的容器通信")]),s._v(" "),a("p",[s._v("创建容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":80 nginx:1.20.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#暴露端口，外部访问容器")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启防火墙")]),s._v("\nsystemctl restart firewalld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看已经对外暴露的端口，确认端口是否已经暴露")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --list-ports\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:t(553),alt:"image-20230615014550650"}})]),s._v(" "),a("p",[s._v("测试容器间是否通信,让box1去请求web，通信返回一个index文件。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" box1 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://172.17.0.5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(554),alt:"image-20230615014905449"}})]),s._v(" "),a("p",[s._v("测试外部网络是否能访问容器，访问web暴露出来的8080端口")]),s._v(" "),a("p",[a("img",{attrs:{src:t(555),alt:"image-20230615015046323"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(556),alt:"image-20230615014928149"}})]),s._v(" "),a("p",[s._v("同一host暴露出来的端口需唯一，不然后起的服务报错，端口被占用 。这样就保证外部所访问的容器是唯一的。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" web2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":80 nginx:1.20.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(557),alt:"image-20230615031010565"}})]),s._v(" "),a("p",[s._v("如果network采用host模式，暴露出来是默认的80端口")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" web1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" nginx:1.20.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(558),alt:"image-20230615031050706"}})]),s._v(" "),a("h3",{attrs:{id:"同一host中的不同bridge通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同一host中的不同bridge通信"}},[s._v("#")]),s._v(" 同一host中的不同bridge通信")]),s._v(" "),a("p",[s._v("创建和使用 bridge")]),s._v(" "),a("p",[s._v("在上面的启动的容器中，断开web的连接")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network disconnect bridge web\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(559),alt:"image-20230615020041753"}})]),s._v(" "),a("p",[s._v("创建一个自己的mybridge")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create mybridge\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(560),alt:"image-20230615020459251"}})]),s._v(" "),a("p",[s._v("web连接mybridge，要实现box1能通信web，box1也得连接mybridge,而box2是ping不同web。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network connect mybridge web\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" box1 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" web\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network connect mybridge box1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(561),alt:"image-20230615022050502"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(562),alt:"image-20230615022408022"}})]),s._v(" "),a("p",[s._v("创建时可指定路由和ip范围")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" bridge "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--gateway")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.200")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--subnet")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.200")]),s._v(".0.0/16 detailbridge\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(563),alt:"image-20230615022856154"}})]),s._v(" "),a("h3",{attrs:{id:"容器通信的底层原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器通信的底层原理"}},[s._v("#")]),s._v(" 容器通信的底层原理：")]),s._v(" "),a("p",[a("strong",[s._v("-----------------------------------------网络命名空间和虚拟网络设备对")])]),s._v(" "),a("p",[s._v("Linux的Namespace（命名空间）技术是一种隔离技术，常用的Namespace有 user namespace, process namespace, network namespace等")]),s._v(" "),a("p",[s._v("网络命名空间 是 Linux 内核用来隔离不同容器间的网络资源（每个 Docker 容器都拥有一个独立的网络命名空间），网络命名空间主要隔离的资源包括：")]),s._v(" "),a("p",[s._v("1.iptables规则表")]),s._v(" "),a("p",[s._v("2.路由规则表")]),s._v(" "),a("p",[s._v("3.网络设备列表")]),s._v(" "),a("p",[s._v("如下图所示，当系统中拥有 3 个网络命名空间：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(564),alt:"image-20230624000916878"}})]),s._v(" "),a("p",[s._v("由于不同的网络命名空间之间是相互隔离的，所以不同的网络命名空间之间并不能直接通信。比如在 网络命名空间A 配置了一个 IP 地址为 172.17.42.1 的设备，但在 网络命名空间B 里却不能访问，如下图所示：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(565),alt:"image-20230624000945278"}})]),s._v(" "),a("p",[s._v("就好比两台电脑，如果没有任何网线连接，它们之间是不能通信的。所以，Linux 内核提供了 虚拟网络设备对（veth） 这个功能，用于解决不同网络命名空间之间的通信。")]),s._v(" "),a("p",[s._v("Docker 就是使用 虚拟网络设备对 来实现不同容器之间的通信，其原理如下图：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(566),alt:"image-20230624001011324"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(567),alt:"image-20230615194209960"}})]),s._v(" "),a("p",[s._v("以下模拟的是容器的通信原理，即不同命名空间的通信")]),s._v(" "),a("p",[s._v("新建增加网络命名空间脚本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" add-ns-to-br.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bridge")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("addr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟网络设备对")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在docker0上")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vethA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("veth-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在容器内")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vethB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth00-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建命名空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建一个veth pair")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethA")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" veth peer name "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置虚拟网络设备所属命名空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethB")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给虚拟网络设备添加ip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$addr")]),s._v(" dev "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启网络命令空间 namespace vethB 端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethB")]),s._v(" up\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethA")]),s._v(" up\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" brctl addif "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bridge")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vethA")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("brctl --help查看使用命令 \n\nUsage: brctl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("commands"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncommands:\n   addbr           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" bridge\n   delbr           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                delete bridge\n   addif           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" interface to bridge\n   delif           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       delete interface from bridge\n   hairpin         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("        turn hairpin on/off\n   setageing       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" ageing "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n   setbridgeprio   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("prio"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" bridge priority\n   setfd           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" bridge forward delay\n   sethello        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" hello "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n   setmaxage       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" max message age\n   setpathcost     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("cost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" path cost\n   setportprio     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("prio"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" port priority\n   show            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            show a list of bridges\n   showmacs        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                show a list of mac addrs\n   showstp         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                show bridge stp info\n   stp             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bridge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("       turn stp on/off\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@container1 docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip netns help")]),s._v("\nUsage: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns list\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" NAME\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" NAME NETNSID\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" netns delete "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns identify "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns pids NAME\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" cmd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns monitor\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns list-id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("启动两个容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" box3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" mybridge  busybox /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true; do sleep 3600; done"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" box4 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" mybridge  busybox /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true; do sleep 3600; done"')]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(568),alt:"image-20230615164951809"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(569),alt:"image-20230615165300217"}})]),s._v(" "),a("p",[s._v("获取bridge name")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("brctl show\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(570),alt:"image-20230615165442594"}})]),s._v(" "),a("p",[s._v("设置命名空间")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" add-ns-to-br.sh br-1379584d9670 ns1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.2/16\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" add-ns-to-br.sh br-1379584d9670 ns2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.3/16\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络命名空间list")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入命令空间查看ip信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns2 \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" a\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:t(571),alt:"image-20230615191429985"}})]),s._v(" "),a("p",[s._v("以上就是模拟实现了不同网络命名空间之间的通信。")]),s._v(" "),a("p",[s._v("断开虚拟网络设备，不同的网络命名空间就ping不同，实现隔离。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" veth-ns1 down\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(572),alt:"image-20230615204622919"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启网卡")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" network restart\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看配置信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#错误日志查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/log/messages "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" network\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看docker的情况")]),s._v("\nsystemctl status docker.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关掉网桥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" docker0 down\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除网桥")]),s._v("\nbrctl delbr docker0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"_7-docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-docker-compose"}},[s._v("#")]),s._v(" 7.Docker Compose")]),s._v(" "),a("h3",{attrs:{id:"docker-compose-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-介绍"}},[s._v("#")]),s._v(" docker compose 介绍")]),s._v(" "),a("p",[s._v("要启动一些容器需进行一系列操作，一般我们使用shell脚本进行一键式操作。而基于这个需求，docker compose就是专门用于解决这种组合的操作。通过配置yml文件来实现。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(573),alt:"docker-compose-intro"}})]),s._v(" "),a("h3",{attrs:{id:"docker-compose-的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-的安装"}},[s._v("#")]),s._v(" docker compose 的安装")]),s._v(" "),a("p",[s._v("Windows和Mac在默认安装了docker desktop以后，docker-compose随之自动安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("PS C:\\Users\\Peng Xiao\\docker.tips> docker-compose --version\ndocker-compose version 1.29.2, build 5becea4c\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Linux用户需要自行安装")]),s._v(" "),a("p",[s._v("最新版本号可以在这里查询 https://github.com/docker/compose/releases")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n$ sudo chmod +x /usr/local/bin/docker-compose\n$ docker-compose --version\ndocker-compose version 1.29.2, build 5becea4c\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("熟悉python的朋友，可以使用pip去安装docker-Compose")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#快速安装对应版本pip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://bootstrap.pypa.io/pip/3.6/get-pip.py\npython3 get-pip.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("pip install docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"docker-compose基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose基本使用"}},[s._v("#")]),s._v(" docker-compose基本使用")]),s._v(" "),a("p",[a("strong",[s._v("compose 文件的结构和版本")])]),s._v(" "),a("p",[s._v("docker compose文件的语法说明 https://docs.docker.com/compose/compose-file/")]),s._v(" "),a("p",[a("strong",[s._v("基本语法结构")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('version: "3.8"\n\nservices: # 容器\n  servicename: # 服务名字，这个名字也是内部 bridge网络可以使用的 DNS name\n    image: # 镜像的名字\n    command: # 可选，如果设置，则会覆盖默认镜像里的 CMD命令\n    environment: # 可选，相当于 docker run里的 --env\n    volumes: # 可选，相当于docker run里的 -v\n    networks: # 可选，相当于 docker run里的 --network\n    ports: # 可选，相当于 docker run里的 -p\n  servicename2:\n\nvolumes: # 可选，相当于 docker volume create\n\nnetworks: # 可选，相当于 docker network create\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("以 Python Flask + Redis练习：为例子，改造成一个docker-compose文件")]),s._v(" "),a("p",[s._v("自定义的flask-demo")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" flask "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Flask\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Redis\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" socket\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nredis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REDIS_HOST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("incr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"Hello Container World! I have been seen ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(" times and my hostname is ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("socket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gethostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('.\\n"')])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("Dockerfile")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-slim")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" python -m pip install --upgrade pip && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    pip install flask redis && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    groupadd -r flask && useradd -r -g flask flask && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    mkdir /src && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    chown -R flask:flask /src")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" flask")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_APP=app.py REDIS_HOST=redis")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" app.py /src/app.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 5000")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("未使用docker-compose之前的操作")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker image pull redis\ndocker image build -t flask-demo .\n\n# create network\ndocker network create -d bridge demo-network\n\n# create container\ndocker container run -d --name redis-server --network demo-network redis\ndocker container run -d --network demo-network --name flask-demo --env REDIS_HOST=redis-server -p 5000:5000 flask-demo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("只构建flask-demo镜像，后面可以直接拉取")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" flask-demo "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("docker-compose.yml 文件如下")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flask-demo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_HOST=redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("demo-network")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("基本操作")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Usage:\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("arg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--profile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COMMAND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ARGS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" -h"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("--help\n\nCommands:\nbuild              Build or rebuild services\nconfig             Validate and view the Compose "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\ncreate             Create services\ndown               Stop and remove resources\nevents             Receive real "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" events from containers\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("               Execute a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a running container\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("               Get "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" on a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\nimages             List images\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v("               Kill containers\nlogs               View output from containers\npause              Pause services\nport               Print the public port "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a port binding\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("                 List containers\npull               Pull "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" images\npush               Push "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" images\nrestart            Restart services\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("                 Remove stopped containers\nrun                Run a one-off "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\nscale              Set number of containers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\nstart              Start services\nstop               Stop services\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("                Display the running processes\nunpause            Unpause services\nup                 Create and start containers\nversion            Show version information and quit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确认配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" config\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从配置build的Dockerfile构建镜像，并不会启动容器，可以用于构建镜像或者更新镜像，没配置直接拉取镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" build \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取镜像启动服务，镜像不存在，按情况从仓库拉取或build")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:t(574),alt:"image-20230616003716859"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(575),alt:"image-20230615233815833"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看compose中的相关镜像，只显示该compose服务包含的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" images\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器的运行情况")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:t(576),alt:"image-20230616003533812"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对容器的操作就是docker的操作")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" 0b "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对redis进行读写数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 v1\nget k1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:t(577),alt:"image-20230616005138911"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" stop\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移除停止container")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:t(578),alt:"image-20230616005633040"}})]),s._v(" "),a("h3",{attrs:{id:"docker-compose-服务的构建、拉取与更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-服务的构建、拉取与更新"}},[s._v("#")]),s._v(" docker-compose 服务的构建、拉取与更新")]),s._v(" "),a("p",[s._v("带有build的yml，会视情况构建镜像")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flask-demo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_HOST=redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("demo-network")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("img",{attrs:{src:t(579),alt:"image-20230616010445855"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据Dockerfile重新下载需要的镜像并构建容器,并启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--build")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新启动单个容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--build")]),s._v(" flask\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("根据Dockerfile重新下载需要的镜像并构建容器，也就是说这句相当于是 docker-compose build --no-cache 和 docker-compose up -d 的集合体，"),a("br"),s._v("\n意味着构建镜像的时候是根据Dockerfile的最新内容来的，而不会使用缓存，这样就避免了构建镜像时由于缓存造成的影响。")])]),s._v(" "),a("h3",{attrs:{id:"docker-compose-网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-网络"}},[s._v("#")]),s._v(" docker-compose 网络")]),s._v(" "),a("p",[s._v("如果配置没指定网络，则创建默认的网络docker-compose_default（文件目录_default）")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("box1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:t(580),alt:"image-20230616030540760"}})]),s._v(" "),a("p",[s._v("多网络的配置")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("box1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('c "while true; do sleep 3600; done"\n    '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network1\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("box2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('c "while true; do sleep 3600; done"\n    '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("box3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('c "while true; do sleep 3600; done"\n    '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network1\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("network2\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("demo-network1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ipam")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" defaule\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 172.28.0.0/16\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("demo-network2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[a("img",{attrs:{src:t(581),alt:"image-20230616024620573"}})]),s._v(" "),a("p",[s._v("按照配置，box1和box2 ping不通，都能和box3通信")]),s._v(" "),a("p",[a("img",{attrs:{src:t(582),alt:"image-20230616032013489"}})]),s._v(" "),a("h3",{attrs:{id:"水平扩展-scale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#水平扩展-scale"}},[s._v("#")]),s._v(" 水平扩展 scale")]),s._v(" "),a("p",[s._v("去掉端口指定，不然端口占用，启动失败")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\nservices:\n  flask:\n    build:\n      context: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/flask\n      dockerfile: Dockerfile\n    image: flask-demo:latest\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis-server\n    networks:\n      - demo-network\n\n  redis-server:\n    image: redis:latest\n    networks:\n      - demo-network\n  client:\n    image: busybox\n    command: /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"while true; do sleep 3600; done"')]),s._v("\n    networks:\n      - demo-network\n\nnetworks:\n  demo-network:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--build")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--scale")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flask")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(583),alt:"image-20230616034818237"}})]),s._v(" "),a("p",[s._v("与服务器通信")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" flask\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#busybox没有curl命令使用wget")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O- flask:5000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#也可以用封装好的image")]),s._v("\nxiaopeng163/net-box:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[a("code",[s._v("wget -O-")]),s._v("以'-'作为file参数，那么数据将会被打印到标准输出，通常为控制台。")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(584),alt:"image-20230616035043531"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(585),alt:"image-20230616143909418"}})]),s._v(" "),a("p",[s._v("外部如何访问，flask端口不能写死暴露？")]),s._v(" "),a("p",[s._v("通过nginx反向代理")]),s._v(" "),a("p",[s._v("nginx.conf 配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n  listen  80 default_server;\n  location / {\n    proxy_pass http://flask:5000;\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("yml配置")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flask")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ../flask\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_HOST=redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" frontend\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" backend\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" backend\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("stable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" flask\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ../nginx/nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d/default.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ../log/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log/nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" frontend\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("frontend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("blockquote",[a("p",[s._v("服务的依赖：nginx依赖flask，flask依赖redis，通过depend_on配置来定义程序启动顺序")]),s._v(" "),a("p",[a("strong",[s._v("和")]),a("code",[s._v("ports")]),a("strong",[s._v("的区别是，")]),a("code",[s._v("expose")]),a("strong",[s._v("不会将端口暴露给主机，主机无法访问")]),a("code",[s._v("expose")]),a("strong",[s._v("的端口。")])])]),s._v(" "),a("p",[s._v(".dockerignore")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(".env\n.dockerignore\nDockerfile\ndocker-compose.yaml\nnginx.conf\nvar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--build")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--scale")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flask")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(586),alt:"image-20230616155516681"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(587),alt:"image-20230616155244344"}})]),s._v(" "),a("h3",{attrs:{id:"docker-compose-环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-环境变量"}},[s._v("#")]),s._v(" docker compose 环境变量")]),s._v(" "),a("p",[s._v("上述涉及的redis若添加密码，无论写到代码里还是配置里都是不安全的，故可以写到.env里面，.env文件.dockerignore文件不上传。")]),s._v(" "),a("p",[s._v(".env")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ABC123\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("yml文件")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flask")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ../flask\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_HOST=redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_PASS=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("REDIS_PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" frontend\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" backend\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("requirepass $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("REDIS_PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" backend\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("stable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" flask\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ../nginx/nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d/default.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ../log/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log/nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" frontend\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("frontend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[s._v("app.py增加获取该变量")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" flask "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Flask\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" StrictRedis\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" socket\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nredis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" StrictRedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REDIS_HOST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'REDIS_PASS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("incr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"Hello Container World! I have been seen ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(" times and my hostname is ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("socket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gethostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('.\\n"')])]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("img",{attrs:{src:t(588),alt:"image-20230616161615653"}})]),s._v(" "),a("h3",{attrs:{id:"docker-compose-健康检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-健康检查"}},[s._v("#")]),s._v(" docker compose 健康检查")]),s._v(" "),a("p",[s._v("Dockerfile healthcheck https://docs.docker.com/engine/reference/builder/#healthcheck")]),s._v(" "),a("p",[s._v("docker compose https://docs.docker.com/compose/compose-file/compose-file-v3/#healthcheck")]),s._v(" "),a("p",[s._v("健康检查是容器运行状态的高级检查，主要是检查容器所运行的进程是否能正常的对外提供“服务”，比如一个数据库容器，我们不光 需要这个容器是up的状态，我们还要求这个容器的数据库进程能够正常对外提供服务，这就是所谓的健康检查。")]),s._v(" "),a("p",[a("strong",[s._v("容器的健康检查")])]),s._v(" "),a("p",[s._v("容器本身有一个健康检查的功能，但是需要在Dockerfile里定义，或者在执行docker container run 的时候，通过下面的一些参数指定")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("--health-cmd string              Command to run to check health\n--health-interval duration       Time between running the check\n                                (ms|s|m|h) (default 0s)\n--health-retries int             Consecutive failures needed to\n                                report unhealthy\n--health-start-period duration   Start period for the container to\n                                initialize before starting\n                                health-retries countdown\n                                (ms|s|m|h) (default 0s)\n--health-timeout duration        Maximum time to allow one check to\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("Dockerfile healthcheck示例源码")])]),s._v(" "),a("p",[s._v("我们以下面的这个flask容器为例，Dockerfile如下")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-slim")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install flask redis && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get update && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    apt-get install -y curl && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    groupadd -r flask && useradd -r -g flask flask && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    mkdir /src && "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    chown -R flask:flask /src")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" flask")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" app.py /src/app.py")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_APP=app.py REDIS_HOST=redis")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 5000")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HEALTHCHECK")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token options"}},[a("span",{pre:!0,attrs:{class:"token property"}},[s._v("--interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("30s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("--timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("3s")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" curl -f http://localhost:5000/ || exit 1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("上面Dockerfili里的HEALTHCHECK 就是定义了一个健康检查。 会每隔30秒检查一次，如果失败就会退出，退出代码是1")]),s._v(" "),a("p",[s._v("查看容器状态")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker container ls\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS                            PORTS      NAMES\n059c12486019   flask-demo   "flask run -h 0.0.0.0"   4 hours ago   Up 8 seconds (health: starting)   5000/tcp   dazzling_tereshkova\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("也可以通过docker container inspect 059 查看详情， 其中有有关health的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"Health": {\n"Status": "starting",\n"FailingStreak": 1,\n"Log": [\n    {\n        "Start": "2021-07-14T19:04:46.4054004Z",\n        "End": "2021-07-14T19:04:49.4055393Z",\n        "ExitCode": -1,\n        "Output": "Health check exceeded timeout (3s)"\n    }\n]\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("模拟实现故障，把redis停掉之后，经过3次检查，一直是不通的，然后health的状态会从starting变为 unhealthy")]),s._v(" "),a("p",[a("img",{attrs:{src:t(589),alt:"image-20230616165246979"}})]),s._v(" "),a("p",[s._v("重启redis，经过几秒钟，我们的flask 变成了healthy")]),s._v(" "),a("p",[a("img",{attrs:{src:t(590),alt:"image-20230616165405507"}})]),s._v(" "),a("p",[a("strong",[s._v("docker compose health示例")])]),s._v(" "),a("p",[s._v("除了在Dockerfile中配置，还可以在docker-compose.yml文件中配置")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.8"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flask")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ../flask\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_HOST=redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("healthcheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CMD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-f"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:5000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("start_period")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 40s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("condition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_healthy\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" frontend\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" backend\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("healthcheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CMD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-cli"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" backend\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("stable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flask")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("condition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_healthy\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ../nginx/nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d/default.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ../log/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log/nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" frontend\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("frontend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("p",[a("img",{attrs:{src:t(591),alt:"image-20230616172342028"}})]),s._v(" "),a("h3",{attrs:{id:"一站式hadoop集群便于测试开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一站式hadoop集群便于测试开发"}},[s._v("#")]),s._v(" 一站式hadoop集群便于测试开发")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/liugp/p/17279520.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("通过 docker-compose 快速部署 Hadoop 集群详细教程 - 大数据老司机 - 博客园 (cnblogs.com)"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("包含了zookeeper 3.8.0，mysql5.7，hadoop3.3.5，hive3.1.3，spark 3.3.2，Flink1.17.0")]),s._v(" "),a("h4",{attrs:{id:"_1、下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载"}},[s._v("#")]),s._v(" 1、下载")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("git clone https://gitee.com/hadoop-bigdata/docker-compose-hadoop.git\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2、创建网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建网络"}},[s._v("#")]),s._v(" 2、创建网络")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 创建，注意不能使用hadoop_network，要不然启动hs2服务的时候会有问题！！！\ndocker network create hadoop-network\n\n# 查看\ndocker network ls\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_3、部署-mysql5-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、部署-mysql5-7"}},[s._v("#")]),s._v(" 3、部署 mysql5.7")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd docker-compose-hadoop/mysql\n\ndocker-compose -f mysql-compose.yaml up -d\n\ndocker-compose -f mysql-compose.yaml ps\n\n#root 密码：123456，以下是登录命令，注意一般在公司不能直接在命令行明文输入密码，要不然容易被安全抓，切记，切记！！！\ndocker exec -it mysql mysql -uroot -p123456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"_4、部署-hadoop-hive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、部署-hadoop-hive"}},[s._v("#")]),s._v(" 4、部署 Hadoop Hive")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('cd docker-compose-hadoop/hadoop_hive\n\ndocker-compose -f docker-compose.yaml up -d\n\n# 查看\ndocker-compose -f docker-compose.yaml ps\n# 查看指定列\ndocker ps --format "table {{.ID}}\\t{{.Names}}\\t{{.Ports}}"\n\n# hive\ndocker exec -it hive-hiveserver2 hive -e "show databases";\n\n# hiveserver2\ndocker exec -it hive-hiveserver2 beeline -u jdbc:hive2://hive-hiveserver2:10000  -n hadoop -e "show databases;"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("5.测试访问hdfs UI 和 yarn UI ，该项目设置的是http: //ip:30070 和http: //ip:30889")]),s._v(" "),a("p",[s._v("6.yarn ui地址在镜像中写死了，如果没有进行转发处理，宿主机无法访问，可以进入hadoop-yarn-nm进行修改，写自己的域名，docker-compose.yaml中的暴露端口与之对应，然后重启。")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("yarn.web-proxy.address"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("container1:9111"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:t(592),alt:"image-20230618005439820"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(593),alt:"image-20230618010027391"}})]),s._v(" "),a("h2",{attrs:{id:"_8-docker-swarm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-docker-swarm"}},[s._v("#")]),s._v(" 8.Docker Swarm")]),s._v(" "),a("h3",{attrs:{id:"docker-swarm-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm-介绍"}},[s._v("#")]),s._v(" docker swarm 介绍")]),s._v(" "),a("p",[s._v("为什么不建议在生产环境中使用docker-compose")]),s._v(" "),a("ul",[a("li",[s._v("多机器如何管理？")]),s._v(" "),a("li",[s._v("如果跨机器做scale横向扩展？")]),s._v(" "),a("li",[s._v("容器失败退出时如何新建容器确保服务正常运行？")]),s._v(" "),a("li",[s._v("如何确保零宕机时间？")]),s._v(" "),a("li",[s._v("如何管理密码，Key等敏感数据？")]),s._v(" "),a("li",[s._v("其它")])]),s._v(" "),a("p",[a("strong",[s._v("容器编排 swarm")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(594),alt:"docker-swarm-intro"}})]),s._v(" "),a("p",[s._v("Swarm的基本架构")]),s._v(" "),a("p",[a("img",{attrs:{src:t(595),alt:"docker-swarm-arch"}})]),s._v(" "),a("h3",{attrs:{id:"swarm-单节点快速上手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swarm-单节点快速上手"}},[s._v("#")]),s._v(" Swarm 单节点快速上手")]),s._v(" "),a("p",[a("strong",[s._v("初始化")])]),s._v(" "),a("p",[s._v("这个命令可以查看我们的docker engine有没有激活swarm模式， 默认是没有的，我们会看到")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(596),alt:"image-20230616195332575"}})]),s._v(" "),a("p",[s._v("激活swarm，有两个方法：")]),s._v(" "),a("ul",[a("li",[s._v("初始化一个swarm集群，自己成为manager")]),s._v(" "),a("li",[s._v("加入一个已经存在的swarm集群")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Swarm Commands:\nconfig      Manage Swarm configs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("        Manage Swarm nodes\nsecret      Manage Swarm secrets\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("     Manage Swarm services\nstack       Manage Swarm stacks\nswarm       Manage Swarm\n\n\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm COMMAND\n\nManage Swarm\n\nCommands:\nca          Display and rotate the root CA\ninit        Initialize a swarm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v("        Join a swarm as a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" and/or manager\njoin-token  Manage "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" tokens\nleave       Leave the swarm\nunlock      Unlock swarm\nunlock-key  Manage the unlock key\nupdate      Update the swarm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[a("img",{attrs:{src:t(597),alt:"image-20230616201111290"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化一个集群")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm init\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看集群节点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看node的信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" inspect "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("node id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:t(598),alt:"image-20230616201211209"}})]),s._v(" "),a("p",[a("strong",[s._v("docker swarm init 背后发生了什么")])]),s._v(" "),a("p",[s._v("主要是PKI和安全相关的自动化")]),s._v(" "),a("ul",[a("li",[s._v("创建swarm集群的根证书")]),s._v(" "),a("li",[s._v("manager节点的证书")]),s._v(" "),a("li",[s._v("其它节点加入集群需要的tokens")])]),s._v(" "),a("p",[s._v("创建Raft数据库用于存储证书，配置，密码等数据")]),s._v(" "),a("p",[s._v("RAFT相关资料")]),s._v(" "),a("ul",[a("li",[s._v("http://thesecretlivesofdata.com/raft/")]),s._v(" "),a("li",[s._v("https://raft.github.io/")]),s._v(" "),a("li",[s._v("https://docs.docker.com/engine/swarm/raft/")])]),s._v(" "),a("p",[s._v("看动画学会 Raft 算法")]),s._v(" "),a("p",[s._v("https://mp.weixin.qq.com/s/p8qBcIhM04REuQ-uG4gnbw")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("swarm join-token ：可以查看或更换join token。\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token worker：查看加入woker的命令。\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token manager：查看加入manager的命令\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rotate")]),s._v(" worker：重置woker的Token。\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm join-token "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" worker：仅打印Token。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打开另外的虚拟机作为worker 加入，执行以下命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" SWMTKN-1-3hocsrayh278lv0lz17g0ty5bxedekofilq3pbiaj9xskqcjmh-331n58myelyc6bej36wosd69v "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.10:2377\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(599),alt:"image-20230617134719031"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打开manager所在的虚拟机，查看node情况")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(600),alt:"image-20230617134833434"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" nginx:stable-alpine\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("调节service的副本数在docker swarm中可以在创建service时，通过设置--replicas 来设置副本数，但是当服务运行起来后应该如何处理呢？docker 提供了scale命令来实现这个功能")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#scale 动态扩缩容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" scale "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(601),alt:"image-20230617143823599"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#动态更新服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx:latest nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#动态回滚服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" update  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rollback")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:t(602),alt:"image-20230617144531651"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(603),alt:"image-20230617144619636"}})]),s._v(" "),a("h3",{attrs:{id:"docker-stack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-stack"}},[s._v("#")]),s._v(" Docker Stack")]),s._v(" "),a("p",[s._v("docker 与docker-compose的区别是后者可以部署多个容器；")]),s._v(" "),a("p",[s._v("docker swarm与docker stack的区别是stack可以部署多个服务；")]),s._v(" "),a("p",[s._v("docker stack与docker-compose的区别，stack是集群式，compose是单机模式，多用于开发测试。")]),s._v(" "),a("p",[s._v("stack获取不到.env，找到githup上的一种方法：")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/moby/moby/issues/29133",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("docker stack deploy")]),s._v(" in 1.13 doesn't load "),a("code",[s._v(".env")]),s._v(" file as "),a("code",[s._v("docker-compose up")]),s._v(" does · Issue #29133 · moby/moby (github.com)"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .env "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("A-Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stack deploy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" stack.yaml STACK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("任务的编排可以进阶学习k8s。")]),s._v(" "),a("h2",{attrs:{id:"_9-docker整合gitlab-cicd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-docker整合gitlab-cicd"}},[s._v("#")]),s._v(" 9.Docker整合gitlab CICD")]),s._v(" "),a("h3",{attrs:{id:"单模块下部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单模块下部署"}},[s._v("#")]),s._v(" 单模块下部署")]),s._v(" "),a("p",[a("strong",[s._v("Dockerfile配置")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8-jre-alpine")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /tmp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###复制文件到容器app-springboot")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./target/cicd-0.0.1-SNAPSHOT.jar app.jar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v(".gitlab-ci.yml配置")])]),s._v(" "),a("p",[s._v("单环境")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1：需要用到的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2：必须配置的一些环境变量。如果本地可不配置 DOCKER_HOST。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3：配置缓存，配置后，maven 下载的依赖可以被缓存起来，下次不需要重复去下载了。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4：配置需要用到的额外的服务。docker:dind，这个貌似是用于在 docker 中运行 docker 的一种东西，在项目的构建中需要。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有时需要在容器内执行 docker 命令，比如：在 jenkins 容器内运行 docker 命令执行构建镜像")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接在 docker 容器内嵌套安装 docker 未免太过臃肿")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更好的办法是：容器内仅部署 docker 命令行工具（作为客户端），实际执行交由宿主机内的 docker-engine（服务器）")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先启动一个docker:dind容器A，再启动一个docker容器B，容器B指定host为A容器内的docker daemon。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5：stages，这是 Gitlab CI 中的概念，Stages 表示构建阶段，就是一些按序执行的流程，具体执行是依赖于 Jobs 的。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6 ：定义的 Jobs 之一，用于构建 jar 包。内部又引入 maven 镜像来处理，负责执行 package 这一流程。script 为具体执行的脚本。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7：定义的 Jobs 之一，用于构建 Docker 镜像。负责执行 deploy 这一流程。具体执行 build 和 run。only 节点表示只监控 master 分支。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" overlay2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.8.10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker host，本地可不写")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_TLS_CERTDIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root/hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" m2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .m2/repository\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("dind\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" package\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maven-package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.5.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" maven\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" package\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mvn clean package "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dmaven.test.skip=true\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" target/"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.jar")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-master")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8888"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8888 $TAG\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("p",[s._v("多环境")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1：需要用到的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2：必须配置的一些环境变量。如果本地可不配置 DOCKER_HOST。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3：配置缓存，配置后，maven 下载的依赖可以被缓存起来，下次不需要重复去下载了。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4：配置需要用到的额外的服务。docker:dind，这个貌似是用于在 docker 中运行 docker 的一种东西，在项目的构建中需要。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有时需要在容器内执行 docker 命令，比如：在 jenkins 容器内运行 docker 命令执行构建镜像")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接在 docker 容器内嵌套安装 docker 未免太过臃肿")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更好的办法是：容器内仅部署 docker 命令行工具（作为客户端），实际执行交由宿主机内的 docker-engine（服务器）")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先启动一个docker:dind容器A，再启动一个docker容器B，容器B指定host为A容器内的docker daemon。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5：stages，这是 Gitlab CI 中的概念，Stages 表示构建阶段，就是一些按序执行的流程，具体执行是依赖于 Jobs 的。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6 ：定义的 Jobs 之一，用于构建 jar 包。内部又引入 maven 镜像来处理，负责执行 package 这一流程。script 为具体执行的脚本。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7：定义的 Jobs 之一，用于构建 Docker 镜像。负责执行 deploy 这一流程。具体执行 build 和 run。only 节点表示只监控 master 分支。")]),s._v("\n\nimage: docker:latest  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\nvariables:  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  DOCKER_DRIVER: overlay2\n  DOCKER_HOST: tcp://192.168.8.10:2375  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker host，本地可不写")]),s._v("\n  DOCKER_TLS_CERTDIR: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  USERSERVICE_TAG: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("':1.0'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像版本号")]),s._v("\n  USERSERVICE_NAME: cicd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像名称")]),s._v("\n  USERSERVICE_RPORT: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像端口 容器内的端口与其不一致")]),s._v("\n  USERSERVICE_DIRECTORY: cicd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块目录")]),s._v("\n  PROFILE_ACTIVE: prd\ncache:  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3")]),s._v("\n  key: m2-repo\n  paths:\n    - .m2/repository\nservices:  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4")]),s._v("\n  - docker:dind\nstages:  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5")]),s._v("\n  - package\n  - deploy-dev\n  - deploy-prd\nmaven-package:  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6")]),s._v("\n  image: maven:3.5.0-jdk-8\n  tags:\n    - maven\n  stage: package\n  script:\n    - mvn clean package "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dmaven.test.skip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n  artifacts:\n    paths:\n      - target/*.jar\nbuild-dev:\n  tags:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n  stage: deploy-dev\n  script:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_PASSWORD")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" Dockerfile "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v(":/apps "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_RPORT")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_RPORT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n  only: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制作业在什么时候创建，定义了哪些分支或标签(branches and tags)的作业会运行")]),s._v("\n    refs: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分支")]),s._v("\n      - dev\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#changes: # 下面的文件中任一文件发生改变")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - .gitlab-ci.yml")]),s._v("\nbuild-prd:  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7")]),s._v("\n  tags:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n  stage: deploy-prd\n  before_script:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_PASSWORD")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" Dockerfile "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'which  ssh-agent || ( yum update -y  && yum install openssh-client git -y )'")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("ssh-agent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SSH_PRIVATE_KEY")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\r'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssh-add -\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" ~/.ssh\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" ~/.ssh\n    - ssh-keyscan "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.103 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/known_hosts "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh-keyscan 从服务器收集 SSH公钥。 ssh-keyscan 是一个收集多个主机的 SSH 公共密钥的实用工具。它被设计用来帮助构建和验证 ssh_known_hosts 文件")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/known_hosts\n  script:\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -tq 打印台静默不打印")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.103 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOF\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_PASSWORD")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v(":/apps "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_RPORT")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_RPORT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI_REGISTRY_IMAGE")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_NAME")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$USERSERVICE_TAG")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n    - "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n    - EOF\n  only:\n    variables: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROFILE_ACTIVE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prd"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    refs:\n      - master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br")])]),a("h3",{attrs:{id:"多模块合并部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多模块合并部署"}},[s._v("#")]),s._v(" 多模块合并部署")]),s._v(" "),a("p",[a("strong",[s._v("根目录.gitlab-ci.yml配置")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#stages:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - triggers")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - triggers1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#trigger_a:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  stage: triggers")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  trigger:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include: szbxl-service/szbxl-user-service/.gitlab-ci.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  rules:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    - changes:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        - szbxl-service/szbxl-user-service/*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#trigger_b:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  stage: triggers1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  trigger:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include: szbxl-getway/.gitlab-ci.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  rules:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    - changes:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        - szbxl-getway/*")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" overlay2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.8.10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker host，本地可不写")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_TLS_CERTDIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#激活属性,dev/prod,从Gitlab的变量设置，这样定时部署可以动态指定")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("GIT_STRATEGY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Initialized empty Git repository as it did in the first run of the first job, it now says Reinitialized existing Git repository.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#https://stackoverflow.com/questions/57779750/does-gitlab-runner-or-docker-cache-the-builds-directory-by-default")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多模块.gitlab-ci.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_first/.gitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ci.yml\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_second/.gitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ci.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局关键字。可以在本地的gitlab-ci.yml文件中引入其他地方的gitlab-ci.yml的配置文件。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include:local")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以使用include:local来引入同一个仓库同一个分支中的其他配置文件（其他配置文件必须是.yml 或者.ymal扩展名）")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include:project")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以通过include:project 来引入同一个gitlab 服务中其他项目中的gitlab-ci.yml配置")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主要有下面几部分构成，")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#project：表在该gitlab服务器中的项目地址")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#file：一个数组，表引入该项目中的哪些文件")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ref：非必须，表该项目中的那个分支。没有就是master(main)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include:remote")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用include:remote 可以通过一个完整的URL地址加载远端的gitlab-ci.yml的配置文件。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#远端的配置文件使用HTTP/GTTPS 的GET请求可以获取的到")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("p",[s._v("子模块一目录"),a("strong",[s._v("Dockerfile配置")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不能使用openjdk:8-jre-alpine，原因如下：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、会导致easy-captcha验证码生成失败。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、 Docker启动会报错：ERROR: failed to launch: exec.d: failed to execute exec.d file at path '/layers/paketo-buildpacks_bellsoft-liberica/helper/exec.d/memory-calculator': exit status 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8-jre-alpine")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" author="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gordon"')])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容器内的时区")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" > /etc/timezone")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 环境变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MYPATH /apps/service_first/")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建项目存放路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MYPATH}")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MYPATH}")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 尽量采用指定路径挂载,不然会生成很多临时挂载垃圾文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匿名挂载目录(宿主机位置：/var/lib/docker/volumes/xxxxxxxxxxxxxxxx)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看挂载目录：docker inspect szbxl-user-service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有挂载卷：docker volume ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME ${MYPATH}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tomcat 默认使用/tmp作为工作目录。这个命令的效果是：在宿主机的/var/lib/docker目录下创建一个临时文件并把它链接到容器中的/tmp目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME /tmp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME /log")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加jar包到指定路径,当前目录是WORKDIR")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" service_first/target/*.jar app.jar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#EXPOSE 802")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器执行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","app.jar"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#ENTRYPOINT ["sh", "-c", "java --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.lang.reflect=ALL-UNNAMED -Djava.security.egd=file:/dev/./urandom -jar app.jar"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.jar"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("子模块一目录.gitlab-ci.yml配置")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1：需要用到的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2：必须配置的一些环境变量。如果本地可不配置 DOCKER_HOST。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3：配置缓存，配置后，maven 下载的依赖可以被缓存起来，下次不需要重复去下载了。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4：配置需要用到的额外的服务。docker:dind，这个貌似是用于在 docker 中运行 docker 的一种东西，在项目的构建中需要。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有时需要在容器内执行 docker 命令，比如：在 jenkins 容器内运行 docker 命令执行构建镜像")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接在 docker 容器内嵌套安装 docker 未免太过臃肿")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更好的办法是：容器内仅部署 docker 命令行工具（作为客户端），实际执行交由宿主机内的 docker-engine（服务器）")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先启动一个docker:dind容器A，再启动一个docker容器B，容器B指定host为A容器内的docker daemon。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5：stages，这是 Gitlab CI 中的概念，Stages 表示构建阶段，就是一些按序执行的流程，具体执行是依赖于 Jobs 的。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6 ：定义的 Jobs 之一，用于构建 jar 包。内部又引入 maven 镜像来处理，负责执行 package 这一流程。script 为具体执行的脚本。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7：定义的 Jobs 之一，用于构建 Docker 镜像。负责执行 deploy 这一流程。具体执行 build 和 run。only 节点表示只监控 master 分支。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根目录已提供")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_DRIVER: overlay2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_HOST: tcp://192.168.8.10:2375  # docker host，本地可不写")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_TLS_CERTDIR: ''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PROFILE_ACTIVE: prd")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FIRST_TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("':1.0'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像版本号")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FIRST_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_first "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FIRST_RPORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像端口 容器内的端口与其不一致")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FIRST_DIRECTORY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_first "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" m2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .m2/repository\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("dind\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maven-package:service_first")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.5.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" maven\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mvn clean package -pl service_first -am -Dmaven.test.skip=true -pl --projects <arg> 构建制定的模块，模块间用逗号分隔；-am --also-make 同时构建所列模块的依赖模块；")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mvn clean package "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("P $PROFILE_ACTIVE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dmaven.test.skip=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pl $FIRST_DIRECTORY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("am\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $FIRST_DIRECTORY/target/"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.jar")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-dev:service_first")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $FIRST_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $FIRST_DIRECTORY/Dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name $FIRST_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /apps/$FIRST_DIRECTORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/apps/$FIRST_DIRECTORY/log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $FIRST_RPORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$FIRST_RPORT $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制作业在什么时候创建，定义了哪些分支或标签(branches and tags)的作业会运行")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分支")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dev\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#changes: # 下面的文件中任一文件发生改变")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - .gitlab-ci.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-prd:service_first")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $FIRST_DIRECTORY/Dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'which  ssh-agent || ( yum update -y  && yum install openssh-client git -y )'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" eval $(ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s)\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "$SSH_PRIVATE_KEY" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" tr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d '\\r' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p ~/.ssh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod 700 ~/.ssh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyscan 192.168.8.103 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" ~/.ssh/known_hosts "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh-keyscan 从服务器收集 SSH公钥。 ssh-keyscan 是一个收集多个主机的 SSH 公共密钥的实用工具。它被设计用来帮助构建和验证 ssh_known_hosts 文件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod 644 ~/.ssh/known_hosts\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -tq 打印台静默不打印")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ssh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tq 192.168.8.103 << EOF\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $FIRST_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name $FIRST_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /apps/$FIRST_DIRECTORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/apps/$FIRST_DIRECTORY/log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $FIRST_RPORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$FIRST_RPORT $CI_REGISTRY_IMAGE/$FIRST_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$FIRST_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" exit\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" EOF\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(' $PROFILE_ACTIVE == "prd" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" main\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br")])]),a("p",[s._v("子模块二目录"),a("strong",[s._v("Dockerfile配置")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不能使用openjdk:8-jre-alpine，原因如下：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、会导致easy-captcha验证码生成失败。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、 Docker启动会报错：ERROR: failed to launch: exec.d: failed to execute exec.d file at path '/layers/paketo-buildpacks_bellsoft-liberica/helper/exec.d/memory-calculator': exit status 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:8-jre-alpine")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" author="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gordon"')])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容器内的时区")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" > /etc/timezone")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 环境变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MYPATH /apps/service_second/")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建项目存放路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MYPATH}")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MYPATH}")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 尽量采用指定路径挂载,不然会生成很多临时挂载垃圾文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匿名挂载目录(宿主机位置：/var/lib/docker/volumes/xxxxxxxxxxxxxxxx)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看挂载目录：docker inspect szbxl-user-service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有挂载卷：docker volume ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME ${MYPATH}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tomcat 默认使用/tmp作为工作目录。这个命令的效果是：在宿主机的/var/lib/docker目录下创建一个临时文件并把它链接到容器中的/tmp目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME /tmp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME /log")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加jar包到指定路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" service_second/target/*.jar app.jar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#EXPOSE 802")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器执行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","app.jar"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#ENTRYPOINT ["sh", "-c", "java --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.lang.reflect=ALL-UNNAMED -Djava.security.egd=file:/dev/./urandom -jar app.jar"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.jar"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("子模块一目录.gitlab-ci.yml配置")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1：需要用到的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2：必须配置的一些环境变量。如果本地可不配置 DOCKER_HOST。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3：配置缓存，配置后，maven 下载的依赖可以被缓存起来，下次不需要重复去下载了。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4：配置需要用到的额外的服务。docker:dind，这个貌似是用于在 docker 中运行 docker 的一种东西，在项目的构建中需要。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有时需要在容器内执行 docker 命令，比如：在 jenkins 容器内运行 docker 命令执行构建镜像")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接在 docker 容器内嵌套安装 docker 未免太过臃肿")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更好的办法是：容器内仅部署 docker 命令行工具（作为客户端），实际执行交由宿主机内的 docker-engine（服务器）")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先启动一个docker:dind容器A，再启动一个docker容器B，容器B指定host为A容器内的docker daemon。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5：stages，这是 Gitlab CI 中的概念，Stages 表示构建阶段，就是一些按序执行的流程，具体执行是依赖于 Jobs 的。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6 ：定义的 Jobs 之一，用于构建 jar 包。内部又引入 maven 镜像来处理，负责执行 package 这一流程。script 为具体执行的脚本。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7：定义的 Jobs 之一，用于构建 Docker 镜像。负责执行 deploy 这一流程。具体执行 build 和 run。only 节点表示只监控 master 分支。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根目录已提供")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_DRIVER: overlay2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_HOST: tcp://192.168.8.10:2375  # docker host，本地可不写")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_TLS_CERTDIR: ''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PROFILE_ACTIVE: prd")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SECOND_TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("':1.0'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像版本号")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SECOND_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_second "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SECOND_RPORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像端口 容器内的端口与其不一致")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SECOND_DIRECTORY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_second "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" m2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .m2/repository\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("dind\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maven-package:service_second")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.5.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" maven\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mvn clean package -pl service_first -am -Dmaven.test.skip=true -pl --projects <arg> 构建制定的模块，模块间用逗号分隔；-am --also-make 同时构建所列模块的依赖模块；")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mvn clean package "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("P $PROFILE_ACTIVE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dmaven.test.skip=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pl $SECOND_DIRECTORY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("am\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $SECOND_DIRECTORY/target/"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.jar")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-dev:service_second")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $SECOND_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $SECOND_DIRECTORY/Dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name $SECOND_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /apps/$SECOND_DIRECTORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/apps/$SECOND_DIRECTORY/log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $SECOND_RPORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$SECOND_RPORT $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制作业在什么时候创建，定义了哪些分支或标签(branches and tags)的作业会运行")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分支")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dev\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#changes: # 下面的文件中任一文件发生改变")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - .gitlab-ci.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-prd:service_second")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" service_second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $SECOND_DIRECTORY/Dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'which  ssh-agent || ( yum update -y  && yum install openssh-client git -y )'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" eval $(ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s)\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "$SSH_PRIVATE_KEY" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" tr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d '\\r' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p ~/.ssh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod 700 ~/.ssh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyscan 192.168.8.103 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" ~/.ssh/known_hosts "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh-keyscan 从服务器收集 SSH公钥。 ssh-keyscan 是一个收集多个主机的 SSH 公共密钥的实用工具。它被设计用来帮助构建和验证 ssh_known_hosts 文件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod 644 ~/.ssh/known_hosts\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -tq 打印台静默不打印")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ssh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tq 192.168.8.103 << EOF\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $SECOND_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name $SECOND_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /apps/$SECOND_DIRECTORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/apps/$SECOND_DIRECTORY/log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $SECOND_RPORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$SECOND_RPORT $CI_REGISTRY_IMAGE/$SECOND_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$SECOND_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" exit\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" EOF\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(' $PROFILE_ACTIVE == "prd" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" main\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br")])]),a("p",[s._v("多模块")]),s._v(" "),a("h3",{attrs:{id:"部署过程中遇到的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署过程中遇到的问题"}},[s._v("#")]),s._v(" 部署过程中遇到的问题")]),s._v(" "),a("p",[a("img",{attrs:{src:t(604),alt:"image-20230618211704013"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新加载daemon")]),s._v("\nsystemctl daemon-reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("下载的镜像重复拉取")]),s._v(" "),a("p",[s._v("The image pull policy: never, if-not-present or always (default).")]),s._v(" "),a("p",[s._v("never是从不从远端拉镜像，只用本地。if-not-present 是优先本地，然后是从网络拉取镜像。always 是从远端拉取镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("解决办法：配置先从本地拉取。\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/gitlab-runner/config.toml 添加：    \npull_policy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"if-not-present"')]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(605),alt:"image-20230618215738518"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(606),alt:"image-20230618220336436"}})]),s._v(" "),a("p",[s._v("maven下载慢")]),s._v(" "),a("p",[s._v("maven安装到宿主机，在runner里面进行挂载，这样可以重复使用，也可以使用国内的镜像源")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Docker Maven Runner"')]),s._v("\n  url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.8.10:2280"')]),s._v("\n  token "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mPciztaPrpZsYSsWuRAX"')]),s._v("\n  executor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.custom_build_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache.s3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache.gcs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache.azure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    tls_verify "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    image "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"maven:3.5.0-jdk-8"')]),s._v("\n    privileged "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    pull_policy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"if-not-present"')]),s._v("\n    disable_entrypoint_overwrite "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    oom_kill_disable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    disable_cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    volumes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/cache"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/export/server/bigdata-stack/maven/apache-maven-3.9.2:/root/.m2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    shm_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Docker Build Runner"')]),s._v("\n  url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.8.10:2280"')]),s._v("\n  token "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pRuA3NL6tsJsBgq-Ps65"')]),s._v("\n  executor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.custom_build_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache.s3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache.gcs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.cache.azure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("runners.docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    tls_verify "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    image "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker:latest"')]),s._v("\n    privileged "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    pull_policy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"if-not-present"')]),s._v("\n    disable_entrypoint_overwrite "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    oom_kill_disable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    disable_cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    volumes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/cache"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/export/server/bigdata-stack/maven/apache-maven-3.9.2:/root/.m2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    shm_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[a("img",{attrs:{src:t(607),alt:"image-20230618220813431"}})]),s._v(" "),a("h2",{attrs:{id:"_10-docker-整合sonar进行代码质量检查-统计单元测试覆盖率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-docker-整合sonar进行代码质量检查-统计单元测试覆盖率"}},[s._v("#")]),s._v(" 10.Docker 整合Sonar进行代码质量检查,统计单元测试覆盖率")]),s._v(" "),a("p",[s._v("单模块的.yml配置修改如下：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1：需要用到的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2：必须配置的一些环境变量。如果本地可不配置 DOCKER_HOST。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3：配置缓存，配置后，maven 下载的依赖可以被缓存起来，下次不需要重复去下载了。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4：配置需要用到的额外的服务。docker:dind，这个貌似是用于在 docker 中运行 docker 的一种东西，在项目的构建中需要。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有时需要在容器内执行 docker 命令，比如：在 jenkins 容器内运行 docker 命令执行构建镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接在 docker 容器内嵌套安装 docker 未免太过臃肿")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更好的办法是：容器内仅部署 docker 命令行工具（作为客户端），实际执行交由宿主机内的 docker-engine（服务器）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先启动一个docker:dind容器A，再启动一个docker容器B，容器B指定host为A容器内的docker daemon。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5：stages，这是 Gitlab CI 中的概念，Stages 表示构建阶段，就是一些按序执行的流程，具体执行是依赖于 Jobs 的。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6 ：定义的 Jobs 之一，用于构建 jar 包。内部又引入 maven 镜像来处理，负责执行 package 这一流程。script 为具体执行的脚本。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7：定义的 Jobs 之一，用于构建 Docker 镜像。负责执行 deploy 这一流程。具体执行 build 和 run。only 节点表示只监控 master 分支。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" overlay2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.8.10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2375")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker host，本地可不写")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DOCKER_TLS_CERTDIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("USERSERVICE_TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("':1.0'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像版本号")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("USERSERVICE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cicd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("USERSERVICE_RPORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像端口 容器内的端口与其不一致")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("USERSERVICE_DIRECTORY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cicd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块目录")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("PROFILE_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prd\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sonner scanner 安装目录")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SCANNER_HOME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/export/server/sonar-scanner"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 扫描代码路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SCAN_DIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" m2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .m2/repository\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("dind\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" package\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sonarqube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maven-package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.5.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" maven\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" package\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mvn clean org.jacoco"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("jacoco"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("prepare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent install dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("copy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dependencies\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dmaven.test.failure.ignore=true package "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("P $PROFILE_ACTIVE\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Maven编译，所以会有Jar包产物，这里定义产物的过期时间")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expire_in")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1 days\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" target/\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sonarqube-check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sonarsource/sonar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("scanner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("entrypoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sonar\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sonarqube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("package\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SONAR_USER_HOME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${CI_PROJECT_DIR}/.sonar"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Defines the location of the analysis task cache")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("GIT_DEPTH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tells git to fetch all the branches of the project, required by the analysis task")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${CI_JOB_NAME}"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .sonar/cache\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sonar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("scanner\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.projectKey=sonarqube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.sources=src/main/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.tests=src/test/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.coverage.exclusions=src/main/java/com/gordon/cicd/CicdApplication.java\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.scm.disabled=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.language=java\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.sourceEncoding=UTF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.host.url=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.8.10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.login=b95cb41cb57230c28a79a177a9f0fc3bddf02a79\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.java.binaries=target/classes\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.java.test.binaries=target/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("classes\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.java.libraries=target/dependency\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.java.test.libraries=target/dependency\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.java.surefire.report=target/surefire"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("reports\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dsonar.coverage.jacoco.xmlReportPaths=target/site/jacoco/jacoco.xml\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#统计结果输出")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" awk "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('F"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\" '"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" instructions += $4 + $5; covered += $5 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" END "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" print 100 "),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*covered/instructions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"% covered"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("' target/site/jacoco/jacoco.csv\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allow_failure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" merge_requests\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or the name of your main branch")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" develop\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" target/\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-dev")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sonarqube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $USERSERVICE_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f Dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name $USERSERVICE_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/apps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $USERSERVICE_RPORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$USERSERVICE_RPORT $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制作业在什么时候创建，定义了哪些分支或标签(branches and tags)的作业会运行")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分支")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dev\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#changes: # 下面的文件中任一文件发生改变")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - .gitlab-ci.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-prd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prd\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sonarqube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f Dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG .\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'which  ssh-agent || ( yum update -y  && yum install openssh-client git -y )'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" eval $(ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("agent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s)\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "$SSH_PRIVATE_KEY" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" tr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d '\\r' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p ~/.ssh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod 700 ~/.ssh\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keyscan 192.168.8.103 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" ~/.ssh/known_hosts "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh-keyscan 从服务器收集 SSH公钥。 ssh-keyscan 是一个收集多个主机的 SSH 公共密钥的实用工具。它被设计用来帮助构建和验证 ssh_known_hosts 文件")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chmod 644 ~/.ssh/known_hosts\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -tq 打印台静默不打印")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ssh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tq 192.168.8.103 << EOF\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker login $CI_REGISTRY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("u $CI_REGISTRY_USER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $CI_REGISTRY_PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rm "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $USERSERVICE_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name $USERSERVICE_NAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/apps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("privileged=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $USERSERVICE_RPORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$USERSERVICE_RPORT $CI_REGISTRY_IMAGE/$USERSERVICE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$PROFILE_ACTIVE$USERSERVICE_TAG\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker image prune "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" exit\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" EOF\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(' $PROFILE_ACTIVE == "prd" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br")])]),a("p",[a("img",{attrs:{src:t(608),alt:"image-20230621061204614"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(609),alt:"image-20230621061339592"}})]),s._v(" "),a("p",[s._v("为了readme能查看结果，pom中jacoco做了exclude")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token prolog"}},[s._v('<?xml version="1.0" encoding="UTF-8"?>')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("project")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("xmlns")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://maven.apache.org/POM/4.0.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xmlns:")]),s._v("xsi")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://www.w3.org/2001/XMLSchema-instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xsi:")]),s._v("schemaLocation")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("modelVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("4.0.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("modelVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("parent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-parent"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.0.1.RELEASE"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("relativePath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- lookup parent from repository --\x3e")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("parent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.gordon"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("cicd"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.0.1-SNAPSHOT"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("packaging")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jar"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("packaging")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("cicd"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Demo project for Spring Boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("project.build.sourceEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("project.build.sourceEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("project.reporting.outputEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("project.reporting.outputEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("java.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.8"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("java.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-web"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-test"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("test"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("pluginManagement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.sonarsource.scanner.maven"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sonar-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("3.7.0.1746"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("pluginManagement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.maven.plugins"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("maven-compiler-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("3.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${java.version}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${java.version}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--覆盖率测试--\x3e")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.maven.plugins"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("maven-surefire-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.21.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("testFailureIgnore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("testFailureIgnore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("argLine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("@{argLine} -Dfile.encoding=utf-8"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("argLine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.jacoco"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jacoco-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.8.7"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("excludes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("**/CicdApplication.class"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("excludes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("executions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("execution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("prepare-agent"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("goals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("goal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("prepare-agent"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("goal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("goals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("execution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("execution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("report"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("goals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("goal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("report"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("goal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("goals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("execution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("executions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br")])]),a("p",[s._v("覆盖率展示格式化")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("d+."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("d+ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("% covered\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(610),alt:"image-20230621132854431"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(611),alt:"image-20230621132548570"}})]),s._v(" "),a("p",[s._v("多模块的子模块配置更新如下：")]),s._v(" "),a("p",[s._v("这里提供一种思路，新建一个模块把其他模块作为依赖引入，然后计算总的覆盖率。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   .gitlab-ci.yml\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   pom.xml\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   README.md\n+---report-aggregate\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       .gitlab-ci.yml\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       pom.xml\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---service_first\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   .gitlab-ci.yml\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   Dockerfile\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   pom.xml\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---src\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       +---main\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   +---java\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---gordon\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   FirstApplication.java\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---controller\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   TestController.java\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---resources\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           application.properties\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---test\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---java\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---gordon\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---controller\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                               TestControllerTest.java\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---service_second\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   .gitlab-ci.yml\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   pom.xml\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---src\n        +---main\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   +---java\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---com\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---gordon\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   SecondApplication.java\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---controller\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   TestController.java\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---resources\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           application.properties\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---test\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---java\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---com\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---gordon\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("---controller\n                                TestControllerTest.java\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br")])]),a("p",[s._v("创建第三模块")]),s._v(" "),a("p",[s._v("pom")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token prolog"}},[s._v('<?xml version="1.0" encoding="UTF-8"?>')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("project")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("xmlns")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://maven.apache.org/POM/4.0.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xmlns:")]),s._v("xsi")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://www.w3.org/2001/XMLSchema-instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xsi:")]),s._v("schemaLocation")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("parent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("cicd_muil"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.gordon"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.0-SNAPSHOT"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("parent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("modelVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("4.0.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("modelVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("report-aggregate"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.0-SNAPSHOT"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.gordon"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("service_first"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.0-SNAPSHOT"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.gordon"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("service_second"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.0-SNAPSHOT"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.jacoco"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jacoco-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.8.7"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("excludes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("**/FirstApplication.class"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("**/SecondApplication.class"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclude")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("excludes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("executions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("execution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jacoco-report-aggregate"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 触发的maven 命令 --\x3e")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("phase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("install"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("phase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("goals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("goal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("report-aggregate"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("goal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("goals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("execution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("executions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("p",[s._v(".gitlab-ci.yml")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根目录已提供")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_DRIVER: overlay2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_HOST: tcp://192.168.8.10:2375  # docker host，本地可不写")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOCKER_TLS_CERTDIR: ''")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PROFILE_ACTIVE: prd")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("REPORT_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" report"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aggregate "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("REPORT_DIRECTORY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" report"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aggregate "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" m2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .m2/repository\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("dind\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" report"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aggregate\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maven-package:report-aggregate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.5.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" maven\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" report"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aggregate\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mvn clean package -pl service_first -am -Dmaven.test.skip=true -pl --projects <arg> 构建制定的模块，模块间用逗号分隔；-am --also-make 同时构建所列模块的依赖模块；")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mvn clean install dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("copy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Dmaven.test.failure.ignore=true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pl $REPORT_DIRECTORY  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("am\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" awk "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('F"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\" '"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" instructions += $4 + $5; covered += $5 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" END "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" print 100 "),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*covered/instructions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"% covered"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("' $REPORT_DIRECTORY/target/site/jacoco"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aggregate/jacoco.csv\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $REPORT_DIRECTORY/target/\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[a("strong",[s._v("查看pipeline运行情况以及扫描结果")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(612),alt:"image-20230620154235530"}})]),s._v(" "),a("p",[s._v("test"),a("br"),s._v(" "),a("img",{attrs:{src:t(613),alt:"image-20230621154703183"}})])])}),[],!1,null,null,null);a.default=e.exports},515:function(s,a,t){s.exports=t.p+"assets/img/why_container_1.65fc9070.png"},516:function(s,a,t){s.exports=t.p+"assets/img/why_container_2.b1fa06e9.png"},517:function(s,a,t){s.exports=t.p+"assets/img/container_vs_vm.b4b11921.png"},518:function(s,a,t){s.exports=t.p+"assets/img/dockerhub-2020.8e6b6d35.png"},519:function(s,a,t){s.exports=t.p+"assets/img/image-20230613194139663.8dd3fbcc.png"},520:function(s,a){s.exports="data:image/png;base64,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"},521:function(s,a,t){s.exports=t.p+"assets/img/image-20230613203418772.9e10e822.png"},522:function(s,a,t){s.exports=t.p+"assets/img/image-20230704213534149.55eeae2d.png"},523:function(s,a,t){s.exports=t.p+"assets/img/image-20230613212427849.144f4240.png"},524:function(s,a,t){s.exports=t.p+"assets/img/image-20230613212507558.4ea5cb0a.png"},525:function(s,a,t){s.exports=t.p+"assets/img/image-20230613221008147.7059a259.png"},526:function(s,a,t){s.exports=t.p+"assets/img/image-20230613221825728.138cac40.png"},527:function(s,a,t){s.exports=t.p+"assets/img/containers-vs-virtual-machines.959f9fcc.jpg"},528:function(s,a,t){s.exports=t.p+"assets/img/image-20230613232708883.b368bffc.png"},529:function(s,a,t){s.exports=t.p+"assets/img/docker-stages.45f8e057.png"},530:function(s,a,t){s.exports=t.p+"assets/img/image-20230614002229573.73a7cca8.png"},531:function(s,a,t){s.exports=t.p+"assets/img/image-20230614002610129.27df73a1.png"},532:function(s,a,t){s.exports=t.p+"assets/img/image-20230614065355333.999ff1ad.png"},533:function(s,a){s.exports="data:image/png;base64,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"},534:function(s,a,t){s.exports=t.p+"assets/img/image-20230614044514049.60618fb3.png"},535:function(s,a,t){s.exports=t.p+"assets/img/image-20230614050147206.aac63548.png"},536:function(s,a,t){s.exports=t.p+"assets/img/image-20230614054131643.f920c3bf.png"},537:function(s,a,t){s.exports=t.p+"assets/img/image-20230614053824763.5a56a19b.png"},538:function(s,a,t){s.exports=t.p+"assets/img/image-20230614055202954.9e6704bb.png"},539:function(s,a,t){s.exports=t.p+"assets/img/image-20230614055347798.3cfc4d77.png"},540:function(s,a,t){s.exports=t.p+"assets/img/docker_environment_build_args.a2d333ca.png"},541:function(s,a){s.exports="data:image/png;base64,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"},542:function(s,a){s.exports="data:image/png;base64,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"},543:function(s,a,t){s.exports=t.p+"assets/img/image-20230614185305649.185f7cbf.png"},544:function(s,a,t){s.exports=t.p+"assets/img/image-20230614185826404.dfd52840.png"},545:function(s,a,t){s.exports=t.p+"assets/img/image-20230614204910784.efe29cfd.png"},546:function(s,a,t){s.exports=t.p+"assets/img/image-20230614205051618.aafc5ecb.png"},547:function(s,a,t){s.exports=t.p+"assets/img/image-20230614205127406.29636486.png"},548:function(s,a,t){s.exports=t.p+"assets/img/image-20230614205156437.43213ab4.png"},549:function(s,a,t){s.exports=t.p+"assets/img/volumes-shared-storage.89cc77d3.png"},550:function(s,a,t){s.exports=t.p+"assets/img/image-20230624001942212.e00fb2ef.png"},551:function(s,a,t){s.exports=t.p+"assets/img/20587097-181ef0aea6cb0724-1687536491371.9aa9cebe.png"},552:function(s,a,t){s.exports=t.p+"assets/img/two-container-network.70b9aa93.png"},553:function(s,a,t){s.exports=t.p+"assets/img/image-20230615014550650.ffee685c.png"},554:function(s,a,t){s.exports=t.p+"assets/img/image-20230615014905449.37e64e8a.png"},555:function(s,a,t){s.exports=t.p+"assets/img/image-20230615015046323.90508b82.png"},556:function(s,a,t){s.exports=t.p+"assets/img/image-20230615014928149.243d5bd7.png"},557:function(s,a,t){s.exports=t.p+"assets/img/image-20230615031010565.37faaa85.png"},558:function(s,a,t){s.exports=t.p+"assets/img/image-20230615031050706.e48defe9.png"},559:function(s,a,t){s.exports=t.p+"assets/img/image-20230615020041753.4a9ab809.png"},560:function(s,a,t){s.exports=t.p+"assets/img/image-20230615020459251.cfd4c129.png"},561:function(s,a,t){s.exports=t.p+"assets/img/image-20230615022050502.af823d32.png"},562:function(s,a,t){s.exports=t.p+"assets/img/image-20230615022408022.ba7869da.png"},563:function(s,a,t){s.exports=t.p+"assets/img/image-20230615022856154.a69f79cf.png"},564:function(s,a,t){s.exports=t.p+"assets/img/image-20230624000916878.275a97c2.png"},565:function(s,a,t){s.exports=t.p+"assets/img/image-20230624000945278.862776b8.png"},566:function(s,a,t){s.exports=t.p+"assets/img/image-20230624001011324.8d516a1e.png"},567:function(s,a,t){s.exports=t.p+"assets/img/image-20230615194209960.b5b39b95.png"},568:function(s,a,t){s.exports=t.p+"assets/img/image-20230615164951809.90dba8c7.png"},569:function(s,a,t){s.exports=t.p+"assets/img/image-20230615165300217.40145d8e.png"},570:function(s,a,t){s.exports=t.p+"assets/img/image-20230615165442594.fc58d3ad.png"},571:function(s,a,t){s.exports=t.p+"assets/img/image-20230615191429985.a8034735.png"},572:function(s,a,t){s.exports=t.p+"assets/img/image-20230615204622919.391d4875.png"},573:function(s,a,t){s.exports=t.p+"assets/img/docker-compose-intro.5a569317.png"},574:function(s,a,t){s.exports=t.p+"assets/img/image-20230616003716859.520d3457.png"},575:function(s,a,t){s.exports=t.p+"assets/img/image-20230615233815833.b5ed1b07.png"},576:function(s,a,t){s.exports=t.p+"assets/img/image-20230616003533812.bf2a35b4.png"},577:function(s,a,t){s.exports=t.p+"assets/img/image-20230616005138911.45d8822e.png"},578:function(s,a,t){s.exports=t.p+"assets/img/image-20230616005633040.5e288364.png"},579:function(s,a,t){s.exports=t.p+"assets/img/image-20230616010445855.9d224d4b.png"},580:function(s,a,t){s.exports=t.p+"assets/img/image-20230616030540760.17f766f3.png"},581:function(s,a,t){s.exports=t.p+"assets/img/image-20230616024620573.48c40f63.png"},582:function(s,a,t){s.exports=t.p+"assets/img/image-20230616032013489.49724318.png"},583:function(s,a,t){s.exports=t.p+"assets/img/image-20230616034818237.defc8dce.png"},584:function(s,a,t){s.exports=t.p+"assets/img/image-20230616035043531.a86469fe.png"},585:function(s,a,t){s.exports=t.p+"assets/img/image-20230616143909418.8be8a45f.png"},586:function(s,a,t){s.exports=t.p+"assets/img/image-20230616155516681.c2a2badb.png"},587:function(s,a){s.exports="data:image/png;base64,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AAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAYBEgAAAAAYBAgAQAAAIBBgAQAAAAABgESAAAAABgESAAAAABgECABAAAAgEGABAAAAAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAYBEgAAAAAYKA88/gAAAGySURBVBAgAQAAAIBBgAQAAAAABgESAAAAABgESAAAAABgECABAAAAgEGABAAAAAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAYBEgAAAAAYBAgAQAAAIBBgAQAAAAABgESAAAAABgESAAAAABgECABAAAAgEGABAAAAAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAYBEgAAAAAYBAgAQAAAIBBgAQAAAAABgESAAAAABgESAAAAABgECABAAAAgEGABAAAAAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAYBEgAAAAAYBAgAQAAAIBBgAQAAAAABgESAAAAABgESAAAAABgECABAAAAgEGABAAAAAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAYBEgAAAAAYBAgAQAAAIBBgAQAAAAABgESAAAAABgESAAAAABgECABAAAAgEGABAAAAAAGARIAAAAAGARIAAAAAGAQIAEAAACAQYAEAAAAAAYBEgAAAAAY/w8Q+5K6uyOzjAAAAABJRU5ErkJggg=="},588:function(s,a,t){s.exports=t.p+"assets/img/image-20230616161615653.62d54285.png"},589:function(s,a,t){s.exports=t.p+"assets/img/image-20230616165246979.68325347.png"},590:function(s,a,t){s.exports=t.p+"assets/img/image-20230616165405507.a8027444.png"},591:function(s,a,t){s.exports=t.p+"assets/img/image-20230616172342028.431c63da.png"},592:function(s,a,t){s.exports=t.p+"assets/img/image-20230618005439820.6df6da9e.png"},593:function(s,a,t){s.exports=t.p+"assets/img/image-20230618010027391.b90d2853.png"},594:function(s,a,t){s.exports=t.p+"assets/img/docker-compose_swarm.6e5c983a.png"},595:function(s,a,t){s.exports=t.p+"assets/img/swarm_arch.33196797.png"},596:function(s,a,t){s.exports=t.p+"assets/img/image-20230616195332575.4147faf1.png"},597:function(s,a,t){s.exports=t.p+"assets/img/image-20230616201111290.2e06ac57.png"},598:function(s,a,t){s.exports=t.p+"assets/img/image-20230616201211209.494d6cf9.png"},599:function(s,a,t){s.exports=t.p+"assets/img/image-20230617134719031.214ce232.png"},600:function(s,a,t){s.exports=t.p+"assets/img/image-20230617134833434.96ce4028.png"},601:function(s,a,t){s.exports=t.p+"assets/img/image-20230617143823599.049a1bfd.png"},602:function(s,a,t){s.exports=t.p+"assets/img/image-20230617144531651.738b9e8b.png"},603:function(s,a,t){s.exports=t.p+"assets/img/image-20230617144619636.58a012bc.png"},604:function(s,a,t){s.exports=t.p+"assets/img/image-20230618211704013.7893e850.png"},605:function(s,a,t){s.exports=t.p+"assets/img/image-20230618215738518.4f20a89c.png"},606:function(s,a,t){s.exports=t.p+"assets/img/image-20230618220336436.95ccad1b.png"},607:function(s,a,t){s.exports=t.p+"assets/img/image-20230618220813431.8b7f4c53.png"},608:function(s,a,t){s.exports=t.p+"assets/img/image-20230621061204614.674c069c.png"},609:function(s,a,t){s.exports=t.p+"assets/img/image-20230621061339592.f094441b.png"},610:function(s,a,t){s.exports=t.p+"assets/img/image-20230621132854431.c844f15e.png"},611:function(s,a,t){s.exports=t.p+"assets/img/image-20230621132548570.dd61fcc8.png"},612:function(s,a,t){s.exports=t.p+"assets/img/image-20230620154235530.f5816d17.png"},613:function(s,a,t){s.exports=t.p+"assets/img/image-20230621154703183.1908cae8.png"}}]);